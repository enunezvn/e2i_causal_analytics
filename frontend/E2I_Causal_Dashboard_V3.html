<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E2I Causal Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #718096;
            font-size: 1.2em;
        }
        
        .workstream-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 12px 24px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            font-weight: 600;
            color: #4a5568;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .workstream-content {
            display: none;
        }
        
        .workstream-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .metric-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #2d3748;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .metric-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .status-green { background: #c6f6d5; color: #22543d; }
        .status-yellow { background: #feebc8; color: #7c2d12; }
        .status-red { background: #fed7d7; color: #742a2a; }
        
        .metric-chart {
            margin-top: 15px;
            height: 200px;
        }
        
        .causal-insight {
            background: linear-gradient(135deg, #f6f9fc 0%, #e9f3ff 100%);
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
        }
        
        .causal-insight-title {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .causal-insight-title::before {
            content: "‚ö°";
            font-size: 1.2em;
        }
        
        .causal-insight-text {
            color: #2d3748;
            line-height: 1.6;
        }
        
        .causal-effect {
            font-weight: bold;
            color: #667eea;
        }
        
        .visualization-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .viz-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .causal-dag {
            height: 400px;
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #718096;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.95em;
        }
        
        select, input[type="date"] {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            color: #2d3748;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        select:hover, input[type="date"]:hover {
            border-color: #667eea;
        }
        
        select:focus, input[type="date"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .refresh-button {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            margin-left: auto;
        }
        
        .refresh-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .alert-banner {
            background: linear-gradient(135deg, #feb2b2 0%, #fc8181 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.5s;
        }
        
        .alert-banner.show {
            display: block;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }


        /* Agent Insights Specific Styles */
        .agent-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #667eea;
        }
        
        .agent-card.critical {
            border-left-color: #fc8181;
            background: linear-gradient(135deg, #fff 0%, #fff5f5 100%);
        }
        
        .agent-card.opportunity {
            border-left-color: #48bb78;
            background: linear-gradient(135deg, #fff 0%, #f0fff4 100%);
        }
        
        .agent-card.predictive {
            border-left-color: #f6ad55;
            background: linear-gradient(135deg, #fff 0%, #fffdf7 100%);
        }
        
        .agent-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .agent-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }
        
        .agent-icon.impact { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .agent-icon.gap { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }
        .agent-icon.drift { background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%); }
        .agent-icon.experiment { background: linear-gradient(135deg, #4ecdc4 0%, #44a8a0 100%); }
        
        .agent-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3748;
        }
        
        .agent-subtitle {
            font-size: 0.9em;
            color: #718096;
        }
        
        .insight-content {
            margin-top: 15px;
            line-height: 1.6;
            color: #4a5568;
        }
        
        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .action-item:hover {
            background: #edf2f7;
            transform: translateX(5px);
        }
        
        .action-priority {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .priority-high { background: #fed7d7; color: #742a2a; }
        .priority-medium { background: #feebc8; color: #7c2d12; }
        .priority-low { background: #c6f6d5; color: #22543d; }
        
        .roi-badge {
            display: inline-block;
            padding: 4px 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .prediction-timeline {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .timeline-item {
            flex: 1;
            text-align: center;
        }
        
        .timeline-date {
            font-size: 0.9em;
            color: #718096;
            margin-bottom: 5px;
        }
        
        .timeline-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #2d3748;
        }
        
        .confidence-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: #f7fafc;
            border-radius: 6px;
            font-size: 0.85em;
        }
        
        .confidence-high { color: #22543d; }
        .confidence-medium { color: #7c2d12; }
        .confidence-low { color: #718096; }
        
        .experiment-card {
            background: linear-gradient(135deg, #f6f9fc 0%, #e9f3ff 100%);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .experiment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .experiment-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            background: white;
        }
        
        .status-proposed { color: #667eea; }
        .status-active { color: #48bb78; }
        .status-completed { color: #718096; }
        
        .causal-chain {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        
        .chain-node {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .chain-arrow {
            color: #cbd5e0;
            font-size: 1.5em;
        }
        
        .chain-effect {
            color: #48bb78;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        /* Legend styles */
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        
        .legend-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .legend-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
        }
        
        .legend-color {
            width: 40px;
            height: 30px;
            border-radius: 6px;
            margin-right: 15px;
        }
        
        .legend-description {
            flex: 1;
        }
        
        .legend-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 4px;
        }
        
        .legend-criteria {
            font-size: 0.9em;
            color: #718096;
        }
        
        /* KPI Dictionary styles */
        .kpi-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .kpi-section-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .kpi-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .kpi-table th {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .kpi-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }
        
        .kpi-table tr:hover {
            background: #f7fafc;
        }
        
        .formula-text {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            background: #f7fafc;
            padding: 2px 6px;
            border-radius: 4px;
        }
    

        /* ========== V3 ADDITIONS CSS ========== */

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .preview-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .preview-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        .preview-header h1 { color: #2d3748; font-size: 1.8em; margin-bottom: 8px; }
        .preview-header p { color: #718096; }
        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            background: #f7fafc;
            padding: 12px;
            border-radius: 12px;
        }
        .tab-button {
            padding: 10px 16px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
            font-weight: 600;
            color: #4a5568;
        }
        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .component-section { display: none; animation: fadeIn 0.4s ease; }
        .component-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .component-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .component-title .gap-badge {
            font-size: 0.55em;
            padding: 4px 10px;
            background: #667eea;
            color: white;
            border-radius: 12px;
        }
        .component-description {
            color: #718096;
            margin-bottom: 20px;
            font-size: 0.95em;
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .component-demo {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        .sub-section-title {
            font-size: 1em;
            font-weight: 600;
            color: #667eea;
            margin: 20px 0 12px;
        }
        /* Chat Panel */
        .chat-demo-container { display: flex; gap: 30px; align-items: flex-start; }
        .chat-toggle {
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5em; color: white; transition: all 0.3s;
        }
        .chat-toggle:hover { transform: scale(1.1); }
        .chat-panel-demo {
            flex: 1; max-width: 420px; background: white;
            border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); overflow: hidden;
        }
        .chat-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; display: flex; justify-content: space-between; align-items: center;
        }
        .chat-header h3 { font-size: 1.1em; display: flex; align-items: center; gap: 8px; }
        .chat-close { background: none; border: none; color: white; font-size: 1.3em; cursor: pointer; opacity: 0.8; }
        .filter-context {
            padding: 10px 15px; background: #edf2f7; font-size: 0.85em; color: #4a5568;
        }
        .filter-context span {
            background: white; padding: 2px 8px; border-radius: 4px; margin: 0 3px; font-weight: 500;
        }
        .chat-messages { padding: 15px; background: #f7fafc; max-height: 320px; overflow-y: auto; }
        .chat-message { margin-bottom: 15px; max-width: 90%; }
        .chat-message.user { margin-left: auto; }
        .chat-message.assistant { margin-right: auto; }
        .message-content { padding: 12px 16px; border-radius: 15px; font-size: 0.9em; line-height: 1.5; }
        .user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border-bottom-right-radius: 5px;
        }
        .assistant .message-content {
            background: white; color: #2d3748; border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .agent-badges { display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
        .agent-badge {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 3px 8px; border-radius: 12px; font-size: 0.75em; font-weight: 600;
        }
        .agent-badge.tier-0 { background: #dbeafe; color: #1e40af; }
        .agent-badge.tier-1 { background: #e0e7ff; color: #3730a3; }
        .agent-badge.tier-2 { background: #fae8ff; color: #86198f; }
        .agent-badge.tier-3 { background: #fef3c7; color: #92400e; }
        .agent-badge.tier-4 { background: #dcfce7; color: #166534; }
        .agent-badge.tier-5 { background: #f3e8ff; color: #6b21a8; }
        .streaming-indicator { display: flex; align-items: center; gap: 8px; padding: 10px; color: #718096; font-size: 0.85em; }
        .streaming-dots { display: flex; gap: 4px; }
        .streaming-dots span {
            width: 8px; height: 8px; border-radius: 50%; background: #667eea;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .streaming-dots span:nth-child(1) { animation-delay: -0.32s; }
        .streaming-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .chat-input-area { padding: 15px; background: white; border-top: 1px solid #e2e8f0; display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 10px 14px; border: 2px solid #e2e8f0; border-radius: 20px; font-size: 0.9em; outline: none; }
        .chat-input:focus { border-color: #667eea; }
        .chat-send {
            width: 40px; height: 40px; border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; color: white; cursor: pointer; font-size: 1.1em;
        }
        /* Validation Badges */
        .validation-badge {
            display: inline-flex; align-items: center; gap: 12px;
            padding: 8px 16px; border-radius: 8px; font-size: 0.85em; margin: 5px 0;
        }
        .validation-badge.proceed { background: #ecfdf5; border: 1px solid #10b981; }
        .validation-badge.review { background: #fffbeb; border: 1px solid #f59e0b; }
        .validation-badge.block { background: #fef2f2; border: 1px solid #ef4444; }
        .gate-status { display: flex; align-items: center; gap: 5px; font-weight: 700; }
        .gate-status.proceed { color: #10b981; }
        .gate-status.review { color: #f59e0b; }
        .gate-status.block { color: #ef4444; }
        .validation-details { display: flex; gap: 15px; color: #4a5568; flex-wrap: wrap; }
        .validation-detail { display: flex; align-items: center; gap: 4px; }
        .test-indicators { display: flex; gap: 3px; }
        .test-dot { width: 8px; height: 8px; border-radius: 50%; }
        .test-dot.passed { background: #10b981; }
        .test-dot.failed { background: #ef4444; }
        .test-dot.warning { background: #f59e0b; }
        .test-dot.skipped { background: #9ca3af; }
        /* Header */
        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 4px 12px; border-radius: 15px;
            font-size: 0.5em; margin-left: 10px; vertical-align: middle;
        }
        .architecture-summary { display: flex; justify-content: center; gap: 40px; margin-top: 15px; flex-wrap: wrap; }
        .arch-stat { text-align: center; }
        .arch-stat-value { font-size: 2em; font-weight: bold; color: #667eea; }
        .arch-stat-label { font-size: 0.85em; color: #718096; }
        /* ML Foundation */
        .qc-gate {
            display: flex; align-items: center; gap: 20px; padding: 20px;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px; margin-bottom: 20px;
        }
        .qc-gate.blocked { background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); }
        .qc-icon {
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5em; background: #10b981; color: white; flex-shrink: 0;
        }
        .qc-gate.blocked .qc-icon { background: #ef4444; }
        .qc-info h3 { color: #166534; margin-bottom: 5px; }
        .qc-gate.blocked .qc-info h3 { color: #991b1b; }
        .qc-info p { color: #4a5568; font-size: 0.9em; }
        .pipeline-flow {
            display: flex; align-items: center; justify-content: space-between;
            padding: 20px 0; overflow-x: auto; gap: 5px;
        }
        .pipeline-step { display: flex; flex-direction: column; align-items: center; min-width: 90px; }
        .pipeline-icon {
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.3em; margin-bottom: 8px;
        }
        .pipeline-step.complete .pipeline-icon { background: #10b981; color: white; }
        .pipeline-step.current .pipeline-icon { background: #667eea; color: white; animation: pulse 2s infinite; }
        .pipeline-step.pending .pipeline-icon { background: #e2e8f0; color: #718096; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); } }
        .pipeline-connector { flex: 1; height: 3px; background: #e2e8f0; min-width: 20px; margin-top: -30px; }
        .pipeline-connector.complete { background: #10b981; }
        .pipeline-label { font-size: 0.75em; color: #2d3748; font-weight: 600; text-align: center; }
        .pipeline-status { font-size: 0.7em; color: #718096; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px; }
        .metric-card { background: #f7fafc; border-radius: 12px; padding: 20px; }
        .metric-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .metric-title { font-weight: 600; color: #2d3748; }
        .metric-status { padding: 4px 10px; border-radius: 12px; font-size: 0.75em; font-weight: 600; }
        .status-green { background: #dcfce7; color: #166534; }
        .status-yellow { background: #fef3c7; color: #92400e; }
        .status-red { background: #fee2e2; color: #991b1b; }
        .metric-value { font-size: 1.8em; font-weight: bold; color: #667eea; }
        /* Architecture */
        .tier-card { background: #f7fafc; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .tier-header { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        .tier-badge { padding: 6px 12px; border-radius: 8px; font-weight: 700; font-size: 0.85em; }
        .tier-badge.tier-0 { background: #dbeafe; color: #1e40af; }
        .tier-badge.tier-1 { background: #e0e7ff; color: #3730a3; }
        .tier-badge.tier-2 { background: #fae8ff; color: #86198f; }
        .tier-badge.tier-3 { background: #fef3c7; color: #92400e; }
        .tier-badge.tier-4 { background: #dcfce7; color: #166534; }
        .tier-badge.tier-5 { background: #f3e8ff; color: #6b21a8; }
        .agent-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
        .agent-mini-card {
            background: white; border-radius: 8px; padding: 10px 12px;
            display: flex; align-items: center; gap: 10px;
        }
        .agent-mini-icon {
            width: 32px; height: 32px; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1em; flex-shrink: 0;
        }
        .agent-mini-info h4 { font-size: 0.8em; color: #2d3748; margin-bottom: 2px; }
        .agent-mini-info span { font-size: 0.7em; color: #718096; }
        .agent-status-dot { width: 8px; height: 8px; border-radius: 50%; margin-left: auto; flex-shrink: 0; }
        .agent-status-dot.active { background: #10b981; }
        .agent-status-dot.idle { background: #f59e0b; }
        .agent-status-dot.error { background: #ef4444; }
        /* Validation Table */
        .kpi-table { width: 100%; border-collapse: collapse; }
        .kpi-table th {
            padding: 12px; text-align: left; font-weight: 600;
            color: #2d3748; border-bottom: 2px solid #e2e8f0; font-size: 0.85em;
        }
        .kpi-table td { padding: 10px 12px; border-bottom: 1px solid #e2e8f0; color: #4a5568; font-size: 0.85em; }
        .kpi-table tr:hover { background: #f7fafc; }
        .metrics-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .metric-mini { padding: 15px; border-radius: 10px; background: white; }
        .metric-mini.proceed { border-left: 4px solid #10b981; }
        .metric-mini.review { border-left: 4px solid #f59e0b; }
        .metric-mini.block { border-left: 4px solid #ef4444; }
        .metric-mini-label { font-size: 0.85em; color: #718096; margin-bottom: 5px; }
        .metric-mini-value { font-size: 1.8em; font-weight: bold; }
        .metric-mini.proceed .metric-mini-value { color: #10b981; }
        .metric-mini.review .metric-mini-value { color: #f59e0b; }
        .metric-mini.block .metric-mini-value { color: #ef4444; }

        /* Knowledge Graph Styles */
        .kg-main-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }

        .kg-graph-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .kg-graph-toolbar {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
            flex-wrap: wrap;
        }

        .kg-toolbar-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .kg-toolbar-label {
            font-size: 0.85rem;
            color: #718096;
            font-weight: 600;
        }

        .kg-btn-primary {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .kg-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .kg-btn-secondary {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            background: white;
            color: #4a5568;
        }

        .kg-btn-secondary:hover {
            background: #f7fafc;
        }

        .kg-btn-secondary.active {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid #667eea;
            color: #667eea;
        }

        #kg-cy {
            width: 100%;
            height: 600px;
            background: #f7fafc;
        }

        .kg-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .kg-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .kg-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #2d3748;
        }

        .kg-legend-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .kg-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #4a5568;
        }

        .kg-legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .kg-edge-legend {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .kg-edge-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #4a5568;
        }

        .kg-edge-line {
            width: 30px;
            height: 3px;
        }

        .kg-node-details {
            font-size: 0.9rem;
        }

        .kg-node-details h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .kg-node-details .field {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .kg-node-details .field-label {
            color: #718096;
        }

        .kg-node-details .field-value {
            color: #2d3748;
            font-weight: 500;
        }

        .kg-query-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            color: #2d3748;
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .kg-query-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .kg-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .kg-stat-item {
            background: #f7fafc;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .kg-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .kg-stat-label {
            font-size: 0.75rem;
            color: #718096;
            margin-top: 4px;
        }

        .kg-architecture-section {
            margin-top: 30px;
        }

        .kg-architecture-diagram {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            overflow-x: auto;
        }

        .kg-highlight-vector { color: #667eea; }
        .kg-highlight-fulltext { color: #48bb78; }
        .kg-highlight-graph { color: #f6ad55; }
        .kg-highlight-fusion { color: #fc8181; }

        @media (max-width: 1200px) {
            .kg-main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>E2I Causal Analytics Dashboard</h1>
            <div class="subtitle">AI Agent Insights - Real-time Intelligence</div>
        </div>
        
        <div class="alert-banner" id="alertBanner">
            ‚ö†Ô∏è Critical Alert: Feature Drift PSI exceeds threshold (0.28 > 0.25) - Causal analysis indicates data source changes as primary driver
        </div>
        
        <div class="filter-controls">
            <div class="filter-group">
                <label class="filter-label">Date Range:</label>
                <input type="date" id="startDate" value="2025-09-01">
                <span>to</span>
                <input type="date" id="endDate" value="2025-09-28">
            </div>
            <div class="filter-group">
                <label class="filter-label">Brand:</label>
                <select id="brandFilter">
                    <option value="all">All Brands</option>
                    <option value="remi">Remibrutinib</option>
                    <option value="fabhalta">Fabhalta</option>
                    <option value="kisqali">Kisqali</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Region:</label>
                <select id="regionFilter">
                    <option value="all">All Regions</option>
                    <option value="northeast">Northeast</option>
                    <option value="south">South</option>
                    <option value="midwest">Midwest</option>
                    <option value="west">West</option>
                </select>
            </div>
            <button class="refresh-button" onclick="refreshDashboard()">üîÑ Refresh</button>
        </div>
        
        <div class="workstream-tabs">
            <button class="tab-button active" onclick="switchTab('chat')">üí¨ Chat Panel</button>
            <button class="tab-button" onclick="switchTab('overview')">üìä Overview</button>
            <button class="tab-button" onclick="switchTab('agent-insights')">ü§ñ AI Agent Insights</button>
            <button class="tab-button" onclick="switchTab('ml-foundation')">üîß ML Foundation</button>
            <button class="tab-button" onclick="switchTab('ws1-data')">üóÉÔ∏è WS1: Data Quality</button>
            <button class="tab-button" onclick="switchTab('ws1-ml')">ü§ñ WS1: ML & Model</button>
            <button class="tab-button" onclick="switchTab('ws2')">üéØ WS2: Triggers</button>
            <button class="tab-button" onclick="switchTab('ws3')">üìà WS3: Impact</button>
            <button class="tab-button" onclick="switchTab('causal')">‚ö° Causal Analysis</button>
            <button class="tab-button" onclick="switchTab('knowledge-graph')">üîó Knowledge Graph</button>
            <button class="tab-button" onclick="switchTab('validation')">‚úì Validation</button>
            <button class="tab-button" onclick="switchTab('architecture')">üèóÔ∏è Architecture</button>
            <button class="tab-button" onclick="switchTab('agent-badges')">üè∑Ô∏è Agent Badges</button>
            <button class="tab-button" onclick="switchTab('kpi-dictionary')">üìñ KPI Dictionary</button>
            <button class="tab-button" onclick="switchTab('legend')">üè∑Ô∏è Status Legend</button>
            <button class="tab-button" onclick="switchTab('methodology')">üß† Agentic Methodology</button>
        </div>

        <!-- üí¨ Chat Panel Tab -->
        <div id="chat" class="workstream-content active">
            <div class="component-title">üí¨ Chat Panel </div>
            <div class="component-description">NLP query interface with streaming responses, tier-colored agent badges, filter context display, and example conversation.</div>
            <div class="component-demo">
                <div class="chat-demo-container">
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                        <div style="font-size: 0.85em; color: #718096; font-weight: 600;">Toggle Button</div>
                        <button class="chat-toggle">üí¨</button>
                        <div style="font-size: 0.75em; color: #a0aec0; text-align: center;">Fixed position<br>bottom-right</div>
                    </div>
                    <div class="chat-panel-demo">
                        <div class="chat-header"><h3>üí¨ Ask E2I</h3><button class="chat-close">√ó</button></div>
                        <div class="filter-context">Active filters: <span>Remibrutinib</span> ‚Ä¢ <span>South</span> ‚Ä¢ <span>Sep 2025</span></div>
                        <div class="chat-messages">
                            <div class="chat-message assistant">
                                <div class="agent-badges"><span class="agent-badge tier-1">üéØ Orchestrator</span></div>
                                <div class="message-content">Hello! I'm the E2I Causal Analytics assistant. I can help you understand causal relationships, analyze performance gaps, and design experiments.</div>
                            </div>
                            <div class="chat-message user"><div class="message-content">Why did trigger acceptance drop in the South region last month?</div></div>
                            <div class="chat-message assistant">
                                <div class="agent-badges">
                                    <span class="agent-badge tier-2">‚ö° Causal Impact</span>
                                    <span class="agent-badge tier-2">üìà Gap Analyzer</span>
                                </div>
                                <div class="message-content">
                                    <p>Based on causal analysis, the South region decline (-8pp) has three factors:</p><br>
                                    <p><strong>1. Data Coverage Gap</strong> (Primary) - 70% vs 88% national</p><br>
                                    <p><strong>2. Model Drift</strong> - PSI reached 0.22</p><br>
                                    <p><strong>3. Timing Mismatch</strong> - Data lag 12 days vs 7-day target</p>
                                    <div class="validation-badge proceed" style="margin-top: 12px;">
                                        <span class="gate-status proceed">‚úì VALIDATED</span>
                                        <span style="color: #4a5568;">87% conf ‚Ä¢ E-value: 2.3</span>
                                    </div>
                                </div>
                            </div>
                            <div class="streaming-indicator">
                                <div class="streaming-dots"><span></span><span></span><span></span></div>
                                <span>Analyzing with Causal Impact Agent...</span>
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" class="chat-input" placeholder="Ask about causal relationships...">
                            <button class="chat-send">‚û§</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- üìä Overview Tab -->
        <div id="overview" class="workstream-content">

            <div class="component-title">Updated Header <span class="gap-badge">Updated Stats</span></div>
            <div class="component-description">Replace existing header - adds V4.1 badge and updated architecture stats (18 agents, 6 tiers, validation rate).</div>
            <div class="component-demo">
                <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); border-radius: 12px;">
                    <h1 style="color: #2d3748; font-size: 1.8em; margin-bottom: 10px;">
                        E2I Causal Analytics Dashboard <span class="version-badge">V4.1</span>
                    </h1>
                    <div style="color: #718096; font-size: 1.1em; margin-bottom: 5px;">AI Agent Insights - Real-time Causal Intelligence</div>
                    <div class="architecture-summary">
                        <div class="arch-stat"><div class="arch-stat-value">18</div><div class="arch-stat-label">Active Agents</div></div>
                        <div class="arch-stat"><div class="arch-stat-value">6</div><div class="arch-stat-label">Tiers</div></div>
                        <div class="arch-stat"><div class="arch-stat-value">142</div><div class="arch-stat-label">Causal Paths</div></div>
                        <div class="arch-stat"><div class="arch-stat-value">91%</div><div class="arch-stat-label">Validation Rate</div></div>
                    </div>
                </div>
            </div>
        

            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-label">System Health</div>
                    <div class="stat-value">84%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Total Patients Covered</div>
                    <div class="stat-value">1.2M</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">HCP Engagement Rate</div>
                    <div class="stat-value">87%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Model Performance</div>
                    <div class="stat-value">0.82</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Trigger Precision</div>
                    <div class="stat-value">42%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Action Rate</div>
                    <div class="stat-value">52%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Active Users</div>
                    <div class="stat-value">2,341</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Active Agents</div>
                    <div class="stat-value">8/8</div>
                </div>
            </div>

            <!-- Core Capabilities -->
            <div class="visualization-container">
                <div class="viz-title">üíé Core System Capabilities</div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">üî¨ Causal Inference Engine</span>
                            <span class="metric-status status-green">Active</span>
                        </div>
                        <div class="metric-value">47 Chains</div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Core Capability</div>
                            <div class="causal-insight-text">
                                Moves beyond correlation to identify <span class="causal-effect">true cause-effect relationships</span> using DoWhy, EconML, CausalML, and NetworkX frameworks.
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">üìà Multiplier Discovery</span>
                            <span class="metric-status status-green">1.8x</span>
                        </div>
                        <div class="metric-value">Hidden Leverage</div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Core Capability</div>
                            <div class="causal-insight-text">
                                Identifies leverage points where <span class="causal-effect">1% improvements cascade to 1.8x impact</span> through the system.
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">üîÆ Predictive Prevention</span>
                            <span class="metric-status status-green">92%</span>
                        </div>
                        <div class="metric-value">7-14 Days</div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Core Capability</div>
                            <div class="causal-insight-text">
                                Forecasts degradation with <span class="causal-effect">92% confidence</span>, saving $5M annually in prevented losses.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workstream Integration -->
            <div class="visualization-container">
                <div class="viz-title">üîÑ Three-Workstream Integration</div>
                <div class="metrics-grid">
                    <div class="agent-card" style="border-left-color: #667eea;">
                        <div class="agent-header">
                            <div class="agent-icon impact">üìä</div>
                            <div>
                                <div class="agent-title">WS1: Data &amp; Model</div>
                                <div class="agent-subtitle">Foundation Layer</div>
                            </div>
                        </div>
                        <div class="insight-content">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div><strong>Coverage:</strong> 88%</div>
                                <div><strong>Quality:</strong> 98.5%</div>
                                <div><strong>Model AUC:</strong> 0.82</div>
                                <div><strong>Drift PSI:</strong> 0.18</div>
                            </div>
                        </div>
                    </div>

                    <div class="agent-card opportunity">
                        <div class="agent-header">
                            <div class="agent-icon gap">üéØ</div>
                            <div>
                                <div class="agent-title">WS2: HCP Triggers</div>
                                <div class="agent-subtitle">Engagement Layer</div>
                            </div>
                        </div>
                        <div class="insight-content">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div><strong>Precision:</strong> 42%</div>
                                <div><strong>Accept Rate:</strong> 58%</div>
                                <div><strong>Action Rate:</strong> 52%</div>
                                <div><strong>Journey Track:</strong> 67%</div>
                            </div>
                        </div>
                    </div>

                    <div class="agent-card predictive">
                        <div class="agent-header">
                            <div class="agent-icon drift">üí∞</div>
                            <div>
                                <div class="agent-title">WS3: Impact &amp; Platform</div>
                                <div class="agent-subtitle">Value Layer</div>
                            </div>
                        </div>
                        <div class="insight-content">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div><strong>Avg ROI:</strong> 4.3x</div>
                                <div><strong>Annual Value:</strong> $42M</div>
                                <div><strong>User Adoption:</strong> 84%</div>
                                <div><strong>System Health:</strong> 84%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="causal-insight" style="margin-top: 20px;">
                    <div class="causal-insight-title">Causal Discovery</div>
                    <div class="causal-insight-text" style="text-align: center;">
                        Each <span class="causal-effect">10% improvement in WS1 data quality</span> causes 
                        <span class="causal-effect">6% lift in WS2 acceptance</span>, resulting in 
                        <span class="causal-effect">14% increase in WS3 value capture</span>. 
                        This multiplicative effect drives our focus on foundational improvements.
                    </div>
                </div>
            </div>

            
            <div class="visualization-container">
                <div class="viz-title">Executive Intelligence Summary - Real-time Causal Impact Analysis</div>
                <div class="causal-insight">
                    <div class="causal-insight-title">Current System Status</div>
                    <div class="causal-insight-text">
                        The E2I Causal Analytics platform is operating at <span class="causal-effect">84% health with 8 active AI agents</span> processing 1.47M patient journeys across 2,341 active users. 
                        Real-time causal analysis has identified <span class="causal-effect">3 high-impact optimization vectors worth $23.7M in annual value</span>. 
                        The system's causal inference engine has traced 142 significant pathways, with the strongest chain showing: 
                        <span class="causal-effect">Data Quality (88%) ‚Üí Model Performance (0.82 AUC) ‚Üí Trigger Precision (42%) ‚Üí Action Rate (+12pp) ‚Üí Business Impact ($4.2M/quarter)</span>.
                    </div>
                </div>
                <div class="metric-chart">
                    <canvas id="overviewChart"></canvas>
                </div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Data-to-Value Pipeline</span>
                        <span class="metric-status status-green">OPTIMIZED</span>
                    </div>
                    <div class="metric-value">3.2x ROI</div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Intelligence Finding</div>
                        <div class="causal-insight-text">
                            DoWhy structural analysis reveals <span class="causal-effect">optimal configuration at 3 sources</span> - 4th source adds only 3% marginal value. 
                            Cross-source matching is the hidden multiplier: <span class="causal-effect">1% improvement ‚Üí 1.8x cascade effect</span> through journey completeness mediation.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Model-to-Impact Bridge</span>
                        <span class="metric-status status-yellow">OPPORTUNITY</span>
                    </div>
                    <div class="metric-value">58% ‚Üí 75%</div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Intelligence Finding</div>
                        <div class="causal-insight-text">
                            Causal Forests identify <span class="causal-effect">explanation quality as primary lever</span>. SHAP visualization alone drives +25% acceptance. 
                            Combined with contextual patient history: <span class="causal-effect">multiplicative effect yields +35% total lift</span>.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Fairness & Trust Nexus</span>
                        <span class="metric-status status-green">MONITORED</span>
                    </div>
                    <div class="metric-value">4.2pp gap</div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Intelligence Finding</div>
                        <div class="causal-insight-text">
                            DiD analysis: <span class="causal-effect">South region gap causes 70% of fairness degradation</span> ‚Üí 15% trust decline ‚Üí 6pp acceptance drop. 
                            Targeted acquisition yields <span class="causal-effect">3x ROI through trust restoration pathway</span>.
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="visualization-container">
                <div class="viz-title">Primary Causal Value Chains - Live Tracking</div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Chain 1: Data Quality Impact</span>
                            <span class="metric-status status-green">ACTIVE</span>
                        </div>
                        <div class="causal-chain">
                            <div class="chain-node">Data Lag -5d</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">+0.04 AUC</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">+6pp Precision</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">+$2.1M/quarter</div>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-text">
                                <span class="causal-effect">Confidence: 95%</span> | Method: Instrumental Variables | Time to Impact: 30 days
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Chain 2: User Experience</span>
                            <span class="metric-status status-green">HIGH ROI</span>
                        </div>
                        <div class="causal-chain">
                            <div class="chain-node">SHAP UI</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">+25% Accept</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">+14.5pp Action</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">+$10.5M/year</div>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-text">
                                <span class="causal-effect">Confidence: 88%</span> | Method: A/B Testing + DML | Time to Impact: 14 days
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Chain 3: Coverage Equity</span>
                            <span class="metric-status status-yellow">IN PROGRESS</span>
                        </div>
                        <div class="causal-chain">
                            <div class="chain-node">South +18pp</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">-8pp Fairness</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">+15% Trust</div>
                            <div class="chain-arrow">‚Üí</div>
                            <div class="chain-node">+$8M captured</div>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-text">
                                <span class="causal-effect">Confidence: 92%</span> | Method: Causal Forests | Time to Impact: 45 days
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ü§ñ AI Agent Insights Tab -->
        <div id="agent-insights" class="workstream-content">
            <!-- Executive AI Brief -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üéØ</div>
                    <div>
                        <div class="agent-title">Executive AI Brief</div>
                        <div class="agent-subtitle">Orchestrator Agent ‚Ä¢ Real-time synthesis at 09:47 AM</div>
                    </div>
                </div>
                <div class="insight-content">
                    <p><strong>Executive Summary:</strong> The multi-agent system has completed 47 analysis cycles in the last 24 hours, identifying three convergent opportunities with exceptional ROI profiles.</p>
                    <br>
                    <p>1. <strong>System Intelligence Status:</strong> 8/8 agents active, 142 causal paths analyzed, $23.7M value identified, 91% confidence level.</p>
                    <br>
                    <p>2. <strong>Critical Finding:</strong> User experience interventions offer 3x higher returns than data acquisition, contrary to initial hypotheses.</p>
                    <br>
                    <p>3. <strong>Automated Actions:</strong> System has initiated 4 corrective actions and queued 3 high-confidence experiments for validation.</p>
                </div>
            </div>
            
            <!-- Priority Actions with ROI -->
            <div class="agent-card opportunity">
                <div class="agent-header">
                    <div class="agent-icon gap">üìà</div>
                    <div>
                        <div class="agent-title">Priority Actions by ROI</div>
                        <div class="agent-subtitle">Gap Analyzer Agent ‚Ä¢ Impact-weighted recommendations</div>
                    </div>
                </div>
                <div class="insight-content">
                    <div class="action-item">
                        <span class="action-priority priority-high">HIGH</span>
                        <div style="flex: 1;">
                            <strong>Deploy Enhanced SHAP Explanations</strong>
                            <span class="roi-badge">ROI: 8.2x</span>
                            <br>
                            <span style="color: #718096; font-size: 0.9em;">
                                Implement top-5 feature visualization in trigger UI. Expected: +25% acceptance rate ‚Üí +14.5pp action rate ‚Üí $10.5M annual value. Implementation: 2 weeks.
                            </span>
                        </div>
                    </div>
                    
                    <div class="action-item">
                        <span class="action-priority priority-high">HIGH</span>
                        <div style="flex: 1;">
                            <strong>South Region Data Acquisition</strong>
                            <span class="roi-badge">ROI: 6.4x</span>
                            <br>
                            <span style="color: #718096; font-size: 0.9em;">
                                Partner with 3 regional health systems. Expected: +18% coverage ‚Üí -8pp fairness gap ‚Üí $8M captured value. Timeline: 4-6 weeks.
                            </span>
                        </div>
                    </div>
                    
                    <div class="action-item">
                        <span class="action-priority priority-medium">MEDIUM</span>
                        <div style="flex: 1;">
                            <strong>Implement Monthly Model Retraining</strong>
                            <span class="roi-badge">ROI: 4.1x</span>
                            <br>
                            <span style="color: #718096; font-size: 0.9em;">
                                PSI trending toward threshold (0.18‚Üí0.25). Automated monthly retraining prevents -0.05 AUC degradation worth $5M. Cost: $1.2M annually.
                            </span>
                        </div>
                    </div>
                    
                    <div class="action-item">
                        <span class="action-priority priority-low">LOW</span>
                        <div style="flex: 1;">
                            <strong>Optimize 4th Data Source Integration</strong>
                            <span class="roi-badge">ROI: 1.3x</span>
                            <br>
                            <span style="color: #718096; font-size: 0.9em;">
                                Current 3% marginal gain below cost threshold. Recommend redirecting resources to cross-source matching improvement instead.
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Causal Chain Analysis -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon impact">‚ö°</div>
                    <div>
                        <div class="agent-title">Active Causal Chains</div>
                        <div class="agent-subtitle">Causal Impact Agent ‚Ä¢ Live propagation tracking</div>
                    </div>
                </div>
                <div class="insight-content">
                    <div class="causal-chain">
                        <div class="chain-node">Data Lag 12d</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-effect">+0.04 AUC</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-node">Model: 0.82</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-effect">+20pp</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-node">Precision: 42%</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-effect">+12pp</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-node">Action Rate ‚Üë</div>
                    </div>
                    
                    <div class="causal-chain">
                        <div class="chain-node">South Gap 18pp</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-effect">-8pp fairness</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-node">Trust ‚Üì15%</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-effect">-6pp accept</div>
                        <div class="chain-arrow">‚Üí</div>
                        <div class="chain-node">Impact -$8M</div>
                    </div>
                    
                    <p style="margin-top: 15px; padding: 10px; background: #f7fafc; border-radius: 8px;">
                        <strong>Multiplier Discovery:</strong> Cross-source match rate has hidden leverage‚Äîeach 1% improvement causes 1.8% journey tracking improvement via completeness mediation. Currently underexploited.
                    </p>
                </div>
            </div>
            
            <!-- Predictive Alerts -->
            <div class="agent-card predictive">
                <div class="agent-header">
                    <div class="agent-icon drift">‚ö†Ô∏è</div>
                    <div>
                        <div class="agent-title">Predictive Alerts</div>
                        <div class="agent-subtitle">Drift Monitor Agent ‚Ä¢ 7-day forecast</div>
                    </div>
                </div>
                <div class="insight-content">
                    <div style="background: #fff5f5; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #fc8181;">
                        <strong style="color: #742a2a;">üî¥ Critical: Feature Drift Acceleration Detected</strong><br>
                        <span style="color: #4a5568;">PSI will exceed threshold (0.25) in 9 days at current rate. Root cause: Seasonal pattern (0.15 baseline) + data source format change (+0.10). Action: Schedule emergency retraining for Oct 17.</span>
                        <div class="confidence-indicator confidence-high" style="margin-top: 10px;">
                            Confidence: 92% (based on 6-week trend)
                        </div>
                    </div>
                    
                    <div style="background: #fffdf7; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #f6ad55;">
                        <strong style="color: #7c2d12;">üü° Warning: Trigger Precision Decline Projected</strong><br>
                        <span style="color: #4a5568;">Expect 3pp precision drop (42%‚Üí39%) by end of month due to label quality degradation (Œ∫: 0.72‚Üí0.68). Preventive action: Label quality workshop scheduled Oct 12.</span>
                        <div class="confidence-indicator confidence-medium" style="margin-top: 10px;">
                            Confidence: 78% (heterogeneous effects detected)
                        </div>
                    </div>
                    
                    <div class="prediction-timeline">
                        <div class="timeline-item">
                            <div class="timeline-date">Today</div>
                            <div class="timeline-value">PSI: 0.18</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Oct 15</div>
                            <div class="timeline-value" style="color: #f6ad55;">PSI: 0.22</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Oct 17</div>
                            <div class="timeline-value" style="color: #fc8181;">PSI: 0.26 ‚ö†Ô∏è</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Post-Retrain</div>
                            <div class="timeline-value" style="color: #48bb78;">PSI: 0.08 ‚úì</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Experiment Recommendations -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon experiment">üß™</div>
                    <div>
                        <div class="agent-title">Causal Experiment Queue</div>
                        <div class="agent-subtitle">Experiment Designer Agent ‚Ä¢ A/B test recommendations</div>
                    </div>
                </div>
                <div class="insight-content">
                    <div class="experiment-card">
                        <div class="experiment-header">
                            <strong>Contextual Explanation Depth</strong>
                            <span class="experiment-status status-proposed">PROPOSED</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <strong style="color: #667eea;">Treatment:</strong><br>
                                Show top-5 SHAP features with patient context<br>
                                <strong style="color: #667eea;">Control:</strong><br>
                                Current confidence scores only
                            </div>
                            <div>
                                <strong style="color: #667eea;">Expected Lift:</strong> +25% acceptance<br>
                                <strong style="color: #667eea;">Sample Size:</strong> 500 HCPs<br>
                                <strong style="color: #667eea;">Duration:</strong> 2 weeks<br>
                                <strong style="color: #667eea;">Power:</strong> 85% to detect 5pp difference
                            </div>
                        </div>
                    </div>
                    
                    <div class="experiment-card">
                        <div class="experiment-header">
                            <strong>Proactive vs Reactive Alerts</strong>
                            <span class="experiment-status status-active">ACTIVE - Day 4/14</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <strong style="color: #667eea;">Treatment:</strong><br>
                                Predictive alerts 14 days before event<br>
                                <strong style="color: #667eea;">Control:</strong><br>
                                Standard reactive triggers
                            </div>
                            <div>
                                <strong style="color: #48bb78;">Interim Results:</strong><br>
                                Treatment: 61% action rate (+9pp)<br>
                                Control: 52% action rate<br>
                                <strong style="color: #48bb78;">Significance:</strong> p=0.03
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Segment-Specific Optimizations -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon" style="background: linear-gradient(135deg, #9F7AEA 0%, #667eea 100%);">üé®</div>
                    <div>
                        <div class="agent-title">Heterogeneous Treatment Effects</div>
                        <div class="agent-subtitle">Heterogeneous Optimizer Agent ‚Ä¢ Personalization insights</div>
                    </div>
                </div>
                <div class="insight-content">
                    <div id="heterogeneousHeatmap"></div>
                    
                    <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="padding: 15px; background: #f7fafc; border-radius: 10px;">
                            <strong>üè• Specialists Segment</strong><br>
                            <span style="color: #667eea; font-size: 1.2em; font-weight: bold;">+22pp avg uplift</span><br>
                            <span style="color: #718096; font-size: 0.9em;">High variance (15-28pp). Recommend personalized thresholds. Oncologists respond 2x better to genomic insights.</span>
                        </div>
                        
                        <div style="padding: 15px; background: #f7fafc; border-radius: 10px;">
                            <strong>üë®‚Äç‚öïÔ∏è PCPs Segment</strong><br>
                            <span style="color: #667eea; font-size: 1.2em; font-weight: bold;">+7pp avg uplift</span><br>
                            <span style="color: #718096; font-size: 0.9em;">Consistent but lower response. Need simplified explanations. Focus on time-saving aspects.</span>
                        </div>
                        
                        <div style="padding: 15px; background: #f7fafc; border-radius: 10px;">
                            <strong>üìä High Volume HCPs</strong><br>
                            <span style="color: #667eea; font-size: 1.2em; font-weight: bold;">+28pp avg uplift</span><br>
                            <span style="color: #718096; font-size: 0.9em;">Best ROI segment. Prioritize resource allocation here. Enable batch processing features.</span>
                        </div>
                        
                        <div style="padding: 15px; background: #fff5f5; border-radius: 10px;">
                            <strong>üåç Rural Practitioners</strong><br>
                            <span style="color: #fc8181; font-size: 1.2em; font-weight: bold;">+3pp avg uplift</span><br>
                            <span style="color: #718096; font-size: 0.9em;">Underperforming due to data gaps. Fix South region coverage to unlock +15pp potential.</span>
                        </div>
                    </div>
                    
                    <p style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #f6f9fc 0%, #e9f3ff 100%); border-radius: 10px;">
                        <strong>üéØ Optimal Resource Allocation:</strong> Shift 30% of effort from PCPs to High Volume segment. Expected gain: +7pp overall performance, worth $5.1M annually. Implementation: Adjust trigger thresholds and rep routing by Oct 15.
                    </p>
                </div>
            </div>
            
            <!-- Resource Reallocation Matrix -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon" style="background: linear-gradient(135deg, #4ecdc4 0%, #44a8a0 100%);">üí∞</div>
                    <div>
                        <div class="agent-title">Resource Optimization Matrix</div>
                        <div class="agent-subtitle">Resource Optimizer Agent ‚Ä¢ ROI-driven reallocation</div>
                    </div>
                </div>
                <div class="insight-content">
                    <div id="resourceAllocationSankey"></div>
                    
                    <div style="margin-top: 20px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f7fafc;">
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Resource</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Current</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Optimal</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">‚àÜ Value</th>
                                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;"><strong>Data Sources</strong></td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">4 sources</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">3 sources</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; color: #48bb78;">+$1.2M</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Drop 4th, improve matching</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;"><strong>Model Complexity</strong></td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Deep ensemble</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Maintain</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">-</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Worth the complexity</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;"><strong>Field Capacity</strong></td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Top 5%</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Top 5%</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">-</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Optimal (K>10% causes fatigue)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;"><strong>UI Investment</strong></td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Basic</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Enhanced</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0; color: #48bb78;">+$10.5M</td>
                                    <td style="padding: 10px; border-bottom: 1px solid #e2e8f0;">Add SHAP viz ASAP</td>
                                </tr>
                                <tr style="background: #f7fafc;">
                                    <td style="padding: 10px; font-weight: bold;">Total Impact</td>
                                    <td style="padding: 10px;">-</td>
                                    <td style="padding: 10px;">-</td>
                                    <td style="padding: 10px; color: #667eea; font-weight: bold;">+$11.7M</td>
                                    <td style="padding: 10px;">Execute by Nov 1</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- System Health Score -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">üìä</div>
                    <div>
                        <div class="agent-title">E2I System Health Score</div>
                        <div class="agent-subtitle">Health Score Agent ‚Ä¢ Composite assessment</div>
                    </div>
                </div>
                <div class="insight-content">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em; font-weight: bold; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            84/100
                        </div>
                        <div style="color: #718096;">Overall System Health</div>
                    </div>
                    
                    <div id="healthRadarChart"></div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
                        <div style="padding: 15px; background: #f7fafc; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>Data Quality</strong>
                                <span style="color: #48bb78; font-weight: bold;">88/100 ‚úì</span>
                            </div>
                            <div style="height: 4px; background: #e2e8f0; border-radius: 2px; margin-top: 8px;">
                                <div style="width: 88%; height: 100%; background: #48bb78; border-radius: 2px;"></div>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; background: #f7fafc; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>Model Performance</strong>
                                <span style="color: #48bb78; font-weight: bold;">82/100 ‚úì</span>
                            </div>
                            <div style="height: 4px; background: #e2e8f0; border-radius: 2px; margin-top: 8px;">
                                <div style="width: 82%; height: 100%; background: #48bb78; border-radius: 2px;"></div>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; background: #f7fafc; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>Trigger Effectiveness</strong>
                                <span style="color: #f6ad55; font-weight: bold;">78/100 ‚ö†</span>
                            </div>
                            <div style="height: 4px; background: #e2e8f0; border-radius: 2px; margin-top: 8px;">
                                <div style="width: 78%; height: 100%; background: #f6ad55; border-radius: 2px;"></div>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; background: #f7fafc; border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <strong>Business Impact</strong>
                                <span style="color: #48bb78; font-weight: bold;">86/100 ‚úì</span>
                            </div>
                            <div style="height: 4px; background: #e2e8f0; border-radius: 2px; margin-top: 8px;">
                                <div style="width: 86%; height: 100%; background: #48bb78; border-radius: 2px;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #fff5f5 0%, #fffdf7 100%); border-radius: 10px;">
                        <strong>üéØ Key Improvement Vector:</strong> Trigger Effectiveness is the weakest link. Focus on acceptance rate (58%‚Üí75%) and false alert reduction (58%‚Üí40%) for +8 point health score improvement.
                    </div>
                </div>
            </div>
            
            <!-- Automated Decision Log -->
            <div class="agent-card">
                <div class="agent-header">
                    <div class="agent-icon" style="background: linear-gradient(135deg, #805ad5 0%, #667eea 100%);">üìù</div>
                    <div>
                        <div class="agent-title">Automated Agent Actions</div>
                        <div class="agent-subtitle">Orchestrator ‚Ä¢ Last 24 hours</div>
                    </div>
                </div>
                <div class="insight-content">
                    <div style="max-height: 300px; overflow-y: auto;">
                        <div style="padding: 10px; background: #f7fafc; border-radius: 8px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <strong>üîÑ Model Retrain Triggered</strong>
                                <span style="color: #718096; font-size: 0.85em;">Oct 8, 03:00 AM</span>
                            </div>
                            <div style="color: #4a5568; font-size: 0.9em; margin-top: 5px;">
                                PSI reached 0.20 threshold. Automated retraining initiated. New model deployed with AUC 0.82 (maintained).
                            </div>
                        </div>
                        
                        <div style="padding: 10px; background: #f7fafc; border-radius: 8px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <strong>üìß Alert Sent: South Region Gap</strong>
                                <span style="color: #718096; font-size: 0.85em;">Oct 7, 06:00 PM</span>
                            </div>
                            <div style="color: #4a5568; font-size: 0.9em; margin-top: 5px;">
                                Fairness gap exceeded 5pp threshold. Escalation to Regional Director. Meeting scheduled Oct 10.
                            </div>
                        </div>
                        
                        <div style="padding: 10px; background: #f7fafc; border-radius: 8px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <strong>‚ö° Trigger Threshold Adjusted</strong>
                                <span style="color: #718096; font-size: 0.85em;">Oct 7, 11:30 AM</span>
                            </div>
                            <div style="color: #4a5568; font-size: 0.9em; margin-top: 5px;">
                                High Volume HCP segment threshold lowered 0.65‚Üí0.60 based on heterogeneous effect analysis. Expected +3pp precision.
                            </div>
                        </div>
                        
                        <div style="padding: 10px; background: #f7fafc; border-radius: 8px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between;">
                                <strong>üß™ A/B Test Launched</strong>
                                <span style="color: #718096; font-size: 0.85em;">Oct 6, 09:00 AM</span>
                            </div>
                            <div style="color: #4a5568; font-size: 0.9em; margin-top: 5px;">
                                Proactive alerts experiment started. 250 HCPs in treatment, 250 in control. Duration: 14 days.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- üîß ML Foundation Tab -->
        <div id="ml-foundation" class="workstream-content">
            <div class="component-title">üîß ML Foundation Tab </div>
            <div class="component-description">Tier 0 visibility: QC Gate status, ML pipeline flow, 7 agent status cards, training progress, SHAP chart.</div>
            <div class="component-demo">
                <div class="sub-section-title">QC Gate Status</div>
                <div class="qc-gate">
                    <div class="qc-icon">‚úì</div>
                    <div class="qc-info"><h3>QC Gate: PASSED</h3><p>All Great Expectations validations passed. Training pipeline unblocked.</p></div>
                    <div style="margin-left: auto; text-align: right;">
                        <div style="font-size: 0.9em; color: #718096;">Last check: 09:45 AM</div>
                        <div style="font-weight: 600; color: #10b981;">14/14 expectations met</div>
                    </div>
                </div>
                <div class="qc-gate blocked">
                    <div class="qc-icon">‚úó</div>
                    <div class="qc-info"><h3>QC Gate: BLOCKED (Example)</h3><p>2 expectations failed: null_rate_critical, schema_validation</p></div>
                </div>
                
                <div class="sub-section-title">Pipeline Flow (6 Stages)</div>
                <div class="pipeline-flow">
                    <div class="pipeline-step complete"><div class="pipeline-icon">üìã</div><div class="pipeline-label">Scope Definer</div><div class="pipeline-status">Complete</div></div>
                    <div class="pipeline-connector complete"></div>
                    <div class="pipeline-step complete"><div class="pipeline-icon">üîç</div><div class="pipeline-label">Data Preparer</div><div class="pipeline-status">QC Passed</div></div>
                    <div class="pipeline-connector complete"></div>
                    <div class="pipeline-step complete"><div class="pipeline-icon">üéØ</div><div class="pipeline-label">Model Selector</div><div class="pipeline-status">XGBoost</div></div>
                    <div class="pipeline-connector complete"></div>
                    <div class="pipeline-step current"><div class="pipeline-icon">‚öôÔ∏è</div><div class="pipeline-label">Model Trainer</div><div class="pipeline-status" style="color: #667eea;">Training...</div></div>
                    <div class="pipeline-connector"></div>
                    <div class="pipeline-step pending"><div class="pipeline-icon">üìä</div><div class="pipeline-label">Feature Analyzer</div><div class="pipeline-status">Pending</div></div>
                    <div class="pipeline-connector"></div>
                    <div class="pipeline-step pending"><div class="pipeline-icon">üöÄ</div><div class="pipeline-label">Model Deployer</div><div class="pipeline-status">Pending</div></div>
                </div>
                
                <div class="sub-section-title">Tier 0 Agent Status (7 Agents)</div>
                <div class="agent-grid">
                    <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üìã</div><div class="agent-mini-info"><h4>scope_definer</h4><span>SLA: 5s ‚Ä¢ Last: 2.1s</span></div><div class="agent-status-dot active"></div></div>
                    <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üîç</div><div class="agent-mini-info"><h4>data_preparer</h4><span>SLA: 60s ‚Ä¢ Last: 34s</span></div><div class="agent-status-dot active"></div></div>
                    <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üéØ</div><div class="agent-mini-info"><h4>model_selector</h4><span>SLA: 120s ‚Ä¢ Last: 85s</span></div><div class="agent-status-dot active"></div></div>
                    <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">‚öôÔ∏è</div><div class="agent-mini-info"><h4>model_trainer</h4><span>In progress...</span></div><div class="agent-status-dot idle"></div></div>
                    <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #fae8ff;">üìä</div><div class="agent-mini-info"><h4>feature_analyzer</h4><span>Hybrid ‚Ä¢ SHAP+LLM</span></div><div class="agent-status-dot active"></div></div>
                    <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üöÄ</div><div class="agent-mini-info"><h4>model_deployer</h4><span>SLA: 30s ‚Ä¢ Idle</span></div><div class="agent-status-dot active"></div></div>
                    <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üëÅÔ∏è</div><div class="agent-mini-info"><h4>observability_connector</h4><span>SLA: 100ms ‚Ä¢ Opik</span></div><div class="agent-status-dot active"></div></div>
                </div>
                
                <div class="sub-section-title">Training Progress & Metrics</div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header"><span class="metric-title">Current Training Run</span><span class="metric-status status-yellow">IN PROGRESS</span></div>
                        <div class="metric-value">Epoch 47/100</div>
                        <div style="margin-top: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;"><span>Progress</span><span>47%</span></div>
                            <div style="height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                                <div style="width: 47%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2);"></div>
                            </div>
                        </div>
                        <div style="margin-top: 12px; font-size: 0.85em; color: #4a5568;">
                            <div>Model: XGBoost Classifier</div>
                            <div>Split: 70/15/15 (Chronological)</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header"><span class="metric-title">Validation Metrics</span><span class="metric-status status-green">IMPROVING</span></div>
                        <div class="metric-value">0.823 AUC</div>
                        <div style="margin-top: 10px;">
                            <table style="width: 100%; font-size: 0.85em;">
                                <tr><td>AUC-ROC</td><td style="text-align: right; font-weight: 600;">0.823</td></tr>
                                <tr><td>PR-AUC</td><td style="text-align: right; font-weight: 600;">0.714</td></tr>
                                <tr><td>F1 Score</td><td style="text-align: right; font-weight: 600;">0.689</td></tr>
                            </table>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header"><span class="metric-title">Data Quality Report</span><span class="metric-status status-green">14/14 PASSED</span></div>
                        <div style="margin-top: 12px; font-size: 0.85em;">
                            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e2e8f0;"><span>Completeness</span><span style="color: #10b981; font-weight: 600;">98.5% ‚úì</span></div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e2e8f0;"><span>Validity</span><span style="color: #10b981; font-weight: 600;">99.2% ‚úì</span></div>
                            <div style="display: flex; justify-content: space-between; padding: 5px 0;"><span>No Leakage</span><span style="color: #10b981; font-weight: 600;">Verified ‚úì</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="sub-section-title">üìä Feature Analyzer: Top SHAP Values</div>
                <div style="height: 300px; background: #f7fafc; border-radius: 8px; padding: 15px;">
                    <canvas id="shapChart"></canvas>
                </div>
            </div>
        </div>

        <!-- üóÉÔ∏è WS1: Data Quality Tab -->
        <div id="ws1-data" class="workstream-content">
            <div class="visualization-container">
                <div class="viz-title">Data Coverage & Quality Metrics</div>
                <div id="dataQualityHeatmap"></div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Source Coverage - Patients</span>
                        <span class="metric-status status-green">82%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="patientCoverageChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            DoWhy regression discontinuity: <span class="causal-effect">70% coverage threshold causes step-change</span> in model performance (+0.05 AUC). Currently above threshold.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Geographic Consistency</span>
                        <span class="metric-status status-yellow">18pp gap</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="geographicChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Causal Forests reveal <span class="causal-effect">South region gap causes 8pp fairness degradation</span>. Targeted data acquisition would yield 3x ROI.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Data Lag (Median)</span>
                        <span class="metric-status status-green">12 days</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="dataLagChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            IV analysis: <span class="causal-effect">Lag >30 days causes 25% reduction</span> in acute condition detection. Current lag optimal for mixed use cases.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Cross-source Match Rate</span>
                        <span class="metric-status status-green">88%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="matchRateChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Mediation analysis: <span class="causal-effect">10% match improvement causes 18% better journey tracking</span> via completeness pathway.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Completeness Pass Rate</span>
                        <span class="metric-status status-green">98.5%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="completenessChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            DML analysis: <span class="causal-effect">Each 1% improvement reduces false negatives by 2%</span>. Diminishing returns above 99%.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Stacking Lift - Patients</span>
                        <span class="metric-status status-green">+24%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="stackingLiftChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            G-computation: <span class="causal-effect">3rd source adds 15% causal lift, 4th only 3%</span>. Recommend optimizing existing sources over adding new.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ü§ñ WS1: ML & Model Tab -->
        <div id="ws1-ml" class="workstream-content">
            <div class="visualization-container">
                <div class="viz-title">Model Performance & Drift Analysis</div>
                <div id="modelPerformanceChart"></div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">ROC-AUC</span>
                        <span class="metric-status status-green">0.82</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="rocChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Metalearners: <span class="causal-effect">Balanced sampling causes +0.08 AUC</span>, ensemble adds +0.04. Interaction effect minimal (+0.02).
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Feature Drift (PSI)</span>
                        <span class="metric-status status-yellow">0.18</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="driftChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Causal Forest: <span class="causal-effect">Seasonal patterns cause 0.15 PSI baseline</span>, data changes add 0.10. Monthly retraining optimal.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Label Quality (IAA)</span>
                        <span class="metric-status status-green">Œ∫=0.72</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="iaaChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Causal analysis: <span class="causal-effect">Guidelines cause Œ∫+0.3, training adds +0.15</span>. Combined effect less than sum (Œ∫+0.35).
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Recall@Top-5%</span>
                        <span class="metric-status status-green">38%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="recallTopKChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            PolicyTree: <span class="causal-effect">K=5% causes optimal resource use</span>. K>10% causes fatigue, reducing effectiveness by 30%.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">SHAP Coverage</span>
                        <span class="metric-status status-green">85%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="shapCoverageChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Survey experiment: <span class="causal-effect">Top-5 SHAP >80% causes 35% trust increase</span>. No additional benefit beyond 90%.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Fairness Gap (ŒîRecall)</span>
                        <span class="metric-status status-green">4.2pp</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="fairnessChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            FairLearner: <span class="causal-effect">Historical bias causes 15pp gap</span>. Reweighting reduces to 5pp with -0.01 AUC trade-off.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- üéØ WS2: Triggers Tab -->
        <div id="ws2" class="workstream-content">
            <div class="visualization-container">
                <div class="viz-title">Trigger Performance & Governance</div>
                <div id="triggerFlowChart"></div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Precision (Trigger)</span>
                        <span class="metric-status status-green">42%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="precisionChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Causal Forests: <span class="causal-effect">Recent interaction causes +20pp precision</span>, specialty match adds +15pp. Combined effect multiplicative.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Lead Time</span>
                        <span class="metric-status status-green">16 days</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="leadTimeChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            DML analysis: <span class="causal-effect">14-21 day window causes 35% better outcomes</span>. Urgency modulates effect by ¬±7 days.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Acceptance Rate</span>
                        <span class="metric-status status-yellow">58%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="acceptanceChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            A/B analysis: <span class="causal-effect">Explanations cause +25% acceptance</span>, confidence scores add +10%. UI redesign potential +15%.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Action Rate Uplift</span>
                        <span class="metric-status status-green">+12pp</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="upliftChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            RCT analysis: <span class="causal-effect">True causal effect +12pp after bias control</span>. NBA triggers +9pp, pure alerts +3pp.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">False Alert Rate</span>
                        <span class="metric-status status-yellow">58%</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="falseAlertChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Context analysis: <span class="causal-effect">Patient history reduces false alerts by 30%</span>, HCP preferences by 15%. Stack for 40% reduction.
                        </div>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Time-to-Release</span>
                        <span class="metric-status status-green">8 days</span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="ttrChart"></canvas>
                    </div>
                    <div class="causal-insight">
                        <div class="causal-insight-title">Causal Finding</div>
                        <div class="causal-insight-text">
                            Process mining: <span class="causal-effect">Automated testing causes -5 days TTR</span>, parallel review adds -3 days. Bottleneck: approval.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- üìà WS3: Impact Tab -->
        <div id="ws3" class="workstream-content">
            <div class="visualization-container">
                <div class="viz-title">Business Impact & Adoption Metrics</div>
                <div id="impactSankeyChart"></div>
            </div>
            
            <!-- General KPIs Section -->
            <div class="visualization-container">
                <div class="viz-title">üìä General Platform KPIs</div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Active Users (MAU)</span>
                            <span class="metric-status status-green">2,341</span>
                        </div>
                        <div class="metric-chart">
                            <canvas id="mauChart"></canvas>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Causal Finding</div>
                            <div class="causal-insight-text">
                                Retention analysis: <span class="causal-effect">Personalized onboarding causes +40% MAU</span>, gamification adds +15%. Synergy effect +8%.
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">HCP Coverage</span>
                            <span class="metric-status status-green">78%</span>
                        </div>
                        <div class="metric-chart">
                            <canvas id="hcpCoverageChart"></canvas>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Causal Finding</div>
                            <div class="causal-insight-text">
                                Network effects: <span class="causal-effect">Territory optimization causes +25% coverage</span>, peer influence adds +10% via social proof.
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Patient Touch Rate</span>
                            <span class="metric-status status-yellow">48%</span>
                        </div>
                        <div class="metric-chart">
                            <canvas id="patientTouchChart"></canvas>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Causal Finding</div>
                            <div class="causal-insight-text">
                                DML: <span class="causal-effect">EMR integration causes 55% reach improvement</span>. Alerts alone achieve only 15%. Integration critical.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Remibrutinib Brand KPIs -->
            <div class="visualization-container">
                <div class="viz-title" style="background: linear-gradient(90deg, #9F7AEA 0%, #667eea 100%); color: white; padding: 10px; border-radius: 8px;">üíä Remibrutinib - Brand Specific KPIs</div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">AH Uncontrolled Patients Identified</span>
                            <span class="metric-status status-green">62%</span>
                        </div>
                        <div class="metric-chart">
                            <canvas id="remiChart"></canvas>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Causal Finding</div>
                            <div class="causal-insight-text">
                                Synthetic control: <span class="causal-effect">Lab integration causes +28% identification</span>, ML adds +15% incremental. Total effect +38%.
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Intent-to-Prescribe (Œî vs baseline)</span>
                            <span class="metric-status status-green">+10pp</span>
                        </div>
                        <div class="metric-chart">
                            <canvas id="remiItpChart"></canvas>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Causal Finding</div>
                            <div class="causal-insight-text">
                                ATU survey analysis: <span class="causal-effect">Targeted education causes +6pp ITP lift</span>, patient success stories add +4pp. Combined effect multiplicative.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Fabhalta Brand KPIs -->
            <div class="visualization-container">
                <div class="viz-title" style="background: linear-gradient(90deg, #48BB78 0%, #38A169 100%); color: white; padding: 10px; border-radius: 8px;">üß¨ Fabhalta - Brand Specific KPIs</div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Suspected PNH Patients Tested</span>
                            <span class="metric-status status-green">68%</span>
                        </div>
                        <div class="metric-chart">
                            <canvas id="fabhaltaTestChart"></canvas>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Causal Finding</div>
                            <div class="causal-insight-text">
                                DiD analysis: <span class="causal-effect">Flow cytometry alerts cause +35pp testing rate</span>, physician education adds +15pp. Total uplift +50pp vs baseline.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Kisqali Brand KPIs -->
            <div class="visualization-container">
                <div class="viz-title" style="background: linear-gradient(90deg, #ED8936 0%, #DD6B20 100%); color: white; padding: 10px; border-radius: 8px;">üéØ Kisqali - Brand Specific KPIs</div>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Priority Oncologists Reached</span>
                            <span class="metric-status status-green">82%</span>
                        </div>
                        <div class="metric-chart">
                            <canvas id="kisqaliReachChart"></canvas>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Causal Finding</div>
                            <div class="causal-insight-text">
                                Territory analysis: <span class="causal-effect">AI-optimized routing causes +22% reach</span>, peer referral network adds +10%. Combined coverage optimization.
                            </div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-title">Oncotype Dx-Guided Adoption</span>
                            <span class="metric-status status-green">+15pp</span>
                        </div>
                        <div class="metric-chart">
                            <canvas id="kisqaliChart"></canvas>
                        </div>
                        <div class="causal-insight">
                            <div class="causal-insight-title">Causal Finding</div>
                            <div class="causal-insight-text">
                                Heterogeneous effects: <span class="causal-effect">Oncotype Dx causes +15pp for suitable patients</span>, +3pp for others. Targeting key.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ö° Causal Analysis Tab -->
        <div id="causal" class="workstream-content">
            <div class="visualization-container">
                <div class="viz-title">Causal DAG - E2I Impact Pathways</div>
                <div id="causalDAG" class="causal-dag"></div>
            </div>
            
            <div class="visualization-container">
                <div class="viz-title">Heterogeneous Treatment Effects by Segment</div>
                <div id="heterogeneousEffects"></div>
            </div>
            
            <div class="visualization-container">
                <div class="viz-title">Causal Attribution Analysis</div>
                <div id="causalAttribution"></div>
            </div>
        </div>

        <!-- üîó Knowledge Graph Tab -->
        <div id="knowledge-graph" class="workstream-content">
            <div class="kg-main-grid">
                <div class="kg-graph-container">
                    <div class="kg-graph-toolbar">
                        <div class="kg-toolbar-group">
                            <span class="kg-toolbar-label">Layout:</span>
                            <select id="kg-layoutSelect">
                                <option value="dagre">DAG (Causal Flow)</option>
                                <option value="cose">Force-Directed</option>
                                <option value="breadthfirst">Hierarchical</option>
                                <option value="circle">Circular</option>
                            </select>
                        </div>

                        <div class="kg-toolbar-group">
                            <span class="kg-toolbar-label">Filter:</span>
                            <button class="kg-btn-secondary active" data-filter="all">All</button>
                            <button class="kg-btn-secondary" data-filter="Brand">Brands</button>
                            <button class="kg-btn-secondary" data-filter="KPI">KPIs</button>
                            <button class="kg-btn-secondary" data-filter="Agent">Agents</button>
                            <button class="kg-btn-secondary" data-filter="HCP">HCPs</button>
                            <button class="kg-btn-secondary" data-filter="Episode">Episodes</button>
                            <button class="kg-btn-secondary" data-filter="causal">Causal Only</button>
                        </div>

                        <div class="kg-toolbar-group">
                            <button class="kg-btn-primary" id="kg-refreshBtn">üîÑ Refresh</button>
                            <button class="kg-btn-secondary" id="kg-resetBtn">‚Ü©Ô∏è Reset View</button>
                            <button class="kg-btn-secondary" id="kg-fitBtn">üìê Fit</button>
                        </div>
                    </div>

                    <div id="kg-cy"></div>
                </div>

                <div class="kg-sidebar">
                    <div class="kg-card">
                        <div class="kg-card-title">üìä Graph Statistics</div>
                        <div class="kg-stats-grid">
                            <div class="kg-stat-item">
                                <div class="kg-stat-value" id="kg-nodeCount">0</div>
                                <div class="kg-stat-label">Nodes</div>
                            </div>
                            <div class="kg-stat-item">
                                <div class="kg-stat-value" id="kg-edgeCount">0</div>
                                <div class="kg-stat-label">Edges</div>
                            </div>
                            <div class="kg-stat-item">
                                <div class="kg-stat-value" id="kg-causalCount">0</div>
                                <div class="kg-stat-label">Causal Paths</div>
                            </div>
                            <div class="kg-stat-item">
                                <div class="kg-stat-value" id="kg-avgDegree">0</div>
                                <div class="kg-stat-label">Avg Degree</div>
                            </div>
                        </div>
                    </div>

                    <div class="kg-card">
                        <div class="kg-card-title">üé® Legend</div>
                        <div class="kg-legend-grid">
                            <div class="kg-legend-item">
                                <div class="kg-legend-dot" style="background: #667eea;"></div>
                                <span>Brand</span>
                            </div>
                            <div class="kg-legend-item">
                                <div class="kg-legend-dot" style="background: #48bb78;"></div>
                                <span>Region</span>
                            </div>
                            <div class="kg-legend-item">
                                <div class="kg-legend-dot" style="background: #f6ad55;"></div>
                                <span>KPI</span>
                            </div>
                            <div class="kg-legend-item">
                                <div class="kg-legend-dot" style="background: #fc8181;"></div>
                                <span>Agent</span>
                            </div>
                            <div class="kg-legend-item">
                                <div class="kg-legend-dot" style="background: #4fd1c5;"></div>
                                <span>Causal Variable</span>
                            </div>
                            <div class="kg-legend-item">
                                <div class="kg-legend-dot" style="background: #b794f4;"></div>
                                <span>Insight</span>
                            </div>
                        </div>

                        <div class="kg-edge-legend">
                            <div class="kg-edge-item">
                                <div class="kg-edge-line" style="background: #e53e3e;"></div>
                                <span>CAUSES (causal)</span>
                            </div>
                            <div class="kg-edge-item">
                                <div class="kg-edge-line" style="background: #dd6b20; border-style: dashed;"></div>
                                <span>AFFECTS (influence)</span>
                            </div>
                            <div class="kg-edge-item">
                                <div class="kg-edge-line" style="background: #38a169; border-style: dotted;"></div>
                                <span>CORRELATES</span>
                            </div>
                            <div class="kg-edge-item">
                                <div class="kg-edge-line" style="background: #3182ce;"></div>
                                <span>ANALYZES</span>
                            </div>
                        </div>
                    </div>

                    <div class="kg-card">
                        <div class="kg-card-title">üîç Selected Node</div>
                        <div class="kg-node-details" id="kg-nodeDetails">
                            <p style="color: #a1a1aa;">Click a node to see details</p>
                        </div>
                    </div>

                    <div class="kg-card">
                        <div class="kg-card-title">üîé Search Path</div>
                        <input type="text" class="kg-query-input" id="kg-searchInput" placeholder="Enter node name to highlight...">
                        <button class="kg-btn-primary" style="width: 100%;" id="kg-searchBtn">Find Connections</button>
                    </div>
                </div>
            </div>

            <div class="kg-architecture-section">
                <div class="kg-card">
                    <div class="kg-card-title">‚öôÔ∏è Hybrid RAG Query Flow</div>
                    <div class="kg-architecture-diagram">
<pre>
USER QUERY: "Why did Remibrutinib conversion drop in Midwest?"
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    HYBRID RETRIEVER ORCHESTRATOR                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ Query Analyzer  ‚îÇ ‚Üí ‚îÇ Parallel        ‚îÇ ‚Üí ‚îÇ Fusion + Rank   ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ (fastText NLP)  ‚îÇ   ‚îÇ Dispatch        ‚îÇ   ‚îÇ (RRF + Boost)   ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                      ‚îÇ                      ‚îÇ
          ‚ñº                      ‚ñº                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ <span class="kg-highlight-vector">SUPABASE</span>        ‚îÇ   ‚îÇ <span class="kg-highlight-fulltext">SUPABASE</span>        ‚îÇ   ‚îÇ <span class="kg-highlight-graph">FALKORDB</span>        ‚îÇ
‚îÇ <span class="kg-highlight-vector">pgvector</span>        ‚îÇ   ‚îÇ <span class="kg-highlight-fulltext">Full-Text</span>       ‚îÇ   ‚îÇ <span class="kg-highlight-graph">Graph</span>           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ insight_emb   ‚îÇ   ‚îÇ ‚Ä¢ causal_paths  ‚îÇ   ‚îÇ ‚Ä¢ MATCH path    ‚îÇ
‚îÇ ‚Ä¢ episodic_mem  ‚îÇ   ‚îÇ ‚Ä¢ agent_output  ‚îÇ   ‚îÇ ‚Ä¢ Cypher query  ‚îÇ
‚îÇ ‚Ä¢ procedural    ‚îÇ   ‚îÇ ‚Ä¢ triggers      ‚îÇ   ‚îÇ ‚Ä¢ Relationship  ‚îÇ
‚îÇ                 ‚îÇ   ‚îÇ                 ‚îÇ   ‚îÇ   traversal     ‚îÇ
‚îÇ Latency: ~50ms  ‚îÇ   ‚îÇ Latency: ~20ms  ‚îÇ   ‚îÇ Latency: ~100ms ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                      ‚îÇ                      ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    <span class="kg-highlight-fusion">RECIPROCAL RANK FUSION (RRF)</span>                             ‚îÇ
‚îÇ  Score = Œ£ (weight_i √ó 1/(k + rank_i))  for each source                     ‚îÇ
‚îÇ  + Graph Boost: √ó1.3 for causally-connected results                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                                 ‚ñº
                    RANKED CONTEXT ‚Üí LLM ‚Üí RESPONSE
</pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚úì Validation Tab -->
        <div id="validation" class="workstream-content">

            <div class="component-title">üìä Validation Tab <span class="gap-badge">New Tab</span></div>
            <div class="component-description">Dedicated view for causal validation results with summary statistics and detailed results table.</div>
            <div class="component-demo">
                <div class="sub-section-title">Validation Summary</div>
                <div class="metrics-row">
                    <div class="metric-mini proceed"><div class="metric-mini-label">Validated (Proceed)</div><div class="metric-mini-value">129</div><div style="font-size: 0.8em; color: #4a5568;">91% of estimates</div></div>
                    <div class="metric-mini review"><div class="metric-mini-label">Needs Review</div><div class="metric-mini-value">10</div><div style="font-size: 0.8em; color: #4a5568;">7% pending</div></div>
                    <div class="metric-mini block"><div class="metric-mini-label">Blocked</div><div class="metric-mini-value">3</div><div style="font-size: 0.8em; color: #4a5568;">2% failed</div></div>
                </div>
                <div class="sub-section-title">Recent Validation Results</div>
                <table class="kpi-table">
                    <thead><tr><th>ID</th><th>Treatment ‚Üí Outcome</th><th>ATE</th><th>Tests</th><th>E-value</th><th>Gate</th></tr></thead>
                    <tbody>
                        <tr><td>CP-00142</td><td>SHAP Display ‚Üí Acceptance</td><td>+25%</td><td><div class="test-indicators"><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span></div></td><td>2.8</td><td><span class="gate-status proceed">‚úì PROCEED</span></td></tr>
                        <tr><td>CP-00141</td><td>Data Lag ‚Üí Model AUC</td><td>+0.04</td><td><div class="test-indicators"><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span></div></td><td>3.2</td><td><span class="gate-status proceed">‚úì PROCEED</span></td></tr>
                        <tr><td>CP-00140</td><td>South Coverage ‚Üí Fairness</td><td>-8pp</td><td><div class="test-indicators"><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot warning"></span><span class="test-dot passed"></span><span class="test-dot skipped"></span></div></td><td>1.4</td><td><span class="gate-status review">‚ö† REVIEW</span></td></tr>
                        <tr><td>CP-00139</td><td>Rep Visit ‚Üí Scripts</td><td>+12%</td><td><div class="test-indicators"><span class="test-dot failed"></span><span class="test-dot passed"></span><span class="test-dot failed"></span><span class="test-dot passed"></span><span class="test-dot warning"></span></div></td><td>0.8</td><td><span class="gate-status block">‚úó BLOCK</span></td></tr>
                        <tr><td>CP-00138</td><td>HCP Tier ‚Üí Patient Reach</td><td>+18pp</td><td><div class="test-indicators"><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span></div></td><td>2.5</td><td><span class="gate-status proceed">‚úì PROCEED</span></td></tr>
                    </tbody>
                </table>
                <div style="margin-top: 20px; padding: 15px; background: #f7fafc; border-radius: 10px;">
                    <div style="font-weight: 600; color: #667eea; margin-bottom: 10px;">Gate Thresholds</div>
                    <div style="font-size: 0.85em; color: #4a5568;">
                        <strong>PROCEED:</strong> ‚â•4/5 tests, E-value >2.0 | <strong>REVIEW:</strong> 3-4/5 tests, E-value 1.2-2.0 | <strong>BLOCK:</strong> &lt;3/5 tests, E-value &lt;1.2
                    </div>
                </div>
            </div>
        

            <div class="component-title">‚úì Validation Badges </div>
            <div class="component-description">Three gate decision states (PROCEED/REVIEW/BLOCK) with 5 refutation test indicators, confidence scores, and E-values.</div>
            <div class="component-demo">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div>
                        <div class="sub-section-title">‚úÖ PROCEED - All tests passed, high E-value</div>
                        <div class="validation-badge proceed">
                            <div class="gate-status proceed">‚úì VALIDATED</div>
                            <div class="validation-details">
                                <div class="validation-detail">
                                    <div class="test-indicators">
                                        <span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot passed"></span>
                                    </div>
                                    <span>5/5 tests</span>
                                </div>
                                <div class="validation-detail"><span>94% confidence</span></div>
                                <div class="validation-detail"><span>E-value: 3.2</span></div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="sub-section-title">‚ö†Ô∏è REVIEW - Borderline results</div>
                        <div class="validation-badge review">
                            <div class="gate-status review">‚ö† NEEDS REVIEW</div>
                            <div class="validation-details">
                                <div class="validation-detail">
                                    <div class="test-indicators">
                                        <span class="test-dot passed"></span><span class="test-dot passed"></span><span class="test-dot warning"></span><span class="test-dot passed"></span><span class="test-dot skipped"></span>
                                    </div>
                                    <span>3/5 tests</span>
                                </div>
                                <div class="validation-detail"><span>E-value: 1.4</span></div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="sub-section-title">‚ùå BLOCK - Failed refutation tests</div>
                        <div class="validation-badge block">
                            <div class="gate-status block">‚úó BLOCKED</div>
                            <div class="validation-details">
                                <div class="validation-detail">
                                    <div class="test-indicators">
                                        <span class="test-dot failed"></span><span class="test-dot passed"></span><span class="test-dot failed"></span><span class="test-dot passed"></span><span class="test-dot warning"></span>
                                    </div>
                                    <span>2/5 tests</span>
                                </div>
                                <div class="validation-detail"><span>E-value: 0.8</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 25px; padding: 15px; background: #f7fafc; border-radius: 8px;">
                    <div style="font-weight: 600; color: #667eea; margin-bottom: 10px;">Test Dot Legend</div>
                    <div style="display: flex; gap: 25px; font-size: 0.9em; flex-wrap: wrap;">
                        <div><span class="test-dot passed" style="display: inline-block; vertical-align: middle;"></span> Passed</div>
                        <div><span class="test-dot warning" style="display: inline-block; vertical-align: middle;"></span> Warning</div>
                        <div><span class="test-dot failed" style="display: inline-block; vertical-align: middle;"></span> Failed</div>
                        <div><span class="test-dot skipped" style="display: inline-block; vertical-align: middle;"></span> Skipped</div>
                    </div>
                    <div style="margin-top: 12px; font-size: 0.85em; color: #4a5568;">
                        <strong>Tests:</strong> 1) Placebo Treatment 2) Random Common Cause 3) Data Subset 4) Bootstrap 5) E-value Sensitivity
                    </div>
                </div>
            </div>
        
        </div>

        <!-- üèóÔ∏è Architecture Tab -->
        <div id="architecture" class="workstream-content">
            <div class="component-title">üèóÔ∏è Architecture Tab <span class="gap-badge">New Tab</span></div>
            <div class="component-description">Complete 18-agent, 6-tier architecture view with agent types (Standard/Hybrid/Deep).</div>
            <div class="component-demo">
                <div class="tier-card">
                    <div class="tier-header"><span class="tier-badge tier-0">Tier 0</span><strong>ML Foundation</strong><span style="color: #718096; font-size: 0.9em; margin-left: auto;">7 Agents</span></div>
                    <div class="agent-grid">
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üìã</div><div class="agent-mini-info"><h4>scope_definer</h4><span>Standard</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üîç</div><div class="agent-mini-info"><h4>data_preparer</h4><span>Standard</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üéØ</div><div class="agent-mini-info"><h4>model_selector</h4><span>Standard</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">‚öôÔ∏è</div><div class="agent-mini-info"><h4>model_trainer</h4><span>Standard</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #fae8ff;">üìä</div><div class="agent-mini-info"><h4>feature_analyzer</h4><span>Hybrid</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üöÄ</div><div class="agent-mini-info"><h4>model_deployer</h4><span>Standard</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dbeafe;">üëÅÔ∏è</div><div class="agent-mini-info"><h4>observability_connector</h4><span>Standard</span></div></div>
                    </div>
                </div>
                <div class="tier-card">
                    <div class="tier-header"><span class="tier-badge tier-1">Tier 1</span><strong>Coordination</strong><span style="color: #718096; font-size: 0.9em; margin-left: auto;">1 Agent</span></div>
                    <div class="agent-grid">
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #e0e7ff;">üéØ</div><div class="agent-mini-info"><h4>orchestrator</h4><span>Standard ‚Ä¢ Routes & Synthesizes</span></div></div>
                    </div>
                </div>
                <div class="tier-card">
                    <div class="tier-header"><span class="tier-badge tier-2">Tier 2</span><strong>Causal Analytics</strong><span style="color: #718096; font-size: 0.9em; margin-left: auto;">3 Agents ‚Ä¢ Core E2I</span></div>
                    <div class="agent-grid">
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #fae8ff;">‚ö°</div><div class="agent-mini-info"><h4>causal_impact</h4><span>Hybrid ‚Ä¢ DoWhy/EconML</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #fae8ff;">üìà</div><div class="agent-mini-info"><h4>gap_analyzer</h4><span>Standard ‚Ä¢ ROI</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #fae8ff;">üé®</div><div class="agent-mini-info"><h4>heterogeneous_optimizer</h4><span>Standard ‚Ä¢ CATE</span></div></div>
                    </div>
                </div>
                <div class="tier-card">
                    <div class="tier-header"><span class="tier-badge tier-3">Tier 3</span><strong>Monitoring & Experimentation</strong><span style="color: #718096; font-size: 0.9em; margin-left: auto;">3 Agents</span></div>
                    <div class="agent-grid">
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #fef3c7;">‚ö†Ô∏è</div><div class="agent-mini-info"><h4>drift_monitor</h4><span>Standard ‚Ä¢ PSI</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #fae8ff;">üß™</div><div class="agent-mini-info"><h4>experiment_designer</h4><span>Hybrid ‚Ä¢ A/B</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #fef3c7;">üíö</div><div class="agent-mini-info"><h4>health_score</h4><span>Standard</span></div></div>
                    </div>
                </div>
                <div class="tier-card">
                    <div class="tier-header"><span class="tier-badge tier-4">Tier 4</span><strong>ML & Predictions</strong><span style="color: #718096; font-size: 0.9em; margin-left: auto;">2 Agents</span></div>
                    <div class="agent-grid">
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dcfce7;">üîÆ</div><div class="agent-mini-info"><h4>prediction_synthesizer</h4><span>Standard ‚Ä¢ Ensemble</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #dcfce7;">üí∞</div><div class="agent-mini-info"><h4>resource_optimizer</h4><span>Standard ‚Ä¢ ROI</span></div></div>
                    </div>
                </div>
                <div class="tier-card">
                    <div class="tier-header"><span class="tier-badge tier-5">Tier 5</span><strong>Self-Improvement</strong><span style="color: #718096; font-size: 0.9em; margin-left: auto;">2 Agents</span></div>
                    <div class="agent-grid">
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #f3e8ff;">üìù</div><div class="agent-mini-info"><h4>explainer</h4><span>Deep ‚Ä¢ NL Gen</span></div></div>
                        <div class="agent-mini-card"><div class="agent-mini-icon" style="background: #f3e8ff;">üéì</div><div class="agent-mini-info"><h4>feedback_learner</h4><span>Deep ‚Ä¢ DSPy</span></div></div>
                    </div>
                </div>
                <div class="sub-section-title">Agent Type Distribution</div>
                <div id="agentTypeChart" style="height: 300px; background: #f7fafc; border-radius: 8px;"></div>
            </div>
        </div>

        <!-- üè∑Ô∏è Agent Badges Tab -->
        <div id="agent-badges" class="workstream-content">
            <div class="component-title">Agent Tier Badges <span class="gap-badge">18 Agents ‚Ä¢ 6 Tiers</span></div>
            <div class="component-description">Color-coded badges for all 6 tiers. Use in chat responses, agent cards, architecture views.</div>
            <div class="component-demo">
                <div class="sub-section-title">Tier 0: ML Foundation (Blue) - 7 agents</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                    <span class="agent-badge tier-0">üìã scope_definer</span><span class="agent-badge tier-0">üîç data_preparer</span><span class="agent-badge tier-0">üéØ model_selector</span><span class="agent-badge tier-0">‚öôÔ∏è model_trainer</span><span class="agent-badge tier-0">üìä feature_analyzer</span><span class="agent-badge tier-0">üöÄ model_deployer</span><span class="agent-badge tier-0">üëÅÔ∏è observability</span>
                </div>
                <div class="sub-section-title">Tier 1: Coordination (Indigo) - 1 agent</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                    <span class="agent-badge tier-1">üéØ orchestrator</span>
                </div>
                <div class="sub-section-title">Tier 2: Causal Analytics (Purple) - 3 agents</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                    <span class="agent-badge tier-2">‚ö° causal_impact</span><span class="agent-badge tier-2">üìà gap_analyzer</span><span class="agent-badge tier-2">üé® heterogeneous_optimizer</span>
                </div>
                <div class="sub-section-title">Tier 3: Monitoring & Experimentation (Amber) - 3 agents</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                    <span class="agent-badge tier-3">‚ö†Ô∏è drift_monitor</span><span class="agent-badge tier-3">üß™ experiment_designer</span><span class="agent-badge tier-3">üíö health_score</span>
                </div>
                <div class="sub-section-title">Tier 4: ML & Predictions (Green) - 2 agents</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                    <span class="agent-badge tier-4">üîÆ prediction_synthesizer</span><span class="agent-badge tier-4">üí∞ resource_optimizer</span>
                </div>
                <div class="sub-section-title">Tier 5: Self-Improvement (Violet) - 2 agents</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                    <span class="agent-badge tier-5">üìù explainer</span><span class="agent-badge tier-5">üéì feedback_learner</span>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f7fafc; border-radius: 8px;">
                    <div style="font-weight: 600; color: #667eea; margin-bottom: 10px;">Agent Type Distribution</div>
                    <div style="display: flex; gap: 30px; font-size: 0.9em;">
                        <div><strong>Standard:</strong> 13 agents</div>
                        <div><strong>Hybrid:</strong> 3 agents</div>
                        <div><strong>Deep:</strong> 2 agents</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- üìñ KPI Dictionary Tab -->
        <div id="kpi-dictionary" class="workstream-content">
            <div class="kpi-section">
                <div class="kpi-section-title">üìä WS1 - Data Coverage & Quality KPIs</div>
                
                <table class="kpi-table">
                    <thead>
                        <tr>
                            <th width="25%">KPI</th>
                            <th width="35%">Definition</th>
                            <th width="40%">Formula</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Source Coverage - Patients</strong></td>
                            <td>% of eligible patients present in source vs reference universe</td>
                            <td class="formula-text">coverage = covered_patients / reference_patients</td>
                        </tr>
                        <tr>
                            <td><strong>Source Coverage - HCPs</strong></td>
                            <td>% of priority HCPs present in source vs universe</td>
                            <td class="formula-text">coverage = covered_hcps / reference_hcps</td>
                        </tr>
                        <tr>
                            <td><strong>Geographic Consistency</strong></td>
                            <td>Max absolute gap between source share and universe share across regions</td>
                            <td class="formula-text">max_region |share_source - share_universe|</td>
                        </tr>
                        <tr>
                            <td><strong>Data Lag (Median)</strong></td>
                            <td>Median days from service date to availability in warehouse</td>
                            <td class="formula-text">median(datediff(ingested_ts, svc_date))</td>
                        </tr>
                        <tr>
                            <td><strong>Cross-source Match Rate</strong></td>
                            <td>% entities linkable across sources A & B</td>
                            <td class="formula-text">match_rate = |A‚à©B| / |A‚à™B|</td>
                        </tr>
                        <tr>
                            <td><strong>Stacking Lift</strong></td>
                            <td>Incremental value from combining multiple data sources</td>
                            <td class="formula-text">lift = (stacked - baseline) / baseline</td>
                        </tr>
                        <tr>
                            <td><strong>Completeness Pass Rate</strong></td>
                            <td>1 ‚àí null rate across brand-critical fields</td>
                            <td class="formula-text">pass = 1 ‚àí (null_critical / total)</td>
                        </tr>
                        <tr>
                            <td><strong>Feature Drift (PSI)</strong></td>
                            <td>Population Stability Index measuring shift in feature distributions</td>
                            <td class="formula-text">PSI = Œ£_b (q_b - p_b) * ln(q_b / p_b)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="kpi-section">
                <div class="kpi-section-title">ü§ñ WS1 - Model Performance KPIs</div>
                
                <table class="kpi-table">
                    <thead>
                        <tr>
                            <th width="25%">KPI</th>
                            <th width="35%">Definition</th>
                            <th width="40%">Formula</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ROC-AUC</strong></td>
                            <td>Area Under the ROC Curve - probability that a positive is ranked above a negative</td>
                            <td class="formula-text">AUC = ‚à´TPR d(FPR)</td>
                        </tr>
                        <tr>
                            <td><strong>PR-AUC</strong></td>
                            <td>Area under the Precision‚ÄìRecall curve; preferable under class imbalance</td>
                            <td class="formula-text">‚à´Precision d(Recall)</td>
                        </tr>
                        <tr>
                            <td><strong>F1 Score</strong></td>
                            <td>Harmonic mean of precision and recall at chosen threshold</td>
                            <td class="formula-text">F1 = 2 * (Precision * Recall) / (Precision + Recall)</td>
                        </tr>
                        <tr>
                            <td><strong>Recall@Top-K</strong></td>
                            <td>Fraction of all positives captured within the top K highest-scored cases</td>
                            <td class="formula-text">TP_in_topK / Total_Positives</td>
                        </tr>
                        <tr>
                            <td><strong>Brier Score</strong></td>
                            <td>Mean squared error of probabilistic predictions; lower is better</td>
                            <td class="formula-text">Brier = (1/N) * Œ£(p_i - y_i)¬≤</td>
                        </tr>
                        <tr>
                            <td><strong>Calibration Slope</strong></td>
                            <td>Slope from regressing outcomes on logit of predicted probabilities; 1.0 is ideal</td>
                            <td class="formula-text">logit(Pr(y=1)) = Œ± + Œ≤*logit(pÃÇ)</td>
                        </tr>
                        <tr>
                            <td><strong>SHAP Coverage</strong></td>
                            <td>% of predictions where Top-N features explain ‚â•œÑ% of total attribution</td>
                            <td class="formula-text">count(top_n_shap ‚â• œÑ) / total_predictions</td>
                        </tr>
                        <tr>
                            <td><strong>Label Quality (IAA)</strong></td>
                            <td>Inter-Annotator Agreement measuring label consistency</td>
                            <td class="formula-text">Cohen's Œ∫ or Krippendorff's Œ±</td>
                        </tr>
                        <tr>
                            <td><strong>Fairness Gap (ŒîRecall)</strong></td>
                            <td>Worst-case recall gap across protected or relevant subgroups</td>
                            <td class="formula-text">max_g(Recall_g) - min_g(Recall_g)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="kpi-section">
                <div class="kpi-section-title">üéØ WS2 - Trigger Performance KPIs</div>
                
                <table class="kpi-table">
                    <thead>
                        <tr>
                            <th width="25%">KPI</th>
                            <th width="35%">Definition</th>
                            <th width="40%">Formula</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Precision (Trigger)</strong></td>
                            <td>Of all triggers fired, % that led to intended outcome within look-ahead window</td>
                            <td class="formula-text">Precision = TP / (TP + FP)</td>
                        </tr>
                        <tr>
                            <td><strong>Recall (Trigger)</strong></td>
                            <td>Of all outcomes that occurred, % preceded by a trigger within look-back window</td>
                            <td class="formula-text">Recall = TP / (TP + FN)</td>
                        </tr>
                        <tr>
                            <td><strong>Lead Time</strong></td>
                            <td>Median days from trigger to outcome for true positives</td>
                            <td class="formula-text">median(outcome_ts - trigger_ts)</td>
                        </tr>
                        <tr>
                            <td><strong>Action Rate Uplift</strong></td>
                            <td>Increase in desired actions among exposed vs matched control HCPs</td>
                            <td class="formula-text">Uplift = Pr(action|exposed) - Pr(action|control)</td>
                        </tr>
                        <tr>
                            <td><strong>Acceptance Rate</strong></td>
                            <td>% of presented recommendations accepted (not snoozed/overridden)</td>
                            <td class="formula-text">Acceptance = #accepted / #presented</td>
                        </tr>
                        <tr>
                            <td><strong>Time-to-Release (TTR)</strong></td>
                            <td>Calendar days from change approval to production availability</td>
                            <td class="formula-text">TTR = date_prod - date_approve</td>
                        </tr>
                        <tr>
                            <td><strong>Change-Fail Rate (CFR)</strong></td>
                            <td>% of releases requiring rollback or hotfix within 7 days</td>
                            <td class="formula-text">CFR = #rollbacks(7d) / #releases</td>
                        </tr>
                        <tr>
                            <td><strong>False Alert Rate</strong></td>
                            <td>% of fired alerts without intended outcome within T days</td>
                            <td class="formula-text">FalseAlert = #NoOutcomeInT / #Triggers</td>
                        </tr>
                        <tr>
                            <td><strong>Override Rate</strong></td>
                            <td>% of alerts manually overridden or marked "not relevant"</td>
                            <td class="formula-text">Override = #overridden / #presented</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="kpi-section">
                <div class="kpi-section-title">üìà WS3 - Business Impact KPIs</div>
                
                <table class="kpi-table">
                    <thead>
                        <tr>
                            <th width="25%">KPI</th>
                            <th width="35%">Definition</th>
                            <th width="40%">Formula</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3" style="background: #f7fafc; font-weight: bold;">General Platform KPIs</td>
                        </tr>
                        <tr>
                            <td><strong>Active Users (MAU/WAU)</strong></td>
                            <td>Monthly/Weekly Active Users performing ‚â•1 relevant action</td>
                            <td class="formula-text">MAU = #{unique users with ‚â•1 action in month}</td>
                        </tr>
                        <tr>
                            <td><strong>HCP Coverage</strong></td>
                            <td>% of priority HCP list with ‚â•1 brand-aligned touch linked to triggers</td>
                            <td class="formula-text">%HCPs touched = touched_HCPs / target_HCPs</td>
                        </tr>
                        <tr>
                            <td><strong>Patient Touch Rate</strong></td>
                            <td>% of target patient list reviewed/flagged/acted upon in care settings</td>
                            <td class="formula-text">%Patients touched = target_patients_w_‚â•1_action / target_patients</td>
                        </tr>
                        <tr>
                            <td colspan="3" style="background: #f7fafc; font-weight: bold;">Brand-Specific KPIs</td>
                        </tr>
                        <tr>
                            <td><strong>Remi - AH Uncontrolled %</strong></td>
                            <td>% of antihistamine-uncontrolled CSU patients identified by model</td>
                            <td class="formula-text">%Identified = #AH_uncontrolled_flagged / #AH_uncontrolled_total</td>
                        </tr>
                        <tr>
                            <td><strong>Remi - Intent-to-Prescribe Œî</strong></td>
                            <td>Change in HCPs reporting "likely to prescribe" vs baseline</td>
                            <td class="formula-text">ITP_Œî = ITP_current - ITP_baseline</td>
                        </tr>
                        <tr>
                            <td><strong>Fabhalta - % PNH Tested</strong></td>
                            <td>% of suspected PNH patients who received flow cytometry testing</td>
                            <td class="formula-text">%tested = #suspected_with_test / #suspected_total</td>
                        </tr>
                        <tr>
                            <td><strong>Kisqali - Oncologist Reach</strong></td>
                            <td>% of priority oncologists with ‚â•1 brand-aligned engagement</td>
                            <td class="formula-text">%reached = #priority_HCPs_touched / #priority_HCPs</td>
                        </tr>
                        <tr>
                            <td><strong>Kisqali - Dx Adoption</strong></td>
                            <td>% priority oncologists with Oncotype Dx-guided prescriptions</td>
                            <td class="formula-text">Uplift = Pr(adoption|test_aligned) - Pr(adoption|BAU)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="kpi-section">
                <div class="kpi-section-title">üìê Statistical & Causal Methods</div>
                
                <table class="kpi-table">
                    <thead>
                        <tr>
                            <th width="25%">Method</th>
                            <th width="35%">Description</th>
                            <th width="40%">Application in Dashboard</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Difference-in-Differences (DiD)</strong></td>
                            <td>Compares changes over time between treatment and control groups to isolate causal effect</td>
                            <td>Used for action rate uplift, ITP changes, testing rate improvements</td>
                        </tr>
                        <tr>
                            <td><strong>Causal Forests</strong></td>
                            <td>Non-parametric method for heterogeneous treatment effects using random forests</td>
                            <td>Identifies which HCP/patient subgroups benefit most from interventions</td>
                        </tr>
                        <tr>
                            <td><strong>Double ML (DML)</strong></td>
                            <td>Uses ML for nuisance parameters while maintaining valid causal inference</td>
                            <td>Estimates treatment effects with high-dimensional confounders in EMR data</td>
                        </tr>
                        <tr>
                            <td><strong>Instrumental Variables (IV)</strong></td>
                            <td>Uses external variation to identify causal effects when unmeasured confounding exists</td>
                            <td>Data lag analysis using system delays as instruments</td>
                        </tr>
                        <tr>
                            <td><strong>Synthetic Control</strong></td>
                            <td>Creates weighted combination of control units to match treated unit pre-intervention</td>
                            <td>Brand-specific impact assessment (Remi patient identification)</td>
                        </tr>
                        <tr>
                            <td><strong>Regression Discontinuity</strong></td>
                            <td>Exploits discontinuous treatment assignment at threshold for causal identification</td>
                            <td>Coverage threshold effects (70% threshold for model performance)</td>
                        </tr>
                        <tr>
                            <td><strong>Mediation Analysis</strong></td>
                            <td>Decomposes total effect into direct and indirect pathways</td>
                            <td>ITP improvement pathway: targeting‚Üírelevance‚Üíengagement</td>
                        </tr>
                        <tr>
                            <td><strong>Meta-learners (S/T/X)</strong></td>
                            <td>ML methods that estimate CATE by combining base learners differently</td>
                            <td>Heterogeneous treatment effect estimation across HCP segments</td>
                        </tr>
                        <tr>
                            <td><strong>G-computation</strong></td>
                            <td>Standardization method for estimating causal effects under sequential treatments</td>
                            <td>Multi-source data stacking lift analysis</td>
                        </tr>
                        <tr>
                            <td><strong>Propensity Score Matching</strong></td>
                            <td>Matches treated and control units on probability of treatment</td>
                            <td>Creating balanced comparison groups for trigger effectiveness</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="kpi-section">
                <div class="kpi-section-title">üìñ Complete Terminology & Abbreviations</div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Framework & Organization</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>E2I:</strong> Evidence ‚Üí Decision ‚Üí Impact framework</li>
                            <li style="margin-bottom: 8px;"><strong>WS:</strong> Workstream (WS1=Data/ML, WS2=Triggers, WS3=Impact)</li>
                            <li style="margin-bottom: 8px;"><strong>IDS:</strong> Integrated Data Science</li>
                            <li style="margin-bottom: 8px;"><strong>DORA:</strong> DevOps Research & Assessment metrics</li>
                            <li style="margin-bottom: 8px;"><strong>SLA:</strong> Service Level Agreement</li>
                            <li style="margin-bottom: 8px;"><strong>MLOps:</strong> Machine Learning Operations</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Medical & Clinical</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>HCP:</strong> Healthcare Professional</li>
                            <li style="margin-bottom: 8px;"><strong>AH:</strong> Antihistamine</li>
                            <li style="margin-bottom: 8px;"><strong>CSU:</strong> Chronic Spontaneous Urticaria</li>
                            <li style="margin-bottom: 8px;"><strong>PNH:</strong> Paroxysmal Nocturnal Hemoglobinuria</li>
                            <li style="margin-bottom: 8px;"><strong>Dx:</strong> Diagnosis</li>
                            <li style="margin-bottom: 8px;"><strong>Tx:</strong> Treatment</li>
                            <li style="margin-bottom: 8px;"><strong>Rx:</strong> Prescription</li>
                            <li style="margin-bottom: 8px;"><strong>ICD:</strong> International Classification of Diseases</li>
                            <li style="margin-bottom: 8px;"><strong>NDC:</strong> National Drug Code</li>
                            <li style="margin-bottom: 8px;"><strong>LOINC:</strong> Logical Observation Identifiers Names and Codes</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Statistical Measures</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>pp:</strong> Percentage points (absolute difference)</li>
                            <li style="margin-bottom: 8px;"><strong>Œ∫ (kappa):</strong> Cohen's kappa coefficient (agreement)</li>
                            <li style="margin-bottom: 8px;"><strong>Œ± (alpha):</strong> Krippendorff's alpha (reliability)</li>
                            <li style="margin-bottom: 8px;"><strong>IAA:</strong> Inter-Annotator Agreement</li>
                            <li style="margin-bottom: 8px;"><strong>PSI:</strong> Population Stability Index</li>
                            <li style="margin-bottom: 8px;"><strong>SHAP:</strong> SHapley Additive exPlanations</li>
                            <li style="margin-bottom: 8px;"><strong>CATE:</strong> Conditional Average Treatment Effect</li>
                            <li style="margin-bottom: 8px;"><strong>ATE:</strong> Average Treatment Effect</li>
                            <li style="margin-bottom: 8px;"><strong>JS:</strong> Jensen-Shannon divergence</li>
                            <li style="margin-bottom: 8px;"><strong>KS:</strong> Kolmogorov-Smirnov test</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Data Sources & Systems</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>IQVIA APLD:</strong> All-Payer Longitudinal Data</li>
                            <li style="margin-bottom: 8px;"><strong>IQVIA LAAD:</strong> Longitudinal Access & Adjudication Data</li>
                            <li style="margin-bottom: 8px;"><strong>HealthVerity:</strong> Lab and EMR data provider</li>
                            <li style="margin-bottom: 8px;"><strong>Komodo:</strong> Healthcare data platform</li>
                            <li style="margin-bottom: 8px;"><strong>Veeva:</strong> CRM platform for life sciences</li>
                            <li style="margin-bottom: 8px;"><strong>OCE:</strong> Orchestrated Customer Engagement (Veeva)</li>
                            <li style="margin-bottom: 8px;"><strong>EMR/EHR:</strong> Electronic Medical/Health Record</li>
                            <li style="margin-bottom: 8px;"><strong>CRM:</strong> Customer Relationship Management</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Performance Metrics</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>TP/FP/TN/FN:</strong> True/False Positive/Negative</li>
                            <li style="margin-bottom: 8px;"><strong>MAU/WAU:</strong> Monthly/Weekly Active Users</li>
                            <li style="margin-bottom: 8px;"><strong>ITP:</strong> Intent-to-Prescribe</li>
                            <li style="margin-bottom: 8px;"><strong>ATU:</strong> Awareness, Trial, Usage (survey)</li>
                            <li style="margin-bottom: 8px;"><strong>BAU:</strong> Business-As-Usual (control)</li>
                            <li style="margin-bottom: 8px;"><strong>TTR:</strong> Time-to-Release</li>
                            <li style="margin-bottom: 8px;"><strong>CFR:</strong> Change-Fail Rate</li>
                            <li style="margin-bottom: 8px;"><strong>NBA:</strong> Next Best Action</li>
                            <li style="margin-bottom: 8px;"><strong>ROI:</strong> Return on Investment</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Time & Change Metrics</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>MoM:</strong> Month-over-Month change</li>
                            <li style="margin-bottom: 8px;"><strong>WoW:</strong> Week-over-Week change</li>
                            <li style="margin-bottom: 8px;"><strong>YoY:</strong> Year-over-Year change</li>
                            <li style="margin-bottom: 8px;"><strong>p50/p95/p99:</strong> 50th/95th/99th percentile</li>
                            <li style="margin-bottom: 8px;"><strong>EoM:</strong> End of Month</li>
                            <li style="margin-bottom: 8px;"><strong>T:</strong> Time window/threshold parameter</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Causal Inference Terms</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>SUTVA:</strong> Stable Unit Treatment Value Assumption</li>
                            <li style="margin-bottom: 8px;"><strong>Ignorability:</strong> No unmeasured confounders assumption</li>
                            <li style="margin-bottom: 8px;"><strong>Positivity:</strong> Overlap in covariate distributions</li>
                            <li style="margin-bottom: 8px;"><strong>Confounder:</strong> Variable affecting both treatment and outcome</li>
                            <li style="margin-bottom: 8px;"><strong>Mediator:</strong> Variable on causal pathway between treatment and outcome</li>
                            <li style="margin-bottom: 8px;"><strong>Collider:</strong> Variable caused by both treatment and outcome</li>
                            <li style="margin-bottom: 8px;"><strong>RCT:</strong> Randomized Controlled Trial</li>
                            <li style="margin-bottom: 8px;"><strong>DAG:</strong> Directed Acyclic Graph</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Technical Terms</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>API:</strong> Application Programming Interface</li>
                            <li style="margin-bottom: 8px;"><strong>CI/CD:</strong> Continuous Integration/Deployment</li>
                            <li style="margin-bottom: 8px;"><strong>DevOps:</strong> Development Operations</li>
                            <li style="margin-bottom: 8px;"><strong>FK:</strong> Foreign Key (database)</li>
                            <li style="margin-bottom: 8px;"><strong>SQL:</strong> Structured Query Language</li>
                            <li style="margin-bottom: 8px;"><strong>ETL:</strong> Extract, Transform, Load</li>
                            <li style="margin-bottom: 8px;"><strong>Regex:</strong> Regular Expression</li>
                            <li style="margin-bottom: 8px;"><strong>JSON:</strong> JavaScript Object Notation</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 15px;">Brand Names & Products</h4>
                        <ul style="list-style: none; padding: 0;">
                            <li style="margin-bottom: 8px;"><strong>Remibrutinib (Remi):</strong> Treatment for CSU</li>
                            <li style="margin-bottom: 8px;"><strong>Fabhalta:</strong> Treatment for PNH</li>
                            <li style="margin-bottom: 8px;"><strong>Kisqali:</strong> Treatment for HR+/HER2- breast cancer</li>
                            <li style="margin-bottom: 8px;"><strong>Oncotype Dx:</strong> Genomic test for breast cancer</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="kpi-section">
                <div class="kpi-section-title">üîç Key Concepts & Assumptions</div>
                
                <div style="padding: 20px; background: #f7fafc; border-radius: 10px;">
                    <h4 style="color: #2d3748; margin-bottom: 15px;">Causal Inference Assumptions</h4>
                    <ul style="color: #4a5568; line-height: 1.8; margin-left: 20px;">
                        <li><strong>SUTVA (Stable Unit Treatment Value Assumption):</strong> One unit's treatment doesn't affect another unit's outcome (no interference between units)</li>
                        <li><strong>Ignorability/Unconfoundedness:</strong> Treatment assignment is independent of potential outcomes given observed covariates</li>
                        <li><strong>Positivity/Common Support:</strong> Every unit has a non-zero probability of receiving each treatment level</li>
                        <li><strong>Consistency:</strong> The potential outcome under treatment equals the observed outcome when that treatment is received</li>
                        <li><strong>Parallel Trends (DiD):</strong> Treatment and control groups would have evolved similarly in absence of treatment</li>
                    </ul>
                    
                    <h4 style="color: #2d3748; margin-top: 20px; margin-bottom: 15px;">Data Quality Dimensions</h4>
                    <ul style="color: #4a5568; line-height: 1.8; margin-left: 20px;">
                        <li><strong>Completeness:</strong> Degree to which required data is present</li>
                        <li><strong>Validity:</strong> Data conforms to defined formats and business rules</li>
                        <li><strong>Uniqueness:</strong> No inappropriate duplicates exist</li>
                        <li><strong>Consistency:</strong> Data is uniform across systems and time</li>
                        <li><strong>Timeliness:</strong> Data is available when needed</li>
                        <li><strong>Accuracy:</strong> Data correctly represents real-world entities</li>
                    </ul>
                    
                    <h4 style="color: #2d3748; margin-top: 20px; margin-bottom: 15px;">Model Performance Considerations</h4>
                    <ul style="color: #4a5568; line-height: 1.8; margin-left: 20px;">
                        <li><strong>Class Imbalance:</strong> When positive cases are rare, PR-AUC is more informative than ROC-AUC</li>
                        <li><strong>Calibration:</strong> Well-calibrated models have predicted probabilities that match observed frequencies</li>
                        <li><strong>Drift:</strong> Feature distributions can shift over time (data drift) affecting model performance (concept drift)</li>
                        <li><strong>Fairness:</strong> Models should perform equitably across relevant subgroups</li>
                        <li><strong>Interpretability:</strong> SHAP values help explain individual predictions for trust and debugging</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- üè∑Ô∏è Status Legend Tab -->
        <div id="legend" class="workstream-content">
            <div class="visualization-container">
                <div class="viz-title">üè∑Ô∏è Status Indicator Legend & Thresholds</div>
                
                <div class="legend-grid">
                    <div class="legend-section">
                        <div class="legend-title">üìä Performance Status Colors</div>
                        
                        <div class="legend-item">
                            <div class="legend-color" style="background: #c6f6d5;"></div>
                            <div class="legend-description">
                                <div class="legend-label">Green - Optimal/Good</div>
                                <div class="legend-criteria">Meeting or exceeding target performance</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-color" style="background: #feebc8;"></div>
                            <div class="legend-description">
                                <div class="legend-label">Yellow - Monitor</div>
                                <div class="legend-criteria">Below target but within acceptable range</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fed7d7;"></div>
                            <div class="legend-description">
                                <div class="legend-label">Red - Critical</div>
                                <div class="legend-criteria">Below acceptable threshold, requires action</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="legend-section">
                        <div class="legend-title">üéØ Data Quality Thresholds</div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Source Coverage</div>
                                <div class="legend-criteria">Green: ‚â•80% | Yellow: 60-79% | Red: <60%</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Data Lag</div>
                                <div class="legend-criteria">Green: ‚â§14 days | Yellow: 15-30 days | Red: >30 days</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Match Rate</div>
                                <div class="legend-criteria">Green: ‚â•85% | Yellow: 70-84% | Red: <70%</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Completeness</div>
                                <div class="legend-criteria">Green: ‚â•95% | Yellow: 90-94% | Red: <90%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="legend-section">
                        <div class="legend-title">ü§ñ Model Performance Thresholds</div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">ROC-AUC</div>
                                <div class="legend-criteria">Green: ‚â•0.80 | Yellow: 0.70-0.79 | Red: <0.70</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Feature Drift (PSI)</div>
                                <div class="legend-criteria">Green: <0.10 | Yellow: 0.10-0.25 | Red: >0.25</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Label Quality (IAA)</div>
                                <div class="legend-criteria">Green: Œ∫‚â•0.70 | Yellow: Œ∫=0.50-0.69 | Red: Œ∫<0.50</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Fairness Gap</div>
                                <div class="legend-criteria">Green: ‚â§5pp | Yellow: 6-10pp | Red: >10pp</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="legend-section">
                        <div class="legend-title">üéØ Trigger Performance Thresholds</div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Precision</div>
                                <div class="legend-criteria">Green: ‚â•40% | Yellow: 25-39% | Red: <25%</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Acceptance Rate</div>
                                <div class="legend-criteria">Green: ‚â•65% | Yellow: 45-64% | Red: <45%</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">Lead Time</div>
                                <div class="legend-criteria">Green: 14-21 days | Yellow: 7-13 or 22-30 days | Red: <7 or >30 days</div>
                            </div>
                        </div>
                        
                        <div class="legend-item">
                            <div class="legend-description">
                                <div class="legend-label">False Alert Rate</div>
                                <div class="legend-criteria">Green: ‚â§40% | Yellow: 41-60% | Red: >60%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- üß† Agentic Methodology Tab -->
        <div id="methodology" class="workstream-content">
            <div class="component-title">üß† Agentic Methodology <span class="gap-badge">V4.1 Architecture</span></div>
            <div class="component-description">
                Complete 18-agent, 6-tier architecture with ML Foundation, Tri-Memory system, causal validation workflow, and MLOps integration. This tab provides a comprehensive view of the E2I agentic system methodology.
            </div>
            <div class="component-demo">
                
                <!-- Section 1: Architecture Overview -->
                <div class="sub-section-title">üèóÔ∏è System Architecture Overview</div>
                <div style="background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; text-align: center;">
                        <div>
                            <div style="font-size: 2.5em; font-weight: bold; color: #667eea;">4</div>
                            <div style="font-size: 0.85em; color: #718096;">Processing Layers</div>
                        </div>
                        <div>
                            <div style="font-size: 2.5em; font-weight: bold; color: #667eea;">6</div>
                            <div style="font-size: 0.85em; color: #718096;">Agent Tiers</div>
                        </div>
                        <div>
                            <div style="font-size: 2.5em; font-weight: bold; color: #667eea;">18</div>
                            <div style="font-size: 0.85em; color: #718096;">Specialized Agents</div>
                        </div>
                        <div>
                            <div style="font-size: 2.5em; font-weight: bold; color: #667eea;">28</div>
                            <div style="font-size: 0.85em; color: #718096;">Database Tables</div>
                        </div>
                    </div>
                </div>
                
                <!-- Section 2: 4-Layer Processing Architecture -->
                <div class="sub-section-title">üìä 4-Layer Processing Architecture</div>
                <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 8px;">
                        <div style="font-size: 1.5em;">üó£Ô∏è</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 700; color: #1e40af;">Layer 1: Conversational Interface</div>
                            <div style="font-size: 0.85em; color: #4a5568;">Domain-specific NLP ‚Ä¢ Intent classification ‚Ä¢ Entity extraction ‚Ä¢ Query rewriting ‚Ä¢ NO medical NER</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f0fdf4; border-left: 4px solid #10b981; border-radius: 8px;">
                        <div style="font-size: 1.5em;">üîç</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 700; color: #166534;">Layer 2: Causal Reasoning & RAG</div>
                            <div style="font-size: 0.85em; color: #4a5568;">DoWhy/EconML inference ‚Ä¢ NetworkX DAG ‚Ä¢ Graph-enhanced retrieval ‚Ä¢ Hybrid search (dense + sparse + graph)</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #fdf4ff; border-left: 4px solid #a855f7; border-radius: 8px;">
                        <div style="font-size: 1.5em;">ü§ñ</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 700; color: #7c3aed;">Layer 3: 18-Agent 6-Tier Orchestration</div>
                            <div style="font-size: 0.85em; color: #4a5568;">LangGraph state management ‚Ä¢ Priority-based routing ‚Ä¢ 13 Standard + 3 Hybrid + 2 Deep agents</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px;">
                        <div style="font-size: 1.5em;">üéì</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 700; color: #92400e;">Layer 4: Self-Improvement & Learning</div>
                            <div style="font-size: 0.85em; color: #4a5568;">Feedback collection ‚Ä¢ Quality scoring ‚Ä¢ DSPy prompt optimization ‚Ä¢ Continuous learning loops</div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Complete 6-Tier Agent Architecture -->
                <div class="sub-section-title">üéØ Complete 6-Tier Agent Architecture</div>
                
                <!-- Tier 0 -->
                <div style="background: #fdf2f8; border: 2px solid #ec4899; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="background: linear-gradient(135deg, #ec4899, #f43f5e); color: white; padding: 8px 16px; border-radius: 8px; font-weight: 700;">TIER 0</span>
                        <strong style="font-size: 1.1em;">ML Foundation</strong>
                        <span style="background: #fecdd3; color: #9f1239; padding: 4px 10px; border-radius: 12px; font-size: 0.75em; font-weight: 600; margin-left: auto;">NEW IN V4</span>
                    </div>
                    <div style="font-size: 0.9em; color: #4a5568; margin-bottom: 12px;">
                        <strong>Purpose:</strong> Complete ML lifecycle from scope definition to deployment with QC gating. Supports all higher tiers.
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px;">
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <div style="font-weight: 600; font-size: 0.85em;">üìã scope_definer</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ SLA: 5s</div>
                            <div style="font-size: 0.7em; color: #a0aec0;">Problem scope, success criteria</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <div style="font-weight: 600; font-size: 0.85em;">üîç data_preparer</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ SLA: 60s</div>
                            <div style="font-size: 0.7em; color: #a0aec0;">QC gating, Great Expectations</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <div style="font-weight: 600; font-size: 0.85em;">üéØ model_selector</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ SLA: 120s</div>
                            <div style="font-size: 0.7em; color: #a0aec0;">Algorithm evaluation, MLflow</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <div style="font-weight: 600; font-size: 0.85em;">‚öôÔ∏è model_trainer</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ Variable</div>
                            <div style="font-size: 0.7em; color: #a0aec0;">Split enforcement, Optuna</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #a855f7;">
                            <div style="font-weight: 600; font-size: 0.85em;">üìä feature_analyzer</div>
                            <div style="font-size: 0.75em; color: #7c3aed;">Hybrid ‚Ä¢ SLA: 120s</div>
                            <div style="font-size: 0.7em; color: #a0aec0;">SHAP values + LLM interpretation</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <div style="font-weight: 600; font-size: 0.85em;">üöÄ model_deployer</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ SLA: 30s</div>
                            <div style="font-size: 0.7em; color: #a0aec0;">BentoML serving, stage lifecycle</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #ec4899;">
                            <div style="font-weight: 600; font-size: 0.85em;">üëÅÔ∏è observability_connector</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ SLA: 100ms</div>
                            <div style="font-size: 0.7em; color: #a0aec0;">Opik spans, cross-tier telemetry</div>
                        </div>
                    </div>
                </div>

                <!-- Tier 1 -->
                <div style="background: #f5f3ff; border: 2px solid #8b5cf6; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="background: #8b5cf6; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 700;">TIER 1</span>
                        <strong style="font-size: 1.1em;">Coordination</strong>
                        <span style="font-size: 0.85em; color: #718096; margin-left: auto;">1 Agent ‚Ä¢ Routes & Synthesizes</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; border-left: 3px solid #8b5cf6;">
                            <div style="font-weight: 600;">üéØ orchestrator</div>
                            <div style="font-size: 0.8em; color: #718096;">Standard Agent</div>
                            <div style="font-size: 0.85em; color: #4a5568; margin-top: 8px;">
                                <strong>Never performs analysis.</strong> Coordinates all agents, dynamic routing, multi-step planning, response synthesis. Entry point for all queries.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tier 2 -->
                <div style="background: #eff6ff; border: 2px solid #3b82f6; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="background: #3b82f6; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 700;">TIER 2</span>
                        <strong style="font-size: 1.1em;">Causal Analytics</strong>
                        <span style="font-size: 0.85em; color: #718096; margin-left: auto;">3 Agents ‚Ä¢ Core E2I Mission</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #a855f7;">
                            <div style="font-weight: 600; font-size: 0.9em;">‚ö° causal_impact</div>
                            <div style="font-size: 0.75em; color: #7c3aed;">Hybrid ‚Ä¢ DoWhy/EconML</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">5-node workflow: GraphBuilder ‚Üí Estimation ‚Üí Refutation ‚Üí Sensitivity ‚Üí Interpretation</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <div style="font-weight: 600; font-size: 0.9em;">üìà gap_analyzer</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ ROI Analysis</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">Gap detection, ROI calculation, opportunity identification</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <div style="font-weight: 600; font-size: 0.9em;">üé® heterogeneous_optimizer</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ CATE</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">Segment-level treatment effects, personalization</div>
                        </div>
                    </div>
                </div>

                <!-- Tier 3 -->
                <div style="background: #ecfdf5; border: 2px solid #10b981; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="background: #10b981; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 700;">TIER 3</span>
                        <strong style="font-size: 1.1em;">Monitoring & Experimentation</strong>
                        <span style="font-size: 0.85em; color: #718096; margin-left: auto;">3 Agents</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <div style="font-weight: 600; font-size: 0.9em;">‚ö†Ô∏è drift_monitor</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ PSI Tracking</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">Feature drift detection, degradation alerts</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #a855f7;">
                            <div style="font-weight: 600; font-size: 0.9em;">üß™ experiment_designer</div>
                            <div style="font-size: 0.75em; color: #7c3aed;">Hybrid ‚Ä¢ A/B Tests</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">Power analysis, test design, experimental learning</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #10b981;">
                            <div style="font-weight: 600; font-size: 0.9em;">üíö health_score</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ Composite</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">System health metrics, Pareto scoring</div>
                        </div>
                    </div>
                </div>

                <!-- Tier 4 -->
                <div style="background: #fffbeb; border: 2px solid #f59e0b; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="background: #f59e0b; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 700;">TIER 4</span>
                        <strong style="font-size: 1.1em;">ML Predictions</strong>
                        <span style="font-size: 0.85em; color: #718096; margin-left: auto;">2 Agents</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px;">
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                            <div style="font-weight: 600; font-size: 0.9em;">üîÆ prediction_synthesizer</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ Ensemble</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">Ensemble predictions, confidence calibration</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #f59e0b;">
                            <div style="font-weight: 600; font-size: 0.9em;">üí∞ resource_optimizer</div>
                            <div style="font-size: 0.75em; color: #718096;">Standard ‚Ä¢ ROI Allocation</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">Resource allocation, constraint optimization</div>
                        </div>
                    </div>
                </div>

                <!-- Tier 5 -->
                <div style="background: #f8fafc; border: 2px solid #64748b; border-radius: 12px; padding: 20px; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="background: #64748b; color: white; padding: 8px 16px; border-radius: 8px; font-weight: 700;">TIER 5</span>
                        <strong style="font-size: 1.1em;">Self-Improvement</strong>
                        <span style="font-size: 0.85em; color: #718096; margin-left: auto;">2 Agents ‚Ä¢ NLV + RAG</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px;">
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #6366f1;">
                            <div style="font-weight: 600; font-size: 0.9em;">üìù explainer</div>
                            <div style="font-size: 0.75em; color: #6366f1;">Deep ‚Ä¢ NL Generation</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">Natural language narratives, visualization explanations</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; border-left: 3px solid #6366f1;">
                            <div style="font-weight: 600; font-size: 0.9em;">üéì feedback_learner</div>
                            <div style="font-size: 0.75em; color: #6366f1;">Deep ‚Ä¢ DSPy Optimization</div>
                            <div style="font-size: 0.8em; color: #4a5568; margin-top: 5px;">Prompt optimization, pattern learning, continuous improvement</div>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Causal Impact 5-Node Workflow -->
                <div class="sub-section-title">‚ö° Causal Impact Agent: 5-Node Workflow</div>
                <div style="background: #f7fafc; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 10px; overflow-x: auto; padding-bottom: 10px;">
                        <div style="text-align: center; min-width: 120px;">
                            <div style="width: 60px; height: 60px; margin: 0 auto 10px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.3em;">1</div>
                            <div style="font-weight: 600; font-size: 0.9em;">GraphBuilder</div>
                            <div style="font-size: 0.75em; color: #718096;">NetworkX DAG<br>Expert review check</div>
                        </div>
                        <div style="font-size: 1.5em; color: #cbd5e0;">‚Üí</div>
                        <div style="text-align: center; min-width: 120px;">
                            <div style="width: 60px; height: 60px; margin: 0 auto 10px; background: #8b5cf6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.3em;">2</div>
                            <div style="font-weight: 600; font-size: 0.9em;">Estimation</div>
                            <div style="font-size: 0.75em; color: #718096;">DoWhy/EconML<br>ATE/CATE</div>
                        </div>
                        <div style="font-size: 1.5em; color: #cbd5e0;">‚Üí</div>
                        <div style="text-align: center; min-width: 120px;">
                            <div style="width: 60px; height: 60px; margin: 0 auto 10px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.3em;">3</div>
                            <div style="font-weight: 600; font-size: 0.9em;">Refutation</div>
                            <div style="font-size: 0.75em; color: #718096;">5 tests<br>causal_validations</div>
                        </div>
                        <div style="font-size: 1.5em; color: #cbd5e0;">‚Üí</div>
                        <div style="text-align: center; min-width: 120px;">
                            <div style="width: 60px; height: 60px; margin: 0 auto 10px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.3em;">4</div>
                            <div style="font-weight: 600; font-size: 0.9em;">Sensitivity</div>
                            <div style="font-size: 0.75em; color: #718096;">E-value<br>Robustness</div>
                        </div>
                        <div style="font-size: 1.5em; color: #cbd5e0;">‚Üí</div>
                        <div style="text-align: center; min-width: 120px;">
                            <div style="width: 60px; height: 60px; margin: 0 auto 10px; background: #ec4899; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.3em;">5</div>
                            <div style="font-weight: 600; font-size: 0.9em;">Interpretation</div>
                            <div style="font-size: 0.75em; color: #718096;">Gate decision<br>NL explanation</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 8px; border-left: 4px solid #ef4444;">
                        <strong style="color: #991b1b;">Gate Control:</strong> <span style="color: #4a5568;">If gate_decision == 'block' at Node 3, Interpretation node is blocked and estimate is not surfaced to users.</span>
                    </div>
                </div>

                <!-- Section 5: MLOps Integration -->
                <div class="sub-section-title">üîß MLOps Tool Integration (7 Tools)</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 25px;">
                    <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">üìä</div>
                        <div style="font-weight: 600; color: #667eea;">MLflow</div>
                        <div style="font-size: 0.75em; color: #718096;">Experiment tracking<br>Model registry</div>
                    </div>
                    <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">üëÅÔ∏è</div>
                        <div style="font-weight: 600; color: #667eea;">Opik</div>
                        <div style="font-size: 0.75em; color: #718096;">LLM observability<br>Agent tracing</div>
                    </div>
                    <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">‚úÖ</div>
                        <div style="font-weight: 600; color: #667eea;">Great Expectations</div>
                        <div style="font-size: 0.75em; color: #718096;">Data quality<br>QC validation</div>
                    </div>
                    <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">üçΩÔ∏è</div>
                        <div style="font-weight: 600; color: #667eea;">Feast</div>
                        <div style="font-size: 0.75em; color: #718096;">Feature store<br>Feature serving</div>
                    </div>
                    <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">üéØ</div>
                        <div style="font-weight: 600; color: #667eea;">Optuna</div>
                        <div style="font-size: 0.75em; color: #718096;">Hyperparameter<br>optimization</div>
                    </div>
                    <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">üìà</div>
                        <div style="font-weight: 600; color: #667eea;">SHAP</div>
                        <div style="font-size: 0.75em; color: #718096;">Model<br>interpretability</div>
                    </div>
                    <div style="background: #fff; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #e2e8f0;">
                        <div style="font-size: 1.5em; margin-bottom: 5px;">üöÄ</div>
                        <div style="font-weight: 600; color: #667eea;">BentoML</div>
                        <div style="font-size: 0.75em; color: #718096;">Model serving<br>deployment</div>
                    </div>
                </div>

                <!-- Section 6: Tri-Memory Architecture -->
                <div class="sub-section-title">üß† Tri-Memory Architecture</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                    <div style="background: #fef3c7; padding: 15px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                        <div style="font-weight: 700; color: #92400e; margin-bottom: 8px;">‚ö° Working Memory</div>
                        <div style="font-size: 0.85em; color: #4a5568;">Redis + LangGraph MemorySaver</div>
                        <div style="font-size: 0.8em; color: #718096; margin-top: 5px;">Short-term context, conversation state, agent coordination</div>
                    </div>
                    <div style="background: #dbeafe; padding: 15px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                        <div style="font-weight: 700; color: #1e40af; margin-bottom: 8px;">üìö Episodic Memory</div>
                        <div style="font-size: 0.85em; color: #4a5568;">Supabase + pgvector</div>
                        <div style="font-size: 0.8em; color: #718096; margin-top: 5px;">Past interactions, query patterns, user preferences</div>
                    </div>
                    <div style="background: #dcfce7; padding: 15px; border-radius: 10px; border-left: 4px solid #10b981;">
                        <div style="font-weight: 700; color: #166534; margin-bottom: 8px;">üìã Procedural Memory</div>
                        <div style="font-size: 0.85em; color: #4a5568;">Supabase + pgvector</div>
                        <div style="font-size: 0.8em; color: #718096; margin-top: 5px;">Learned workflows, optimized prompts, successful patterns</div>
                    </div>
                    <div style="background: #f3e8ff; padding: 15px; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                        <div style="font-weight: 700; color: #6b21a8; margin-bottom: 8px;">üï∏Ô∏è Semantic Memory</div>
                        <div style="font-size: 0.85em; color: #4a5568;">FalkorDB + Graphity</div>
                        <div style="font-size: 0.8em; color: #718096; margin-top: 5px;">Domain knowledge graphs, causal relationships, entity connections</div>
                    </div>
                </div>

                <!-- Section 7: Query Processing Flow -->
                <div class="sub-section-title">üîÑ Query Processing Flow</div>
                <div style="background: #f7fafc; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 8px; overflow-x: auto; font-size: 0.85em;">
                        <div style="background: white; padding: 10px 15px; border-radius: 8px; text-align: center; min-width: 80px; border: 1px solid #e2e8f0;">
                            <div style="font-weight: 600;">User</div>
                            <div style="font-size: 0.8em; color: #718096;">Query</div>
                        </div>
                        <div style="color: #cbd5e0;">‚Üí</div>
                        <div style="background: white; padding: 10px 15px; border-radius: 8px; text-align: center; min-width: 80px; border: 1px solid #e2e8f0;">
                            <div style="font-weight: 600;">NLP</div>
                            <div style="font-size: 0.8em; color: #718096;">Parse</div>
                        </div>
                        <div style="color: #cbd5e0;">‚Üí</div>
                        <div style="background: white; padding: 10px 15px; border-radius: 8px; text-align: center; min-width: 80px; border: 1px solid #e2e8f0;">
                            <div style="font-weight: 600;">RAG</div>
                            <div style="font-size: 0.8em; color: #718096;">Context</div>
                        </div>
                        <div style="color: #cbd5e0;">‚Üí</div>
                        <div style="background: #667eea; color: white; padding: 10px 15px; border-radius: 8px; text-align: center; min-width: 90px;">
                            <div style="font-weight: 600;">Orchestrator</div>
                            <div style="font-size: 0.8em;">Route</div>
                        </div>
                        <div style="color: #cbd5e0;">‚Üí</div>
                        <div style="background: #ec4899; color: white; padding: 10px 15px; border-radius: 8px; text-align: center; min-width: 80px;">
                            <div style="font-weight: 600;">Tier 0</div>
                            <div style="font-size: 0.8em;">ML</div>
                        </div>
                        <div style="color: #cbd5e0;">‚Üí</div>
                        <div style="background: white; padding: 10px 15px; border-radius: 8px; text-align: center; min-width: 80px; border: 1px solid #e2e8f0;">
                            <div style="font-weight: 600;">Agent(s)</div>
                            <div style="font-size: 0.8em; color: #718096;">Analyze</div>
                        </div>
                        <div style="color: #cbd5e0;">‚Üí</div>
                        <div style="background: white; padding: 10px 15px; border-radius: 8px; text-align: center; min-width: 80px; border: 1px solid #e2e8f0;">
                            <div style="font-weight: 600;">Synthesize</div>
                            <div style="font-size: 0.8em; color: #718096;">Merge</div>
                        </div>
                        <div style="color: #cbd5e0;">‚Üí</div>
                        <div style="background: white; padding: 10px 15px; border-radius: 8px; text-align: center; min-width: 80px; border: 1px solid #e2e8f0;">
                            <div style="font-weight: 600;">Response</div>
                            <div style="font-size: 0.8em; color: #718096;">Text + Viz</div>
                        </div>
                    </div>
                </div>

                <!-- Section 8: Database Schema Summary -->
                <div class="sub-section-title">üóÑÔ∏è Database Schema (V4.1: 28 Tables)</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px; margin-bottom: 25px;">
                    <div style="background: #f7fafc; padding: 12px; border-radius: 8px;">
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 8px;">Core Data (8 tables)</div>
                        <div style="font-size: 0.8em; color: #718096;">patient_journeys, hcp_profiles, treatment_events, ml_predictions, triggers, agent_activities, business_metrics, causal_paths</div>
                    </div>
                    <div style="background: #f7fafc; padding: 12px; border-radius: 8px;">
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 8px;">ML Split Management (4 tables)</div>
                        <div style="font-size: 0.8em; color: #718096;">ml_split_registry, patient_split_assignments, preprocessing_metadata, leakage_audit_results</div>
                    </div>
                    <div style="background: #f7fafc; padding: 12px; border-radius: 8px;">
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 8px;">KPI Gap Tables (6 tables)</div>
                        <div style="font-size: 0.8em; color: #718096;">user_sessions, data_source_tracking, ml_annotations, etl_pipeline_metrics, hcp_intent_surveys, reference_universe</div>
                    </div>
                    <div style="background: #fdf2f8; padding: 12px; border-radius: 8px; border: 1px solid #ec4899;">
                        <div style="font-weight: 600; color: #9f1239; margin-bottom: 8px;">ML Foundation (8 tables) <span style="font-size: 0.7em; background: #fecdd3; padding: 2px 6px; border-radius: 4px;">V4</span></div>
                        <div style="font-size: 0.8em; color: #718096;">ml_experiments, ml_model_registry, ml_training_runs, ml_feature_store, ml_data_quality_reports, ml_shap_analyses, ml_deployments, ml_observability_spans</div>
                    </div>
                    <div style="background: #ecfdf5; padding: 12px; border-radius: 8px; border: 1px solid #10b981;">
                        <div style="font-weight: 600; color: #166534; margin-bottom: 8px;">Validation (2 tables) <span style="font-size: 0.7em; background: #dcfce7; padding: 2px 6px; border-radius: 4px;">V4.1</span></div>
                        <div style="font-size: 0.8em; color: #718096;">causal_validations (refutation tests), expert_reviews (DAG approval)</div>
                    </div>
                </div>

                <!-- Section 9: Agent Type Summary -->
                <div class="sub-section-title">üìä Agent Type Distribution</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <div style="background: #f7fafc; padding: 20px; border-radius: 12px; text-align: center; border-left: 4px solid #3b82f6;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #3b82f6;">13</div>
                        <div style="font-weight: 600; color: #2d3748;">Standard Agents</div>
                        <div style="font-size: 0.85em; color: #718096; margin-top: 5px;">Tool-heavy, SLA-bound<br>Deterministic computation</div>
                    </div>
                    <div style="background: #f7fafc; padding: 20px; border-radius: 12px; text-align: center; border-left: 4px solid #a855f7;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #a855f7;">3</div>
                        <div style="font-weight: 600; color: #2d3748;">Hybrid Agents</div>
                        <div style="font-size: 0.85em; color: #718096; margin-top: 5px;">Computation + LLM<br>Adaptive interpretation</div>
                    </div>
                    <div style="background: #f7fafc; padding: 20px; border-radius: 12px; text-align: center; border-left: 4px solid #6366f1;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #6366f1;">2</div>
                        <div style="font-weight: 600; color: #2d3748;">Deep Agents</div>
                        <div style="font-size: 0.85em; color: #718096; margin-top: 5px;">Extended reasoning<br>Self-improvement</div>
                    </div>
                </div>
            </div>
        </div>

    </div> <!-- Close dashboard-container -->

    <script>
        // Global chart configuration
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, sans-serif';
        
        
        function initShapChart() {
            const ctx = document.getElementById('shapChart');
            if (!ctx || Chart.getChart(ctx)) return;
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Prior Rx Count', 'Days Since Dx', 'HCP Tier', 'Region', 'Age Group', 'Insurance Type', 'Lab Value', 'Comorbidity'],
                    datasets: [{
                        label: 'SHAP Importance',
                        data: [0.42, 0.38, 0.31, 0.28, 0.22, 0.19, 0.15, 0.12],
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: '#667eea',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { title: { display: true, text: 'Mean |SHAP Value|' }, beginAtZero: true },
                        y: { grid: { display: false } }
                    }
                }
            });
        }


        function initAgentTypeChart() {
            const el = document.getElementById('agentTypeChart');
            if (!el || el.hasChildNodes()) return;
            Plotly.newPlot('agentTypeChart', [{
                type: 'pie',
                values: [13, 3, 2],
                labels: ['Standard (13)', 'Hybrid (3)', 'Deep (2)'],
                marker: { colors: ['#667eea', '#f093fb', '#764ba2'] },
                textinfo: 'label+percent',
                textposition: 'outside',
                hole: 0.4
            }], {
                title: { text: '18 Agents by Type', font: { size: 16 } },
                height: 300,
                showlegend: true,
                legend: { orientation: 'h', y: -0.15 },
                margin: { t: 50, b: 60, l: 30, r: 30 }
            }, { responsive: true });
        }

// Tab switching functionality
        function switchTab(tabName) {
            // Hide all content
            const contents = document.querySelectorAll('.workstream-content');
            contents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active from all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => {
                button.classList.remove('active');
            });

            // Show selected content
            const selectedContent = document.getElementById(tabName);
            if (selectedContent) {
                selectedContent.classList.add('active');
            }

            // Mark button as active - find the button that calls this tab
            buttons.forEach(button => {
                if (button.getAttribute('onclick') && button.getAttribute('onclick').includes(`'${tabName}'`)) {
                    button.classList.add('active');
                }
            });
            
            // Initialize charts for the active tab
            setTimeout(() => {
                if (tabName === 'agent-insights') initAgentCharts();
                if (tabName === 'overview') initOverviewCharts();
                if (tabName === 'ws1-data') initDataQualityCharts();
                if (tabName === 'ws1-ml') initModelCharts();
                if (tabName === 'ws2') initTriggerCharts();
                if (tabName === 'ws3') initImpactCharts();
                if (tabName === 'ml-foundation') initShapChart();
                if (tabName === 'architecture') initAgentTypeChart();
                if (tabName === 'causal') initCausalCharts();
                if (tabName === 'kpi-dictionary') console.log('KPI Dictionary loaded');
                if (tabName === 'legend') console.log('Legend tab loaded');
                if (tabName === 'methodology') initMethodologyCharts();
                if (tabName === 'methodology') console.log('Methodology loaded');
            }, 100);
        }
       
        // Initialize Overview Charts with fixed overlapping lines
        function initOverviewCharts() {
            const ctx = document.getElementById('overviewChart');
            if (!ctx) return;
            
            // Destroy existing chart if it exists
            const existingChart = Chart.getChart(ctx);
            if (existingChart) {
                existingChart.destroy();
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Data Quality ‚Üí Model Performance',
                        data: [0.75, 0.78, 0.81, 0.82],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        borderWidth: 3
                    }, {
                        label: 'Model ‚Üí Trigger Precision',
                        data: [35, 38, 40, 42],
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1',
                        borderWidth: 3
                    }, {
                        label: 'Triggers ‚Üí Business Impact',
                        data: [18, 22, 26, 31],  // Changed values to separate from the purple line
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y2',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time Period'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Model Performance (AUC)'
                            },
                            min: 0.7,
                            max: 0.85
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Precision (%)'
                            },
                            min: 30,
                            max: 45,
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        y2: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Business Impact (pp)'
                            },
                            min: 15,
                            max: 35,
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                padding: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return 'Causal Effect: +0.08 AUC per 10% data quality improvement';
                                    } else if (context.datasetIndex === 1) {
                                        return 'Causal Effect: 1.5x precision lift per 0.1 AUC';
                                    } else {
                                        return 'Causal Effect: +3pp impact per 10% precision gain';
                                    }
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize Data Quality Charts
        function initDataQualityCharts() {
            // Patient Coverage Chart
            const patientCtx = document.getElementById('patientCoverageChart');
            if (patientCtx) {
                new Chart(patientCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Covered', 'Gap'],
                        datasets: [{
                            data: [82, 18],
                            backgroundColor: ['#667eea', '#e2e8f0']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
            
            // Geographic Chart
            const geoCtx = document.getElementById('geographicChart');
            if (geoCtx) {
                new Chart(geoCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Northeast', 'South', 'Midwest', 'West'],
                        datasets: [{
                            label: 'Coverage %',
                            data: [88, 70, 85, 82],
                            backgroundColor: ['#667eea', '#fc8181', '#667eea', '#667eea']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Coverage (%)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Region'
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
            
            // Data Quality Heatmap
            const heatmapData = {
                z: [
                    [98.5, 97.2, 88.0, 82.0],
                    [99.1, 98.5, 85.5, 87.0],
                    [97.8, 96.3, 78.0, 85.0],
                    [99.5, 99.0, 92.0, 88.0]
                ],
                x: ['Completeness', 'Validity', 'Match Rate', 'Coverage'],
                y: ['IQVIA', 'HealthVerity', 'Veeva', 'Komodo'],
                type: 'heatmap',
                colorscale: [
                    [0, '#fc8181'],
                    [0.7, '#feebc8'],
                    [0.85, '#c6f6d5'],
                    [1, '#667eea']
                ],
                text: [
                    ['98.5%', '97.2%', '88.0%', '82.0%'],
                    ['99.1%', '98.5%', '85.5%', '87.0%'],
                    ['97.8%', '96.3%', '78.0%', '85.0%'],
                    ['99.5%', '99.0%', '92.0%', '88.0%']
                ],
                texttemplate: '%{text}',
                textfont: { size: 12 }
            };
            
            const layout = {
                title: '',
                height: 300,
                margin: { t: 30, b: 40 }
            };
            
            Plotly.newPlot('dataQualityHeatmap', [heatmapData], layout);
        }
        
        // Initialize Model Charts
        function initModelCharts() {
            // ROC Chart
            const rocCtx = document.getElementById('rocChart');
            if (rocCtx) {
                new Chart(rocCtx, {
                    type: 'line',
                    data: {
                        labels: ['0.0', '0.2', '0.4', '0.6', '0.8', '1.0'],
                        datasets: [{
                            label: 'ROC Curve',
                            data: [0, 0.45, 0.72, 0.88, 0.95, 1.0],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: 'start'
                        }, {
                            label: 'Random',
                            data: [0, 0.2, 0.4, 0.6, 0.8, 1.0],
                            borderColor: '#cbd5e0',
                            borderDash: [5, 5]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'False Positive Rate' }},
                            y: { title: { display: true, text: 'True Positive Rate' }}
                        },
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            // Drift Chart
            const driftCtx = document.getElementById('driftChart');
            if (driftCtx) {
                new Chart(driftCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Feature Drift (PSI)',
                            data: [0.08, 0.12, 0.15, 0.18],
                            borderColor: '#f6ad55',
                            backgroundColor: 'rgba(246, 173, 85, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Threshold',
                            data: [0.25, 0.25, 0.25, 0.25],
                            borderColor: '#fc8181',
                            borderDash: [5, 5]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                title: { display: true, text: 'PSI Value' }
                            },
                            x: {
                                title: { display: true, text: 'Week' }
                            }
                        },
                        plugins: {
                            legend: { display: true }
                        }
                    }
                });
            }
            
            // Model Performance Over Time
            const perfData = {
                x: ['2025-09-01', '2025-09-08', '2025-09-15', '2025-09-22', '2025-09-28'],
                y: [0.80, 0.81, 0.82, 0.81, 0.82],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'AUC',
                line: { color: '#667eea', width: 3 },
                marker: { size: 8 }
            };
            
            const praucData = {
                x: ['2025-09-01', '2025-09-08', '2025-09-15', '2025-09-22', '2025-09-28'],
                y: [0.12, 0.13, 0.14, 0.13, 0.14],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'PR-AUC',
                yaxis: 'y2',
                line: { color: '#764ba2', width: 3 },
                marker: { size: 8 }
            };
            
            const annotations = [
                {
                    x: '2025-09-15',
                    y: 0.82,
                    text: 'Retraining Event',
                    showarrow: true,
                    arrowhead: 2,
                    ax: 0,
                    ay: -40
                }
            ];
            
            const layout = {
                title: '',
                height: 350,
                xaxis: { title: 'Date' },
                yaxis: { title: 'ROC-AUC', side: 'left' },
                yaxis2: {
                    title: 'PR-AUC',
                    overlaying: 'y',
                    side: 'right'
                },
                annotations: annotations,
                hovermode: 'x unified'
            };
            
            Plotly.newPlot('modelPerformanceChart', [perfData, praucData], layout);

            // SHAP Coverage Chart - Line chart showing coverage over weeks
            const shapCovCtx = document.getElementById('shapCoverageChart');
            if (shapCovCtx && !Chart.getChart(shapCovCtx)) {
                new Chart(shapCovCtx, {
                    type: 'line',
                    data: {
                        labels: ['W1', 'W2', 'W3', 'W4'],
                        datasets: [{
                            label: 'SHAP Coverage',
                            data: [84.5, 76, 85.5, 91.5],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: { display: false }
                        },
                        scales: {
                            x: {
                                title: { display: true, text: 'Week' },
                                grid: { display: false }
                            },
                            y: {
                                min: 74,
                                max: 94,
                                title: { display: true, text: 'Value' },
                                ticks: {
                                    stepSize: 2
                                }
                            }
                        }
                    }
                });
            }
        }  // Close initModelCharts

        function initTriggerCharts() {
            // Trigger Flow Sankey
            const data = [{
                type: "sankey",
                orientation: "h",
                node: {
                    pad: 15,
                    thickness: 30,
                    line: {
                        color: "black",
                        width: 0.5
                    },
                    label: ["Triggers Fired", "Accepted", "Rejected", "Action Taken", "No Action", "Positive Outcome", "No Impact"],
                    color: ["#667eea", "#48bb78", "#fc8181", "#48bb78", "#f6ad55", "#48bb78", "#cbd5e0"]
                },
                link: {
                    source: [0, 0, 1, 1, 3],
                    target: [1, 2, 3, 4, 5],
                    value: [58, 42, 42, 16, 25],
                    color: ["rgba(102, 126, 234, 0.3)", "rgba(252, 129, 129, 0.3)", 
                            "rgba(72, 187, 120, 0.3)", "rgba(246, 173, 85, 0.3)", 
                            "rgba(72, 187, 120, 0.3)"]
                }
            }];
            
            const layout = {
                title: "Trigger Conversion Funnel",
                font: { size: 12 },
                height: 400
            };
            
            Plotly.newPlot('triggerFlowChart', data, layout);
        }
        
        // Initialize Impact Charts
        function initImpactCharts() {
            // Impact Sankey showing causal pathways
            const data = [{
                type: "sankey",
                orientation: "h",
                node: {
                    pad: 15,
                    thickness: 30,
                    line: {
                        color: "black",
                        width: 0.5
                    },
                    label: [
                        "Data Quality",
                        "Model Performance", 
                        "Trigger Quality",
                        "User Adoption",
                        "HCP Engagement",
                        "Patient Identification",
                        "Business Impact"
                    ],
                    color: ["#667eea", "#764ba2", "#f093fb", "#4ecdc4", "#48bb78", "#f6ad55", "#fc8181"]
                },
                link: {
                    source: [0, 0, 1, 1, 2, 2, 3, 4, 5],
                    target: [1, 3, 2, 4, 4, 5, 4, 6, 6],
                    value: [30, 10, 25, 15, 20, 15, 25, 35, 25],
                    color: "rgba(102, 126, 234, 0.2)"
                }
            }];
            
            const layout = {
                title: "Causal Impact Pathways",
                font: { size: 12 },
                height: 400
            };
            
            Plotly.newPlot('impactSankeyChart', data, layout);
        }
        
        // Initialize Causal Analysis Charts
        function initCausalCharts() {
            // Causal DAG visualization
            const dagSvg = d3.select('#causalDAG')
                .append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .attr('viewBox', '0 0 800 400');
            
            // Define nodes for the DAG
            const nodes = [
                {id: 'data', x: 100, y: 200, label: 'Data Quality'},
                {id: 'model', x: 300, y: 100, label: 'Model Performance'},
                {id: 'drift', x: 300, y: 300, label: 'Feature Drift'},
                {id: 'triggers', x: 500, y: 200, label: 'Trigger Precision'},
                {id: 'impact', x: 700, y: 200, label: 'Business Impact'}
            ];
            
            // Define edges
            const edges = [
                {source: 'data', target: 'model', effect: '+0.08 AUC'},
                {source: 'data', target: 'drift', effect: '-0.15 PSI'},
                {source: 'model', target: 'triggers', effect: '+20pp'},
                {source: 'drift', target: 'triggers', effect: '-10pp'},
                {source: 'triggers', target: 'impact', effect: '+12pp'}
            ];
            
            // Draw edges
            const edgeGroup = dagSvg.append('g');
            edges.forEach(edge => {
                const source = nodes.find(n => n.id === edge.source);
                const target = nodes.find(n => n.id === edge.target);
                
                edgeGroup.append('line')
                    .attr('x1', source.x)
                    .attr('y1', source.y)
                    .attr('x2', target.x)
                    .attr('y2', target.y)
                    .attr('stroke', '#667eea')
                    .attr('stroke-width', 2)
                    .attr('marker-end', 'url(#arrowhead)');
                
                // Add effect label
                const midX = (source.x + target.x) / 2;
                const midY = (source.y + target.y) / 2;
                edgeGroup.append('text')
                    .attr('x', midX)
                    .attr('y', midY - 5)
                    .attr('text-anchor', 'middle')
                    .attr('fill', '#764ba2')
                    .attr('font-size', '12px')
                    .attr('font-weight', 'bold')
                    .text(edge.effect);
            });
            
            // Draw nodes
            const nodeGroup = dagSvg.append('g');
            nodes.forEach(node => {
                nodeGroup.append('circle')
                    .attr('cx', node.x)
                    .attr('cy', node.y)
                    .attr('r', 40)
                    .attr('fill', '#667eea')
                    .attr('fill-opacity', 0.8);
                
                nodeGroup.append('text')
                    .attr('x', node.x)
                    .attr('y', node.y + 5)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'white')
                    .attr('font-size', '12px')
                    .attr('font-weight', 'bold')
                    .text(node.label);
            });
            
            // Define arrow marker
            dagSvg.append('defs').append('marker')
                .attr('id', 'arrowhead')
                .attr('viewBox', '-0 -5 10 10')
                .attr('refX', 50)
                .attr('refY', 0)
                .attr('orient', 'auto')
                .attr('markerWidth', 8)
                .attr('markerHeight', 8)
                .append('svg:path')
                .attr('d', 'M 0,-5 L 10,0 L 0,5')
                .attr('fill', '#667eea');
            
            // Heterogeneous Effects Chart
            const heteroData = {
                type: 'box',
                y: [12, 15, 18, 8, 22, 14, 25, 10, 28, 16],
                name: 'Specialists',
                marker: { color: '#667eea' }
            };
            
            const heteroData2 = {
                type: 'box',
                y: [5, 8, 6, 4, 9, 7, 12, 3, 10, 6],
                name: 'PCPs',
                marker: { color: '#764ba2' }
            };
            
            const heteroData3 = {
                type: 'box',
                y: [18, 22, 25, 15, 28, 20, 32, 18, 35, 24],
                name: 'High Volume',
                marker: { color: '#f093fb' }
            };
            
            const heteroLayout = {
                title: 'Treatment Effect Distribution by HCP Segment',
                yaxis: { title: 'Action Rate Uplift (pp)' },
                height: 350,
                showlegend: true
            };
            
            Plotly.newPlot('heterogeneousEffects', [heteroData, heteroData2, heteroData3], heteroLayout);
            
            // Fixed Causal Attribution Waterfall with visible values
            const waterfallData = [{
                name: 'Causal Attribution',
                type: 'waterfall',
                orientation: 'v',
                measure: ['relative', 'relative', 'relative', 'relative', 'relative', 'total'],
                x: ['Baseline', 'Data Quality', 'Model Improvement', 'Trigger Optimization', 'User Training', 'Total Impact'],
                textposition: 'outside',
                text: ['+5%', '+8%', '+6%', '+4%', '+3%', '+26%'],
                y: [5, 8, 6, 4, 3, 26],
                textfont: {
                    size: 12,
                    color: '#2d3748',
                    family: 'Arial'
                },
                connector: {
                    line: { color: 'rgb(63, 63, 63)' }
                },
                increasing: { marker: { color: '#48bb78' }},
                decreasing: { marker: { color: '#fc8181' }},
                totals: { marker: { color: '#667eea' }}
            }];
            
            const waterfallLayout = {
                title: 'Causal Attribution of Business Impact',
                height: 400,
                yaxis: { 
                    title: 'Cumulative Impact (%)',
                    range: [0, 30]
                },
                xaxis: {
                    tickangle: -45
                },
                showlegend: false,
                margin: {
                    t: 60,
                    b: 100
                }
            };
            
            Plotly.newPlot('causalAttribution', waterfallData, waterfallLayout);
        }
        
        // Initialize remaining small charts with visible axes
        function initSmallCharts() {
            // Chart IDs that need initialization
            // Note: shapChart excluded - has its own initShapChart() function
            const canvasIds = [
                'dataLagChart', 'matchRateChart', 'completenessChart', 'stackingLiftChart',
                'iaaChart', 'recallTopKChart', 'fairnessChart',
                'precisionChart', 'leadTimeChart', 'acceptanceChart', 'upliftChart',
                'falseAlertChart', 'ttrChart', 'mauChart', 'hcpCoverageChart',
                'patientTouchChart', 'remiChart', 'remiItpChart', 'fabhaltaTestChart',
                'kisqaliReachChart', 'kisqaliChart'
            ];
            
            canvasIds.forEach(id => {
                const ctx = document.getElementById(id);
                if (ctx && !Chart.getChart(ctx)) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['W1', 'W2', 'W3', 'W4'],
                            datasets: [{
                                data: [
                                    Math.random() * 20 + 70,
                                    Math.random() * 20 + 75,
                                    Math.random() * 20 + 80,
                                    Math.random() * 20 + 85
                                ],
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: { 
                                    display: true,
                                    grid: {
                                        display: true,
                                        color: 'rgba(0,0,0,0.05)'
                                    },
                                    title: {
                                        display: true,
                                        text: 'Value',
                                        font: {
                                            size: 10
                                        }
                                    },
                                    ticks: {
                                        font: {
                                            size: 10
                                        }
                                    }
                                },
                                x: { 
                                    display: true,
                                    grid: {
                                        display: false
                                    },
                                    title: {
                                        display: true,
                                        text: 'Week',
                                        font: {
                                            size: 10
                                        }
                                    },
                                    ticks: {
                                        font: {
                                            size: 10
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            });
        }

        // Initialize Agent Insights Charts
        function initAgentCharts() {
            // Heterogeneous Effects Heatmap
            const heteroData = {
                z: [
                    [22, 18, 25, 15, 28],
                    [7, 6, 8, 5, 9],
                    [28, 24, 32, 20, 35],
                    [3, 2, 4, 1, 5]
                ],
                x: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Current'],
                y: ['Specialists', 'PCPs', 'High Volume', 'Rural'],
                type: 'heatmap',
                colorscale: [
                    [0, '#fc8181'],
                    [0.2, '#feebc8'],
                    [0.5, '#c6f6d5'],
                    [1, '#667eea']
                ],
                text: [
                    ['22pp', '18pp', '25pp', '15pp', '28pp'],
                    ['7pp', '6pp', '8pp', '5pp', '9pp'],
                    ['28pp', '24pp', '32pp', '20pp', '35pp'],
                    ['3pp', '2pp', '4pp', '1pp', '5pp']
                ],
                texttemplate: '%{text}',
                textfont: { size: 12, color: 'white' }
            };
            
            const heteroLayout = {
                title: 'Treatment Effect by Segment Over Time',
                height: 300,
                xaxis: { title: 'Time Period' },
                yaxis: { title: 'HCP Segment' }
            };
            
            Plotly.newPlot('heterogeneousHeatmap', [heteroData], heteroLayout);
            
            // Resource Allocation Sankey
            const sankeyData = [{
                type: "sankey",
                orientation: "h",
                node: {
                    pad: 15,
                    thickness: 30,
                    line: {
                        color: "black",
                        width: 0.5
                    },
                    label: [
                        "Current Budget",
                        "Data Sources", 
                        "Model Development",
                        "UI/UX",
                        "Field Operations",
                        "Optimal Budget",
                        "Enhanced UI",
                        "Data Quality",
                        "Field Focus",
                        "Model Maintain"
                    ],
                    color: ["#667eea", "#fc8181", "#f6ad55", "#fc8181", "#48bb78", 
                            "#667eea", "#48bb78", "#48bb78", "#48bb78", "#f6ad55"]
                },
                link: {
                    source: [0, 0, 0, 0, 5, 5, 5, 5],
                    target: [1, 2, 3, 4, 6, 7, 8, 9],
                    value: [25, 30, 10, 35, 35, 20, 35, 10],
                    color: "rgba(102, 126, 234, 0.2)"
                }
            }];
            
            const sankeyLayout = {
                title: "Budget Reallocation for Optimal ROI",
                font: { size: 12 },
                height: 350
            };
            
            Plotly.newPlot('resourceAllocationSankey', sankeyData, sankeyLayout);
            
            // Health Radar Chart
            const radarData = {
                type: 'scatterpolar',
                r: [88, 82, 78, 86, 85, 72, 90, 84],
                theta: [
                    'Data Coverage', 
                    'Model AUC', 
                    'Trigger Accept', 
                    'Business Impact',
                    'Data Freshness',
                    'Fairness',
                    'System Uptime',
                    'User Adoption'
                ],
                fill: 'toself',
                fillcolor: 'rgba(102, 126, 234, 0.2)',
                line: { color: '#667eea' },
                name: 'Current'
            };
            
            const targetData = {
                type: 'scatterpolar',
                r: [95, 85, 90, 90, 90, 85, 95, 90],
                theta: [
                    'Data Coverage', 
                    'Model AUC', 
                    'Trigger Accept', 
                    'Business Impact',
                    'Data Freshness',
                    'Fairness',
                    'System Uptime',
                    'User Adoption'
                ],
                fill: 'toself',
                fillcolor: 'rgba(72, 187, 120, 0.1)',
                line: { color: '#48bb78', dash: 'dash' },
                name: 'Target'
            };
            
            const radarLayout = {
                polar: {
                    radialaxis: {
                        visible: true,
                        range: [0, 100]
                    }
                },
                height: 350,
                showlegend: true
            };
            
            Plotly.newPlot('healthRadarChart', [radarData, targetData], radarLayout);
        }
        
        // Initialize Methodology Charts  
        function initMethodologyCharts() {
            // Agent Orchestration Flow Diagram
            const agentFlowDiv = document.getElementById('agentOrchestrationFlow');
            if (!agentFlowDiv) return;
            
            // Create a Sankey diagram showing agent collaboration
            const flowData = [{
                type: "sankey",
                orientation: "h",
                node: {
                    pad: 15,
                    thickness: 30,
                    line: {
                        color: "black",
                        width: 0.5
                    },
                    label: [
                        "Dashboard Metrics",
                        "Data Validation",
                        "Causal Graph",
                        "Impact Agent",
                        "Gap Agent", 
                        "Drift Agent",
                        "Heterogeneous Agent",
                        "Experiment Agent",
                        "Health Agent",
                        "Orchestrator",
                        "Insights",
                        "Actions"
                    ],
                    color: [
                        "#667eea", "#764ba2", "#9F7AEA",
                        "#667eea", "#48bb78", "#f6ad55", "#9F7AEA", "#4ecdc4", "#3182ce",
                        "#667eea", "#48bb78", "#fc8181"
                    ]
                },
                link: {
                    source: [0, 1, 2, 2, 2, 2, 2, 2, 3, 4, 5, 6, 7, 8, 9, 9],
                    target: [1, 2, 3, 4, 5, 6, 7, 8, 9, 9, 9, 9, 9, 9, 10, 11],
                    value: [100, 100, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 80, 20],
                    color: "rgba(102, 126, 234, 0.2)"
                }
            }];
            
            const flowLayout = {
                title: "Agent Collaboration & Data Flow",
                font: { 
                    size: 12,
                    family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, sans-serif'
                },
                height: 350,
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent'
            };
            
            Plotly.newPlot('agentOrchestrationFlow', flowData, flowLayout);
        }
                     
        // Refresh dashboard function
        function refreshDashboard() {
            // Simulate refresh
            const alertBanner = document.getElementById('alertBanner');
            alertBanner.classList.add('show');
            setTimeout(() => {
                alertBanner.classList.remove('show');
            }, 5000);
            
            // Re-initialize current tab charts
            const activeTab = document.querySelector('.workstream-content.active').id;
            if (activeTab === 'agent-insights') initAgentCharts();
            if (activeTab === 'overview') initOverviewCharts();
            if (activeTab === 'ws1-data') initDataQualityCharts();
            if (activeTab === 'ws1-ml') initModelCharts();
            if (activeTab === 'ws2') initTriggerCharts();
            if (activeTab === 'ws3') initImpactCharts();
            if (activeTab === 'causal') initCausalCharts();
            if (activeTab === 'methodology') initMethodologyCharts();
        }
        
        // Call initSmallCharts when tabs are switched
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                setTimeout(initSmallCharts, 100);
            });
        });
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            initOverviewCharts();
            setTimeout(initSmallCharts, 200);
        });

        // Knowledge Graph Initialization
        let kgCy = null;
        let kgWebSocket = null;
        const GRAPH_API_BASE = '/api/v1/graph';

        // Fetch graph data from API
        async function fetchGraphData() {
            try {
                // Fetch nodes and relationships in parallel
                const [nodesRes, relsRes] = await Promise.all([
                    fetch(`${GRAPH_API_BASE}/nodes?limit=200`),
                    fetch(`${GRAPH_API_BASE}/relationships?limit=500`)
                ]);

                if (!nodesRes.ok || !relsRes.ok) {
                    throw new Error('API request failed');
                }

                const nodesData = await nodesRes.json();
                const relsData = await relsRes.json();

                // Convert API response to Cytoscape format
                const nodes = nodesData.nodes.map(node => ({
                    data: {
                        id: node.id,
                        label: node.name,
                        type: node.type,
                        ...node.properties
                    }
                }));

                const edges = relsData.relationships.map(rel => ({
                    data: {
                        id: rel.id,
                        source: rel.source_id,
                        target: rel.target_id,
                        type: rel.type,
                        effect: rel.properties?.effect,
                        confidence: rel.confidence,
                        ...rel.properties
                    }
                }));

                return { nodes, edges };
            } catch (error) {
                console.warn('Failed to fetch graph data from API, using sample data:', error);
                return getSampleGraphData();
            }
        }

        // Sample data fallback
        function getSampleGraphData() {
            return {
                nodes: [
                    // Brands
                    { data: { id: 'rem', label: 'Remibrutinib', type: 'Brand', therapeutic: 'CSU' }},
                    { data: { id: 'fab', label: 'Fabhalta', type: 'Brand', therapeutic: 'PNH' }},
                    { data: { id: 'kis', label: 'Kisqali', type: 'Brand', therapeutic: 'Oncology' }},
                    // Regions
                    { data: { id: 'ne', label: 'Northeast', type: 'Region', abbrev: 'NE' }},
                    { data: { id: 'mw', label: 'Midwest', type: 'Region', abbrev: 'MW' }},
                    { data: { id: 'se', label: 'Southeast', type: 'Region', abbrev: 'SE' }},
                    { data: { id: 'we', label: 'West', type: 'Region', abbrev: 'W' }},
                    // KPIs
                    { data: { id: 'conv', label: 'Conversion Rate', type: 'KPI', workstream: 'WS2' }},
                    { data: { id: 'trx', label: 'TRx Volume', type: 'KPI', workstream: 'WS3' }},
                    { data: { id: 'eng', label: 'Engagement Score', type: 'KPI', workstream: 'WS2' }},
                    { data: { id: 'cov', label: 'HCP Coverage', type: 'KPI', workstream: 'WS1' }},
                    { data: { id: 'ttt', label: 'Time to Therapy', type: 'KPI', workstream: 'WS3' }},
                    // Agents
                    { data: { id: 'ci', label: 'Causal Impact', type: 'Agent', tier: 1 }},
                    { data: { id: 'ga', label: 'Gap Analyzer', type: 'Agent', tier: 1 }},
                    { data: { id: 'dm', label: 'Drift Monitor', type: 'Agent', tier: 2 }},
                    { data: { id: 'exp', label: 'Explainer', type: 'Agent', tier: 4 }},
                    // Causal Variables
                    { data: { id: 'trigger', label: 'Trigger Quality', type: 'CausalVariable' }},
                    { data: { id: 'leadtime', label: 'Lead Time', type: 'CausalVariable' }},
                    { data: { id: 'dataqual', label: 'Data Quality', type: 'CausalVariable' }},
                    // Insights / Episodes
                    { data: { id: 'ins1', label: 'MW Conv Drop', type: 'Episode', date: '2025-Q3' }},
                    { data: { id: 'ins2', label: 'NE Engagement Up', type: 'Episode', date: '2025-Q3' }},
                ],
                edges: [
                    // Causal relationships
                    { data: { source: 'cov', target: 'eng', type: 'CAUSES', effect: 0.23 }},
                    { data: { source: 'eng', target: 'conv', type: 'CAUSES', effect: 0.31 }},
                    { data: { source: 'conv', target: 'trx', type: 'CAUSES', effect: 0.45 }},
                    { data: { source: 'trigger', target: 'conv', type: 'CAUSES', effect: 0.28 }},
                    { data: { source: 'leadtime', target: 'trigger', type: 'IMPACTS', effect: 0.18 }},
                    { data: { source: 'dataqual', target: 'cov', type: 'IMPACTS', effect: 0.15 }},
                    { data: { source: 'ttt', target: 'trx', type: 'IMPACTS', effect: -0.12 }},
                    // Agent-KPI relationships
                    { data: { source: 'ci', target: 'conv', type: 'DISCOVERED' }},
                    { data: { source: 'ci', target: 'trx', type: 'DISCOVERED' }},
                    { data: { source: 'ga', target: 'cov', type: 'DISCOVERED' }},
                    { data: { source: 'dm', target: 'eng', type: 'DISCOVERED' }},
                    { data: { source: 'exp', target: 'ins1', type: 'GENERATED' }},
                    // Brand-Region relationships
                    { data: { source: 'rem', target: 'ne', type: 'RELATES_TO', share: 0.12 }},
                    { data: { source: 'rem', target: 'mw', type: 'RELATES_TO', share: 0.08 }},
                    { data: { source: 'fab', target: 'ne', type: 'RELATES_TO', share: 0.15 }},
                    { data: { source: 'fab', target: 'se', type: 'RELATES_TO', share: 0.11 }},
                    { data: { source: 'kis', target: 'we', type: 'RELATES_TO', share: 0.22 }},
                    { data: { source: 'kis', target: 'mw', type: 'RELATES_TO', share: 0.18 }},
                    // Episode connections
                    { data: { source: 'ins1', target: 'rem', type: 'MENTIONS' }},
                    { data: { source: 'ins1', target: 'mw', type: 'MENTIONS' }},
                    { data: { source: 'ins1', target: 'conv', type: 'MENTIONS' }},
                    { data: { source: 'ins2', target: 'ne', type: 'MENTIONS' }},
                    { data: { source: 'ins2', target: 'eng', type: 'MENTIONS' }},
                    // Influences
                    { data: { source: 'eng', target: 'cov', type: 'INFLUENCES', strength: 0.65 }},
                ]
            };
        }

        // WebSocket connection for real-time graph updates
        function connectGraphWebSocket() {
            const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${wsProtocol}//${window.location.host}${GRAPH_API_BASE}/stream`;

            try {
                kgWebSocket = new WebSocket(wsUrl);

                kgWebSocket.onopen = () => {
                    console.log('Graph WebSocket connected');
                    // Subscribe to all entity types
                    kgWebSocket.send(JSON.stringify({
                        entity_types: ['Patient', 'HCP', 'Brand', 'Region', 'KPI', 'CausalPath', 'Trigger', 'Agent', 'Episode', 'Community'],
                        include_properties: true
                    }));
                };

                kgWebSocket.onmessage = (event) => {
                    const message = JSON.parse(event.data);
                    handleGraphUpdate(message);
                };

                kgWebSocket.onerror = (error) => {
                    console.warn('Graph WebSocket error:', error);
                };

                kgWebSocket.onclose = () => {
                    console.log('Graph WebSocket closed, reconnecting in 5s...');
                    setTimeout(connectGraphWebSocket, 5000);
                };
            } catch (error) {
                console.warn('Failed to connect Graph WebSocket:', error);
            }
        }

        // Handle real-time graph updates
        function handleGraphUpdate(message) {
            if (!kgCy) return;

            const { event_type, payload } = message;

            switch (event_type) {
                case 'node_added':
                    kgCy.add({
                        group: 'nodes',
                        data: {
                            id: payload.id,
                            label: payload.name,
                            type: payload.type,
                            ...payload.properties
                        }
                    });
                    updateKGStats();
                    break;

                case 'edge_added':
                    kgCy.add({
                        group: 'edges',
                        data: {
                            id: payload.id,
                            source: payload.source_id,
                            target: payload.target_id,
                            type: payload.type,
                            ...payload.properties
                        }
                    });
                    updateKGStats();
                    break;

                case 'node_updated':
                    const node = kgCy.getElementById(payload.id);
                    if (node.length) {
                        node.data(payload.properties);
                    }
                    break;

                case 'episode_added':
                    // Add episode as a special node with connections
                    kgCy.add({
                        group: 'nodes',
                        data: {
                            id: payload.episode_id,
                            label: payload.content_summary || 'Episode',
                            type: 'Episode',
                            source: payload.source
                        }
                    });
                    // Add MENTIONS edges to extracted entities
                    (payload.extracted_entities || []).forEach(entity => {
                        if (kgCy.getElementById(entity.id).length) {
                            kgCy.add({
                                group: 'edges',
                                data: {
                                    source: payload.episode_id,
                                    target: entity.id,
                                    type: 'MENTIONS'
                                }
                            });
                        }
                    });
                    updateKGStats();
                    break;
            }

            // Re-run layout if nodes were added
            if (['node_added', 'edge_added', 'episode_added'].includes(event_type)) {
                kgCy.layout({
                    name: document.getElementById('kg-layoutSelect').value,
                    animate: true,
                    animationDuration: 300
                }).run();
            }
        }

        async function initKnowledgeGraph() {
            // Only initialize if the tab is active and cy hasn't been initialized
            if (document.getElementById('knowledge-graph').classList.contains('active') && !kgCy) {
                // Register dagre layout
                if (typeof cytoscape !== 'undefined' && typeof dagre !== 'undefined') {
                    cytoscape.use(cytoscapeDagre);
                }

                // Fetch graph data from API (with fallback to sample data)
                const graphData = await fetchGraphData();

                // Node colors - includes all E2I and Graphiti entity types
                const nodeColors = {
                    'Patient': '#ed64a6',
                    'HCP': '#38b2ac',
                    'Brand': '#667eea',
                    'Region': '#48bb78',
                    'KPI': '#f6ad55',
                    'CausalPath': '#e53e3e',
                    'Trigger': '#dd6b20',
                    'Agent': '#fc8181',
                    'Episode': '#b794f4',
                    'Community': '#9f7aea',
                    'CausalVariable': '#4fd1c5',
                    'Insight': '#b794f4'
                };

                // Edge colors - matches Graphiti relationship types
                const edgeColors = {
                    'TREATED_BY': '#38b2ac',
                    'PRESCRIBED': '#667eea',
                    'PRESCRIBES': '#667eea',
                    'CAUSES': '#e53e3e',
                    'IMPACTS': '#dd6b20',
                    'INFLUENCES': '#38a169',
                    'DISCOVERED': '#3182ce',
                    'GENERATED': '#805ad5',
                    'MENTIONS': '#9f7aea',
                    'MEMBER_OF': '#ed64a6',
                    'RELATES_TO': '#718096'
                };

                // Initialize Cytoscape
                kgCy = cytoscape({
                    container: document.getElementById('kg-cy'),
                    elements: graphData,

                    style: [
                        {
                            selector: 'node',
                            style: {
                                'label': 'data(label)',
                                'text-valign': 'center',
                                'text-halign': 'center',
                                'background-color': function(ele) {
                                    return nodeColors[ele.data('type')] || '#888';
                                },
                                'color': '#fff',
                                'font-size': '11px',
                                'font-weight': 'bold',
                                'text-outline-color': '#333',
                                'text-outline-width': 2,
                                'width': 55,
                                'height': 55,
                                'border-width': 2,
                                'border-color': '#333'
                            }
                        },
                        {
                            selector: 'node:selected',
                            style: {
                                'border-width': 4,
                                'border-color': '#ffd700',
                                'background-color': '#ffd700'
                            }
                        },
                        {
                            selector: 'node.highlighted',
                            style: {
                                'border-width': 4,
                                'border-color': '#00ff00'
                            }
                        },
                        {
                            selector: 'edge',
                            style: {
                                'width': function(ele) {
                                    return ele.data('type') === 'CAUSES' ? 4 : 2;
                                },
                                'line-color': function(ele) {
                                    return edgeColors[ele.data('type')] || '#888';
                                },
                                'target-arrow-color': function(ele) {
                                    return edgeColors[ele.data('type')] || '#888';
                                },
                                'target-arrow-shape': 'triangle',
                                'curve-style': 'bezier',
                                'opacity': 0.8
                            }
                        },
                        {
                            selector: 'edge[effect]',
                            style: {
                                'label': function(ele) {
                                    const effect = ele.data('effect');
                                    if (effect) {
                                        const sign = effect > 0 ? '+' : '';
                                        return sign + (effect * 100).toFixed(0) + '%';
                                    }
                                    return '';
                                },
                                'font-size': '10px',
                                'text-rotation': 'autorotate',
                                'text-margin-y': -10,
                                'color': '#4a5568',
                                'text-outline-color': '#fff',
                                'text-outline-width': 1
                            }
                        },
                        {
                            selector: 'edge.highlighted',
                            style: {
                                'line-color': '#00ff00',
                                'target-arrow-color': '#00ff00',
                                'width': 5
                            }
                        },
                        {
                            selector: '.faded',
                            style: {
                                'opacity': 0.2
                            }
                        }
                    ],

                    layout: {
                        name: 'dagre',
                        rankDir: 'LR',
                        nodeSep: 60,
                        rankSep: 100,
                        animate: true,
                        animationDuration: 500
                    },

                    minZoom: 0.3,
                    maxZoom: 3,
                    wheelSensitivity: 0.3
                });

                // Update statistics
                function updateKGStats() {
                    const nodes = kgCy.nodes().length;
                    const edges = kgCy.edges().length;
                    const causalEdges = kgCy.edges().filter(e => e.data('type') === 'CAUSES').length;
                    const avgDegree = (edges * 2 / nodes).toFixed(1);

                    document.getElementById('kg-nodeCount').textContent = nodes;
                    document.getElementById('kg-edgeCount').textContent = edges;
                    document.getElementById('kg-causalCount').textContent = causalEdges;
                    document.getElementById('kg-avgDegree').textContent = avgDegree;
                }

                updateKGStats();

                // Node click handler
                kgCy.on('tap', 'node', function(evt) {
                    const node = evt.target;
                    const data = node.data();

                    let detailsHtml = `<h4>${data.label}</h4>`;
                    detailsHtml += `<div class="field"><span class="field-label">Type</span><span class="field-value">${data.type}</span></div>`;
                    detailsHtml += `<div class="field"><span class="field-label">ID</span><span class="field-value">${data.id}</span></div>`;

                    if (data.therapeutic) {
                        detailsHtml += `<div class="field"><span class="field-label">Therapeutic</span><span class="field-value">${data.therapeutic}</span></div>`;
                    }
                    if (data.workstream) {
                        detailsHtml += `<div class="field"><span class="field-label">Workstream</span><span class="field-value">${data.workstream}</span></div>`;
                    }
                    if (data.tier !== undefined) {
                        detailsHtml += `<div class="field"><span class="field-label">Tier</span><span class="field-value">${data.tier}</span></div>`;
                    }
                    if (data.abbrev) {
                        detailsHtml += `<div class="field"><span class="field-label">Abbrev</span><span class="field-value">${data.abbrev}</span></div>`;
                    }
                    if (data.date) {
                        detailsHtml += `<div class="field"><span class="field-label">Date</span><span class="field-value">${data.date}</span></div>`;
                    }

                    // Show connections
                    const connected = node.neighborhood().nodes();
                    if (connected.length > 0) {
                        detailsHtml += `<div class="field"><span class="field-label">Connections</span><span class="field-value">${connected.length}</span></div>`;
                    }

                    document.getElementById('kg-nodeDetails').innerHTML = detailsHtml;
                });

                // Layout selector
                document.getElementById('kg-layoutSelect').addEventListener('change', function() {
                    const layout = this.value;
                    kgCy.layout({
                        name: layout,
                        animate: true,
                        animationDuration: 500,
                        rankDir: 'LR',
                        nodeSep: 60,
                        rankSep: 100
                    }).run();
                });

                // Filter buttons
                document.querySelectorAll('#knowledge-graph [data-filter]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('#knowledge-graph [data-filter]').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');

                        const filter = this.dataset.filter;

                        if (filter === 'all') {
                            kgCy.elements().removeClass('faded');
                        } else if (filter === 'causal') {
                            kgCy.elements().addClass('faded');
                            kgCy.edges().filter(e => e.data('type') === 'CAUSES').removeClass('faded');
                            kgCy.edges().filter(e => e.data('type') === 'CAUSES').connectedNodes().removeClass('faded');
                        } else {
                            kgCy.elements().addClass('faded');
                            kgCy.nodes().filter(n => n.data('type') === filter).removeClass('faded');
                            kgCy.nodes().filter(n => n.data('type') === filter).connectedEdges().removeClass('faded');
                        }
                    });
                });

                // Reset button
                // Refresh button - reload graph data from API
                document.getElementById('kg-refreshBtn').addEventListener('click', async function() {
                    this.disabled = true;
                    this.textContent = '‚è≥ Loading...';
                    try {
                        const newData = await fetchGraphData();
                        kgCy.elements().remove();
                        kgCy.add(newData.nodes);
                        kgCy.add(newData.edges);
                        kgCy.layout({
                            name: document.getElementById('kg-layoutSelect').value,
                            animate: true,
                            animationDuration: 500,
                            rankDir: 'LR',
                            nodeSep: 60,
                            rankSep: 100
                        }).run();
                        updateKGStats();
                    } catch (error) {
                        console.error('Failed to refresh graph:', error);
                    } finally {
                        this.disabled = false;
                        this.textContent = 'üîÑ Refresh';
                    }
                });

                // Reset button
                document.getElementById('kg-resetBtn').addEventListener('click', function() {
                    kgCy.elements().removeClass('faded highlighted');
                    document.querySelectorAll('#knowledge-graph [data-filter]').forEach(b => b.classList.remove('active'));
                    document.querySelector('#knowledge-graph [data-filter="all"]').classList.add('active');
                    kgCy.fit(50);
                });

                // Fit button
                document.getElementById('kg-fitBtn').addEventListener('click', function() {
                    kgCy.fit(50);
                });

                // Connect WebSocket for real-time updates
                connectGraphWebSocket();

                // Search functionality
                document.getElementById('kg-searchBtn').addEventListener('click', function() {
                    const searchTerm = document.getElementById('kg-searchInput').value.toLowerCase();

                    kgCy.elements().removeClass('highlighted faded');

                    if (!searchTerm) return;

                    const matchingNodes = kgCy.nodes().filter(n =>
                        n.data('label').toLowerCase().includes(searchTerm) ||
                        n.data('id').toLowerCase().includes(searchTerm)
                    );

                    if (matchingNodes.length > 0) {
                        kgCy.elements().addClass('faded');
                        matchingNodes.removeClass('faded').addClass('highlighted');
                        matchingNodes.neighborhood().removeClass('faded');
                        kgCy.fit(matchingNodes.neighborhood(), 50);
                    }
                });

                // Enter key for search
                document.getElementById('kg-searchInput').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('kg-searchBtn').click();
                    }
                });
            }
        }

        // Add to switchTab function to initialize Knowledge Graph when tab is activated
        const originalSwitchTab = switchTab;
        switchTab = function(tabName) {
            originalSwitchTab(tabName);
            if (tabName === 'knowledge-graph') {
                setTimeout(initKnowledgeGraph, 100);
            }
        };
    </script>
</body>
</html>