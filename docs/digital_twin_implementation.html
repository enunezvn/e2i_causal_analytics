<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E2I Digital Twin Implementation v4.2</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #4ecdc4;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #fc8181;
            --info: #63b3ed;
            --bg-dark: #1a202c;
            --bg-card: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #a0aec0;
            --text-muted: #718096;
            --border: #4a5568;
            /* Twin-specific colors */
            --twin-generator: #9f7aea;
            --twin-simulation: #f6ad55;
            --twin-fidelity: #4ecdc4;
            --twin-repository: #667eea;
            /* Recommendation colors */
            --deploy: #48bb78;
            --skip: #fc8181;
            --refine: #f6ad55;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #2d3748 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px;
            background: linear-gradient(135deg, rgba(159, 122, 234, 0.2) 0%, rgba(246, 173, 85, 0.2) 100%);
            border-radius: 20px;
            border: 1px solid var(--border);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--twin-generator) 0%, var(--twin-simulation) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .header .version-badge {
            display: inline-block;
            background: var(--twin-generator);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .header .status-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        /* Section Styling */
        .section {
            margin-bottom: 50px;
        }
        
        .section-header {
            margin-bottom: 30px;
        }
        
        .section-header h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-header h2 .icon {
            font-size: 1.5rem;
        }
        
        .section-header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .card-icon.generator { background: linear-gradient(135deg, var(--twin-generator), #c4b5fd); }
        .card-icon.simulation { background: linear-gradient(135deg, var(--twin-simulation), #fcd34d); }
        .card-icon.fidelity { background: linear-gradient(135deg, var(--twin-fidelity), #5eead4); }
        .card-icon.repository { background: linear-gradient(135deg, var(--twin-repository), #818cf8); }
        .card-icon.deploy { background: linear-gradient(135deg, var(--deploy), #86efac); }
        .card-icon.skip { background: linear-gradient(135deg, var(--skip), #fca5a5); }
        .card-icon.refine { background: linear-gradient(135deg, var(--refine), #fcd34d); }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .card-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        /* Architecture Diagram */
        .architecture-diagram {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            overflow-x: auto;
        }
        
        .diagram-title {
            text-align: center;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--twin-generator);
        }
        
        .flow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .flow-node {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 15px 25px;
            text-align: center;
            min-width: 150px;
            transition: all 0.3s ease;
        }
        
        .flow-node:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .flow-node.generator { border-color: var(--twin-generator); }
        .flow-node.simulation { border-color: var(--twin-simulation); }
        .flow-node.fidelity { border-color: var(--twin-fidelity); }
        .flow-node.decision { border-color: var(--primary); }
        
        .flow-node-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .flow-node-label {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 5px;
        }
        
        .flow-node-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .flow-arrow {
            font-size: 1.5rem;
            color: var(--text-muted);
        }
        
        /* Workflow Integration */
        .workflow-comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: start;
            margin: 30px 0;
        }
        
        .workflow-box {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }
        
        .workflow-box.before { border-top: 3px solid var(--text-muted); }
        .workflow-box.after { border-top: 3px solid var(--twin-generator); }
        
        .workflow-title {
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .workflow-steps {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .workflow-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .workflow-step.new {
            background: rgba(159, 122, 234, 0.2);
            border: 1px solid var(--twin-generator);
        }
        
        .workflow-step .step-num {
            background: var(--border);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .workflow-step.new .step-num {
            background: var(--twin-generator);
        }
        
        .workflow-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--twin-generator);
        }
        
        /* Component List */
        .component-list {
            list-style: none;
        }
        
        .component-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .component-item:last-child {
            border-bottom: none;
        }
        
        .component-icon {
            font-size: 1.2rem;
        }
        
        .component-name {
            font-weight: 600;
            flex: 1;
        }
        
        .component-badge {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .component-badge.new { background: var(--success); color: white; }
        .component-badge.modified { background: var(--warning); color: white; }
        .component-badge.integration { background: var(--info); color: white; }
        
        /* Code Block */
        .code-block {
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .code-block .comment { color: #6b7280; }
        .code-block .keyword { color: #c084fc; }
        .code-block .string { color: #34d399; }
        .code-block .function { color: #60a5fa; }
        .code-block .class { color: #fbbf24; }
        .code-block .number { color: #f472b6; }
        
        /* Recommendation Cards */
        .recommendation-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .rec-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid;
            transition: all 0.3s ease;
        }
        
        .rec-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .rec-card.deploy { border-color: var(--deploy); }
        .rec-card.skip { border-color: var(--skip); }
        .rec-card.refine { border-color: var(--refine); }
        
        .rec-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .rec-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .rec-card.deploy .rec-title { color: var(--deploy); }
        .rec-card.skip .rec-title { color: var(--skip); }
        .rec-card.refine .rec-title { color: var(--refine); }
        
        .rec-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }
        
        .rec-criteria {
            font-size: 0.85rem;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 8px;
            text-align: left;
        }
        
        /* Metric Cards */
        .metric-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border-top: 3px solid var(--primary);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background: rgba(102, 126, 234, 0.2);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        /* Fidelity Grade Badge */
        .grade-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .grade-badge.excellent { background: var(--success); color: white; }
        .grade-badge.good { background: var(--info); color: white; }
        .grade-badge.fair { background: var(--warning); color: white; }
        .grade-badge.poor { background: var(--danger); color: white; }
        
        /* Alert Boxes */
        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin: 20px 0;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }
        
        .alert-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
        }
        
        .alert.info {
            background: rgba(99, 179, 237, 0.15);
            border: 1px solid var(--info);
        }
        
        .alert.warning {
            background: rgba(237, 137, 54, 0.15);
            border: 1px solid var(--warning);
        }
        
        .alert.success {
            background: rgba(72, 187, 120, 0.15);
            border: 1px solid var(--success);
        }
        
        .alert.danger {
            background: rgba(252, 129, 129, 0.15);
            border: 1px solid var(--danger);
        }
        
        /* File Tree */
        .file-tree {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 20px;
            font-family: 'Monaco', monospace;
            font-size: 0.85rem;
        }
        
        .file-tree-item {
            padding: 6px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-tree-item.folder { color: var(--twin-generator); }
        .file-tree-item.file { color: var(--text-secondary); padding-left: 20px; }
        .file-tree-item.new-file { color: var(--success); padding-left: 20px; }
        
        /* Twin Type Cards */
        .twin-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .twin-type-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid;
        }
        
        .twin-type-card.hcp { border-color: #60a5fa; }
        .twin-type-card.patient { border-color: #34d399; }
        .twin-type-card.territory { border-color: #f472b6; }
        
        .twin-type-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .twin-type-icon {
            font-size: 1.5rem;
        }
        
        .twin-type-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .feature-list {
            list-style: none;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .feature-list li {
            padding: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feature-list li::before {
            content: "‚Ä¢";
            color: var(--primary);
        }
        
        /* Sequence Diagram */
        .sequence-diagram {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
        }
        
        .sequence-row {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .sequence-actor {
            width: 150px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            padding: 10px;
            background: var(--bg-card);
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        .sequence-message {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 0 20px;
        }
        
        .sequence-line {
            flex: 1;
            height: 2px;
            background: var(--border);
            position: relative;
        }
        
        .sequence-line::after {
            content: "‚Üí";
            position: absolute;
            right: -8px;
            top: -10px;
            font-size: 1rem;
            color: var(--primary);
        }
        
        .sequence-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-dark);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            color: var(--text-secondary);
        }
        
        /* Print styles */
        @media print {
            body { background: white; color: black; }
            .card, .flow-node, .alert { background: #f5f5f5; border: 1px solid #ddd; }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .recommendation-cards { grid-template-columns: 1fr; }
            .metric-cards { grid-template-columns: repeat(2, 1fr); }
            .twin-types { grid-template-columns: 1fr; }
            .workflow-comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîÆ Digital Twin Implementation</h1>
            <p class="subtitle">Pre-screen A/B Tests with ML-Based Entity Simulations</p>
            <span class="version-badge">E2I v4.2.0</span>
            <span class="status-badge">New Capability</span>
        </div>
        
        <!-- Executive Summary -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üìã</span> Executive Summary</h2>
                <p>Digital twins enable hypothesis refinement through simulation before real-world deployment</p>
            </div>
            
            <div class="alert info">
                <span class="alert-icon">üí°</span>
                <div>
                    <strong>Key Principle:</strong> Digital twins pre-filter experiments, they don't replace them. Promising simulations proceed to real A/B tests; only clearly unviable interventions are skipped based on simulation evidence.
                </div>
            </div>
            
            <div class="metric-cards">
                <div class="metric-card">
                    <div class="metric-value">&lt;20%</div>
                    <div class="metric-label">ATE Prediction Error Target</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">30%</div>
                    <div class="metric-label">Tests Pre-screened Out</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">40%</div>
                    <div class="metric-label">Fewer Redesign Iterations</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">50%</div>
                    <div class="metric-label">Faster Time to Experiment</div>
                </div>
            </div>
        </section>
        
        <!-- Architecture Overview -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üèóÔ∏è</span> Architecture Overview</h2>
                <p>Four core components working together to simulate intervention outcomes</p>
            </div>
            
            <div class="architecture-diagram">
                <div class="diagram-title">Digital Twin Data Flow</div>
                <div class="flow-container">
                    <div class="flow-node generator">
                        <div class="flow-node-icon">üß¨</div>
                        <div class="flow-node-label">Twin Generator</div>
                        <div class="flow-node-desc">ML-based entity modeling</div>
                    </div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-node simulation">
                        <div class="flow-node-icon">‚öóÔ∏è</div>
                        <div class="flow-node-label">Simulation Engine</div>
                        <div class="flow-node-desc">Intervention execution</div>
                    </div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-node decision">
                        <div class="flow-node-icon">üìä</div>
                        <div class="flow-node-label">Results Analysis</div>
                        <div class="flow-node-desc">ATE + Heterogeneity</div>
                    </div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-node fidelity">
                        <div class="flow-node-icon">‚úì</div>
                        <div class="flow-node-label">Fidelity Tracker</div>
                        <div class="flow-node-desc">Accuracy validation</div>
                    </div>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon generator">üß¨</div>
                        <div>
                            <div class="card-title">Twin Generator</div>
                            <div class="card-subtitle">twin_generator.py</div>
                        </div>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        ML-based twin generation using Random Forest and Gradient Boosting models trained on historical entity data. Generates statistically representative synthetic populations that preserve feature distributions and correlations.
                    </p>
                    <ul class="feature-list">
                        <li>Train on historical HCP/Patient/Territory data</li>
                        <li>Generate N synthetic twins with realistic features</li>
                        <li>Preserve statistical distributions and correlations</li>
                        <li>MLflow integration for model versioning</li>
                        <li>Feast feature store integration</li>
                    </ul>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon simulation">‚öóÔ∏è</div>
                        <div>
                            <div class="card-title">Simulation Engine</div>
                            <div class="card-subtitle">simulation_engine.py</div>
                        </div>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Executes intervention simulations on twin populations to estimate treatment effects before real-world deployment. Calculates Average Treatment Effect (ATE), confidence intervals, and heterogeneous effects by segment.
                    </p>
                    <ul class="feature-list">
                        <li>6 intervention types supported</li>
                        <li>ATE estimation with confidence intervals</li>
                        <li>Heterogeneity analysis by segment</li>
                        <li>Automatic sample size recommendation</li>
                        <li>DEPLOY / SKIP / REFINE recommendations</li>
                    </ul>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon fidelity">‚úì</div>
                        <div>
                            <div class="card-title">Fidelity Tracker</div>
                            <div class="card-subtitle">fidelity_tracker.py</div>
                        </div>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Addresses the "Validation Paradox" by systematically comparing simulation predictions against actual experiment outcomes. Tracks model accuracy over time and detects degradation requiring retraining.
                    </p>
                    <ul class="feature-list">
                        <li>Record predictions for future validation</li>
                        <li>Link simulations to real experiments</li>
                        <li>Calculate fidelity grades (Excellent ‚Üí Poor)</li>
                        <li>Detect model degradation over time</li>
                        <li>Generate automatic retraining alerts</li>
                    </ul>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon repository">üíæ</div>
                        <div>
                            <div class="card-title">Twin Repository</div>
                            <div class="card-subtitle">twin_repository.py</div>
                        </div>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Persistence layer for twin models, simulation results, and fidelity tracking records. Integrates with PostgreSQL for structured data, MLflow for model registry, and Redis for performance caching.
                    </p>
                    <ul class="feature-list">
                        <li>Save/retrieve twin generator models</li>
                        <li>Store simulation results with metadata</li>
                        <li>Track fidelity validation history</li>
                        <li>MLflow model registry integration</li>
                        <li>Redis caching for performance</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <!-- Twin Types -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üë•</span> Digital Twin Types</h2>
                <p>Three entity types modeled with domain-specific features</p>
            </div>
            
            <div class="twin-types">
                <div class="twin-type-card hcp">
                    <div class="twin-type-header">
                        <span class="twin-type-icon">üë®‚Äç‚öïÔ∏è</span>
                        <span class="twin-type-name">HCP Twins</span>
                    </div>
                    <ul class="feature-list">
                        <li>Specialty (Oncology, Rheumatology, etc.)</li>
                        <li>Prescriber Decile (1-10)</li>
                        <li>Engagement Score (0-100)</li>
                        <li>Adoption Stage (Unaware ‚Üí Champion)</li>
                        <li>Affiliation Type</li>
                        <li>Years in Practice</li>
                        <li>Digital Preference Score</li>
                    </ul>
                </div>
                
                <div class="twin-type-card patient">
                    <div class="twin-type-header">
                        <span class="twin-type-icon">üßë‚Äçü§ù‚Äçüßë</span>
                        <span class="twin-type-name">Patient Twins</span>
                    </div>
                    <ul class="feature-list">
                        <li>Primary Diagnosis (ICD-10)</li>
                        <li>Comorbidity Count</li>
                        <li>Risk Score (0-100)</li>
                        <li>Journey Stage (Diagnosis ‚Üí Maintenance)</li>
                        <li>Insurance Type</li>
                        <li>Age Group</li>
                        <li>Prior Treatment History</li>
                    </ul>
                </div>
                
                <div class="twin-type-card territory">
                    <div class="twin-type-header">
                        <span class="twin-type-icon">üó∫Ô∏è</span>
                        <span class="twin-type-name">Territory Twins</span>
                    </div>
                    <ul class="feature-list">
                        <li>Coverage Rate (%)</li>
                        <li>Market Share (%)</li>
                        <li>Competitor Presence Score</li>
                        <li>Region (Northeast, etc.)</li>
                        <li>Rep Tenure (months)</li>
                        <li>HCP Count</li>
                        <li>Patient Volume</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <!-- Workflow Integration -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üîÑ</span> Experiment Designer Integration</h2>
                <p>Digital twin simulation adds a pre-screening step to the experiment design workflow</p>
            </div>
            
            <div class="workflow-comparison">
                <div class="workflow-box before">
                    <div class="workflow-title">Before (V4.1)</div>
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <span class="step-num">1</span>
                            Query Analysis
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">2</span>
                            Context Gathering
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">3</span>
                            Experiment Design
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">4</span>
                            Power Analysis
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">5</span>
                            Validity Assessment
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">6</span>
                            Template Generation
                        </div>
                    </div>
                </div>
                
                <div class="workflow-arrow">
                    <span>‚Üí</span>
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">V4.2</span>
                </div>
                
                <div class="workflow-box after">
                    <div class="workflow-title">After (V4.2)</div>
                    <div class="workflow-steps">
                        <div class="workflow-step">
                            <span class="step-num">1</span>
                            Query Analysis
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">2</span>
                            Context Gathering
                        </div>
                        <div class="workflow-step new">
                            <span class="step-num">3</span>
                            <strong>Twin Simulation</strong> ‚ú®
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">4</span>
                            Experiment Design
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">5</span>
                            Power Analysis
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">6</span>
                            Validity Assessment
                        </div>
                        <div class="workflow-step">
                            <span class="step-num">7</span>
                            Template Generation
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="alert warning">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <div>
                    <strong>Decision Logic:</strong> If simulated ATE &lt; 0.05 (configurable threshold), the workflow recommends SKIP with simulation evidence. Otherwise, the prior estimate informs power analysis for more efficient sample size calculation.
                </div>
            </div>
        </section>
        
        <!-- Recommendations -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üìä</span> Simulation Recommendations</h2>
                <p>Three possible outcomes from digital twin simulations</p>
            </div>
            
            <div class="recommendation-cards">
                <div class="rec-card deploy">
                    <div class="rec-icon">‚úÖ</div>
                    <div class="rec-title">DEPLOY</div>
                    <div class="rec-desc">Proceed to real A/B test with optimized sample size</div>
                    <div class="rec-criteria">
                        <strong>Criteria:</strong><br>
                        ‚Ä¢ ATE ‚â• minimum threshold (0.05)<br>
                        ‚Ä¢ Confidence interval excludes zero<br>
                        ‚Ä¢ Effect meaningful and detectable
                    </div>
                </div>
                
                <div class="rec-card skip">
                    <div class="rec-icon">‚õî</div>
                    <div class="rec-title">SKIP</div>
                    <div class="rec-desc">Avoid test - predicted impact too small to justify cost</div>
                    <div class="rec-criteria">
                        <strong>Criteria:</strong><br>
                        ‚Ä¢ ATE &lt; minimum threshold<br>
                        ‚Ä¢ Effect size negligible<br>
                        ‚Ä¢ High confidence in prediction
                    </div>
                </div>
                
                <div class="rec-card refine">
                    <div class="rec-icon">üîß</div>
                    <div class="rec-title">REFINE</div>
                    <div class="rec-desc">Modify intervention parameters before proceeding</div>
                    <div class="rec-criteria">
                        <strong>Criteria:</strong><br>
                        ‚Ä¢ Confidence interval includes zero<br>
                        ‚Ä¢ High uncertainty in estimate<br>
                        ‚Ä¢ Effect heterogeneity suggests targeting
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Fidelity Tracking -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üìà</span> Fidelity Tracking</h2>
                <p>Validating simulation accuracy against real-world outcomes</p>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-icon fidelity">‚úì</div>
                    <div>
                        <div class="card-title">Addressing the Validation Paradox</div>
                        <div class="card-subtitle">To validate twins, you need real A/B tests‚Äîthe very thing you're trying to reduce</div>
                    </div>
                </div>
                
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    The Fidelity Tracker solves this by systematically comparing predictions against actual outcomes whenever real experiments are conducted. This builds a track record that calibrates confidence in future simulations.
                </p>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fidelity Grade</th>
                                <th>Prediction Error</th>
                                <th>Interpretation</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="grade-badge excellent">Excellent</span></td>
                                <td>&lt; 10%</td>
                                <td>Highly accurate predictions</td>
                                <td>High confidence in simulations</td>
                            </tr>
                            <tr>
                                <td><span class="grade-badge good">Good</span></td>
                                <td>10-20%</td>
                                <td>Reliable for screening decisions</td>
                                <td>Normal usage</td>
                            </tr>
                            <tr>
                                <td><span class="grade-badge fair">Fair</span></td>
                                <td>20-35%</td>
                                <td>Useful for directional guidance</td>
                                <td>Consider retraining</td>
                            </tr>
                            <tr>
                                <td><span class="grade-badge poor">Poor</span></td>
                                <td>&gt; 35%</td>
                                <td>Predictions unreliable</td>
                                <td>Retrain model immediately</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="alert success" style="margin-top: 20px;">
                    <span class="alert-icon">üîî</span>
                    <div>
                        <strong>Degradation Detection:</strong> The system automatically monitors fidelity over a 90-day rolling window. If prediction error increases by &gt;10% vs historical baseline, an alert is generated recommending model retraining.
                    </div>
                </div>
            </div>
        </section>
        
        <!-- LangGraph Tools -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üõ†Ô∏è</span> LangGraph Tools</h2>
                <p>Two new tools for the Experiment Designer agent</p>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon simulation">‚öóÔ∏è</div>
                        <div>
                            <div class="card-title">simulate_intervention</div>
                            <div class="card-subtitle">Pre-screen A/B tests before deployment</div>
                        </div>
                    </div>
                    
                    <div class="code-block">
<span class="comment"># Tool Inputs</span>
{
  "<span class="string">intervention_type</span>": "<span class="string">email_campaign</span>",
  "<span class="string">brand</span>": "<span class="string">Kisqali</span>",
  "<span class="string">target_population</span>": "<span class="string">hcp</span>",
  "<span class="string">channel</span>": "<span class="string">email</span>",
  "<span class="string">frequency</span>": <span class="number">2</span>,
  "<span class="string">duration_weeks</span>": <span class="number">8</span>,
  "<span class="string">target_deciles</span>": [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>],
  "<span class="string">twin_count</span>": <span class="number">10000</span>
}

<span class="comment"># Tool Output</span>
{
  "<span class="string">recommendation</span>": "<span class="string">deploy</span>",
  "<span class="string">simulated_ate</span>": <span class="number">0.087</span>,
  "<span class="string">confidence_interval</span>": [<span class="number">0.052</span>, <span class="number">0.122</span>],
  "<span class="string">recommended_sample_size</span>": <span class="number">450</span>,
  "<span class="string">simulation_confidence</span>": <span class="number">0.82</span>,
  "<span class="string">fidelity_warning</span>": <span class="keyword">false</span>,
  "<span class="string">top_segments</span>": [
    {"<span class="string">segment</span>": "<span class="string">Oncology</span>", "<span class="string">ate</span>": <span class="number">0.12</span>},
    {"<span class="string">segment</span>": "<span class="string">Decile 9-10</span>", "<span class="string">ate</span>": <span class="number">0.11</span>}
  ]
}
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon fidelity">‚úì</div>
                        <div>
                            <div class="card-title">validate_twin_fidelity</div>
                            <div class="card-subtitle">Compare predictions to actual outcomes</div>
                        </div>
                    </div>
                    
                    <div class="code-block">
<span class="comment"># Tool Inputs</span>
{
  "<span class="string">simulation_id</span>": "<span class="string">sim_abc123</span>",
  "<span class="string">actual_ate</span>": <span class="number">0.094</span>,
  "<span class="string">actual_ci_lower</span>": <span class="number">0.061</span>,
  "<span class="string">actual_ci_upper</span>": <span class="number">0.127</span>,
  "<span class="string">actual_sample_size</span>": <span class="number">512</span>,
  "<span class="string">validation_notes</span>": "<span class="string">Q4 campaign results</span>"
}

<span class="comment"># Tool Output</span>
{
  "<span class="string">tracking_id</span>": "<span class="string">fid_xyz789</span>",
  "<span class="string">prediction_error</span>": <span class="number">-0.074</span>,
  "<span class="string">absolute_error</span>": <span class="number">0.074</span>,
  "<span class="string">ci_coverage</span>": <span class="keyword">true</span>,
  "<span class="string">fidelity_grade</span>": "<span class="string">excellent</span>",
  "<span class="string">assessment_message</span>": "<span class="string">Prediction within 7.4% of actual - excellent fidelity</span>",
  "<span class="string">model_update_recommended</span>": <span class="keyword">false</span>
}
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Database Schema -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üóÑÔ∏è</span> Database Schema</h2>
                <p>Three new tables for digital twin persistence</p>
            </div>
            
            <div class="card">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Table</th>
                                <th>Purpose</th>
                                <th>Key Fields</th>
                                <th>Relationships</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>digital_twin_models</code></td>
                                <td>Stores trained twin generator models</td>
                                <td>model_id, twin_type, mlflow_run_id, fidelity_score, performance_metrics</td>
                                <td>‚Üí MLflow registry</td>
                            </tr>
                            <tr>
                                <td><code>twin_simulations</code></td>
                                <td>Stores simulation runs and results</td>
                                <td>simulation_id, model_id, intervention_config, simulated_ate, recommendation</td>
                                <td>‚Üí digital_twin_models</td>
                            </tr>
                            <tr>
                                <td><code>twin_fidelity_tracking</code></td>
                                <td>Validates predictions vs actuals</td>
                                <td>tracking_id, simulation_id, actual_ate, prediction_error, fidelity_grade</td>
                                <td>‚Üí twin_simulations, ‚Üí experiments</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <h4 style="margin-top: 25px; margin-bottom: 15px;">Helper Views</h4>
                <ul class="component-list">
                    <li class="component-item">
                        <span class="component-icon">üìä</span>
                        <span class="component-name">v_active_twin_models</span>
                        <span class="component-badge new">View</span>
                    </li>
                    <li class="component-item">
                        <span class="component-icon">üìä</span>
                        <span class="component-name">v_simulation_summary</span>
                        <span class="component-badge new">View</span>
                    </li>
                    <li class="component-item">
                        <span class="component-icon">üìä</span>
                        <span class="component-name">v_model_fidelity_history</span>
                        <span class="component-badge new">View</span>
                    </li>
                    <li class="component-item">
                        <span class="component-icon">üîî</span>
                        <span class="component-name">v_fidelity_degradation_alerts</span>
                        <span class="component-badge new">View</span>
                    </li>
                </ul>
            </div>
        </section>
        
        <!-- File Structure -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üìÅ</span> Implementation Files</h2>
                <p>New files added in E2I v4.2.0</p>
            </div>
            
            <div class="card">
                <div class="file-tree">
                    <div class="file-tree-item folder">üìÅ src/</div>
                    <div class="file-tree-item folder" style="padding-left: 20px;">üìÅ digital_twin/</div>
                    <div class="file-tree-item new-file" style="padding-left: 40px;">üìÑ __init__.py</div>
                    <div class="file-tree-item new-file" style="padding-left: 40px;">üìÑ twin_generator.py (500+ lines)</div>
                    <div class="file-tree-item new-file" style="padding-left: 40px;">üìÑ simulation_engine.py (600+ lines)</div>
                    <div class="file-tree-item new-file" style="padding-left: 40px;">üìÑ fidelity_tracker.py (400+ lines)</div>
                    <div class="file-tree-item new-file" style="padding-left: 40px;">üìÑ twin_repository.py (300+ lines)</div>
                    <div class="file-tree-item folder" style="padding-left: 40px;">üìÅ models/</div>
                    <div class="file-tree-item new-file" style="padding-left: 60px;">üìÑ __init__.py</div>
                    <div class="file-tree-item new-file" style="padding-left: 60px;">üìÑ twin_models.py</div>
                    <div class="file-tree-item new-file" style="padding-left: 60px;">üìÑ simulation_models.py</div>
                    <div class="file-tree-item folder" style="padding-left: 20px;">üìÅ agents/experiment_designer/tools/</div>
                    <div class="file-tree-item new-file" style="padding-left: 40px;">üìÑ simulate_intervention_tool.py (500+ lines)</div>
                    <div class="file-tree-item new-file" style="padding-left: 40px;">üìÑ validate_twin_fidelity_tool.py (400+ lines)</div>
                    <div class="file-tree-item folder">üìÅ database/migrations/</div>
                    <div class="file-tree-item new-file" style="padding-left: 20px;">üìÑ 011_digital_twin_tables.sql</div>
                </div>
            </div>
            
            <div class="alert info" style="margin-top: 20px;">
                <span class="alert-icon">üìù</span>
                <div>
                    <strong>Total Implementation:</strong> 12 new files, ~3,500 lines of production-ready Python code, comprehensive SQL migration with 3 tables, 4 views, and helper functions.
                </div>
            </div>
        </section>
        
        <!-- Configuration -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">‚öôÔ∏è</span> Configuration</h2>
                <p>Key parameters for digital twin behavior</p>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <h4 style="margin-bottom: 15px;">digital_twin_config.yaml</h4>
                    <div class="code-block">
<span class="comment"># Effect Thresholds</span>
<span class="keyword">min_effect_threshold</span>: <span class="number">0.05</span>  <span class="comment"># Below this, recommend SKIP</span>
<span class="keyword">confidence_threshold</span>: <span class="number">0.70</span>  <span class="comment"># Minimum confidence for recommendations</span>

<span class="comment"># Simulation Parameters</span>
<span class="keyword">default_twin_count</span>: <span class="number">10000</span>
<span class="keyword">max_twin_count</span>: <span class="number">50000</span>
<span class="keyword">simulation_timeout_seconds</span>: <span class="number">300</span>

<span class="comment"># Fidelity Tracking</span>
<span class="keyword">min_fidelity_score</span>: <span class="number">0.7</span>
<span class="keyword">fidelity_validation_window_days</span>: <span class="number">90</span>
                    </div>
                </div>
                
                <div class="card">
                    <h4 style="margin-bottom: 15px;">domain_vocabulary.yaml v3.2.0 Additions</h4>
                    <div class="code-block">
<span class="comment"># New ENUMs for Digital Twins</span>
<span class="keyword">twin_types</span>:
  - hcp
  - patient
  - territory

<span class="keyword">simulation_statuses</span>:
  - pending
  - running
  - completed
  - failed

<span class="keyword">simulation_recommendations</span>:
  - deploy
  - skip
  - refine

<span class="keyword">fidelity_grades</span>:
  - excellent
  - good
  - fair
  - poor
  - unvalidated
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Risk Mitigations -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">üõ°Ô∏è</span> Risk Mitigations</h2>
                <p>Addressing the critical challenges identified in the assessment</p>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, var(--danger), #fca5a5);">‚ö†Ô∏è</div>
                        <div>
                            <div class="card-title">Fidelity Problem</div>
                            <div class="card-subtitle">Twins only as good as generating model</div>
                        </div>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        <strong>Risk:</strong> False positives (simulations show effect that doesn't exist) or false negatives (miss real opportunities).
                    </p>
                    <div class="alert success">
                        <span class="alert-icon">‚úì</span>
                        <div>
                            <strong>Mitigation:</strong> Mandatory fidelity tracking with automatic degradation detection. Every simulation is recorded and validated against actual outcomes when available. Poor fidelity triggers retraining alerts.
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, var(--warning), #fcd34d);">üîÑ</div>
                        <div>
                            <div class="card-title">Validation Paradox</div>
                            <div class="card-subtitle">Need real tests to validate what's avoiding tests</div>
                        </div>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        <strong>Risk:</strong> Circular dependency - validating twins requires real A/B tests, but twins are meant to reduce A/B tests.
                    </p>
                    <div class="alert success">
                        <span class="alert-icon">‚úì</span>
                        <div>
                            <strong>Mitigation:</strong> Frame as hypothesis refinement, not replacement. Promising simulations (DEPLOY recommendation) always proceed to real tests, building the validation corpus over time.
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, var(--info), #93c5fd);">üîÅ</div>
                        <div>
                            <div class="card-title">Reinforcing Biases</div>
                            <div class="card-subtitle">Model learns from historical strategic errors</div>
                        </div>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        <strong>Risk:</strong> If past data contains strategic errors, twins may perpetuate them.
                    </p>
                    <div class="alert success">
                        <span class="alert-icon">‚úì</span>
                        <div>
                            <strong>Mitigation:</strong> Conservative SKIP threshold. Only clearly unviable interventions are filtered out. Borderline cases (REFINE) proceed with human judgment. Heterogeneity analysis surfaces segment-specific opportunities.
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">‚è±Ô∏è</div>
                        <div>
                            <div class="card-title">Computational Cost</div>
                            <div class="card-subtitle">Simulating large populations is resource-intensive</div>
                        </div>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        <strong>Risk:</strong> Simulation latency could delay experiment design workflow.
                    </p>
                    <div class="alert success">
                        <span class="alert-icon">‚úì</span>
                        <div>
                            <strong>Mitigation:</strong> Redis caching for repeated queries. Batch processing mode for bulk simulations. Configurable timeout (300s default). Async simulation option for complex scenarios.
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Implementation Checklist -->
        <section class="section">
            <div class="section-header">
                <h2><span class="icon">‚úÖ</span> Implementation Checklist</h2>
                <p>Phased rollout plan for Digital Twin capability</p>
            </div>
            
            <div class="card">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Phase</th>
                                <th>Timeline</th>
                                <th>Tasks</th>
                                <th>Deliverables</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>1. Infrastructure</strong></td>
                                <td>Day 1-2</td>
                                <td>Create directories, run SQL migration, update configs</td>
                                <td>Schema deployed, vocabulary v3.2.0</td>
                            </tr>
                            <tr>
                                <td><strong>2. Core Implementation</strong></td>
                                <td>Day 3-5</td>
                                <td>Implement TwinGenerator, SimulationEngine, FidelityTracker, Repository</td>
                                <td>4 core Python modules</td>
                            </tr>
                            <tr>
                                <td><strong>3. Agent Integration</strong></td>
                                <td>Day 6-7</td>
                                <td>Create LangGraph tools, update Experiment Designer workflow</td>
                                <td>2 new tools, updated agent</td>
                            </tr>
                            <tr>
                                <td><strong>4. API & Testing</strong></td>
                                <td>Day 8-10</td>
                                <td>Implement API endpoints, write unit/integration tests</td>
                                <td>API routes, test suite</td>
                            </tr>
                            <tr>
                                <td><strong>5. Documentation & Review</strong></td>
                                <td>Day 11-12</td>
                                <td>Complete docs, stakeholder review, deployment planning</td>
                                <td>This document, v4.2 release</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <div style="text-align: center; padding: 40px 0; color: var(--text-muted); border-top: 1px solid var(--border); margin-top: 50px;">
            <p>E2I Causal Analytics Platform ‚Ä¢ Digital Twin Implementation v4.2.0</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Integrates with: MLflow ‚Ä¢ Feast ‚Ä¢ PostgreSQL ‚Ä¢ Redis ‚Ä¢ LangGraph
            </p>
        </div>
    </div>
</body>
</html>
