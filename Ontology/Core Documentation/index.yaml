# =============================================================================
# DOMAIN VOCABULARY - MASTER INDEX
# =============================================================================
# Version: 6.0.0 (Modular)
# Last Updated: 2026-01-12
# Purpose: Single source of truth for E2I platform terminology and ontology
#
# This file serves as the index for all vocabulary modules. Each section is
# stored in a separate file for better maintainability and version control.
#
# Usage:
#   from config.domain_vocabulary import load_vocabulary
#   vocab = load_vocabulary()  # Loads all modules
#   
#   # Or load specific module:
#   from config.domain_vocabulary import load_module
#   ontology = load_module('ontology')
# =============================================================================

_metadata:
  version: "6.0.0"
  last_updated: "2026-01-12"
  maintainer: "E2I Platform Team"
  structure: "modular"
  
  architecture:
    description: "Modular vocabulary with 6 major categories"
    total_files: 18
    total_lines: ~1700
    
  benefits:
    - "Easier maintenance - modify one file without affecting others"
    - "Better version control - smaller diffs, clearer changes"
    - "Parallel development - multiple team members can work simultaneously"
    - "Selective loading - load only needed modules"
    - "Clear ownership - each module can have designated maintainer"

# =============================================================================
# MODULE REGISTRY
# =============================================================================

modules:
  
  # ---------------------------------------------------------------------------
  # CORE MODULES (Business Entities & Agent Architecture)
  # ---------------------------------------------------------------------------
  
  core_entities:
    file: "core/01_entities.yaml"
    description: "Core business entities (brands, regions, therapeutic areas)"
    lines: ~100
    contains:
      - 3 pharmaceutical brands
      - 4 geographic regions
      - 3 therapeutic areas
      - Data source providers
    maintainer: "Business Operations Team"
    
  agent_architecture:
    file: "core/02_agents.yaml"
    description: "18-agent architecture across 6 tiers"
    lines: ~150
    contains:
      - Tier 1 (5 agents) - Causal Discovery
      - Tier 2 (4 agents) - Validation & Refutation
      - Tier 3 (4 agents) - Business Translation
      - Tier 4 (2 agents) - Digital Twin & Simulation
      - Tier 5 (2 agents) - Feedback Loop
      - Tier 6 (1 agent) - Self-Improvement
    maintainer: "Agent Development Team"
    
  patient_hcp_attributes:
    file: "core/03_attributes.yaml"
    description: "Patient journey stages, HCP attributes, trigger types"
    lines: ~100
    contains:
      - 7 patient journey stages
      - 13 HCP specialties
      - HCP priority tiers
      - Trigger types and priorities
    maintainer: "Clinical Operations Team"
  
  # ---------------------------------------------------------------------------
  # ONTOLOGY MODULES (Semantic Graph Schema)
  # ---------------------------------------------------------------------------
  
  node_types:
    file: "ontology/01_node_types.yaml"
    description: "8 node types with complete property schemas"
    lines: ~300
    contains:
      - Patient, HCP, Brand, Region (core entities)
      - KPI, CausalPath, Trigger, Agent (operational entities)
      - Property definitions (type, constraints, defaults)
    maintainer: "Data Architecture Team"
    integration:
      - schema_compiler.py (generates FalkorDB constraints)
      - validator.py (runtime validation)
    
  edge_types:
    file: "ontology/02_edge_types.yaml"
    description: "15 edge types with cardinality and properties"
    lines: ~200
    contains:
      - Relationship types (TREATED_BY, PRESCRIBED, PRESCRIBES)
      - Geographic links (PRACTICES_IN, LOCATED_IN)
      - Influence networks (INFLUENCES)
      - Causal relationships (CAUSES, IMPACTS)
      - Agent activity (ANALYZES, DISCOVERED, GENERATED)
      - Inferred edges (INDIRECTLY_INFLUENCES, HIGH_POTENTIAL_PRESCRIBER)
    maintainer: "Data Architecture Team"
    
  inference_rules:
    file: "ontology/03_inference_rules.yaml"
    description: "5 inference rules for automated discovery"
    lines: ~150
    contains:
      - indirect_treatment (daily)
      - causal_chain (weekly)
      - hcp_influence_propagation (weekly)
      - patient_journey_progression (monthly)
      - roi_opportunity_flagging (weekly)
    maintainer: "Data Science Team"
    integration:
      - inference_engine.py (executes Cypher queries)
    
  validation_rules:
    file: "ontology/04_validation_rules.yaml"
    description: "6 validation rules (strict/warning)"
    lines: ~80
    contains:
      - journey_stage_progression (warning)
      - specialty_brand_alignment (warning)
      - confidence_threshold (strict)
      - no_causal_cycles (strict)
      - trigger_expiration (strict)
      - one_primary_hcp (strict)
    maintainer: "Data Quality Team"
    integration:
      - validator.py (runtime checks)
    
  falkordb_config:
    file: "ontology/05_falkordb_config.yaml"
    description: "FalkorDB compilation configuration"
    lines: ~100
    contains:
      - Graph name (e2i_semantic)
      - 9 unique constraints
      - 45+ indexes for performance
      - Query optimization settings
    maintainer: "Infrastructure Team"
    integration:
      - schema_compiler.py (generates DDL)
  
  # ---------------------------------------------------------------------------
  # OPERATIONS MODULES (Agent Workflows & Experiments)
  # ---------------------------------------------------------------------------
  
  agent_tools_workflows:
    file: "operations/01_agent_tools.yaml"
    description: "Tools and multi-node workflows for agents"
    lines: ~120
    contains:
      - Tool lists (DoWhy, EconML, NetworkX, etc.)
      - Causal methods (backdoor, frontdoor, DML, causal forest)
      - Multi-node workflows (graph_builder → estimation → refutation)
      - Gate controls (require_dag_approval, gate_on_refutation_failure)
    maintainer: "Agent Development Team"
    integration:
      - agent_config.yaml (references tool names)
    
  experiment_lifecycle:
    file: "operations/02_experiments.yaml"
    description: "Experiment state machine and transitions"
    lines: ~120
    contains:
      - 14 experiment states
      - 23 valid state transitions
      - Stopping reasons (early_success, futility, safety_concern)
      - Final decisions (implement_treatment, implement_control)
    maintainer: "Experiment Design Team"
    integration:
      - experiment_lifecycle.yaml (state machine logic)
    
  confidence_scoring:
    file: "operations/03_confidence.yaml"
    description: "Confidence calculation components and tiers"
    lines: ~110
    contains:
      - 4 confidence components
      - 3 confidence tiers (high ≥0.75, moderate 0.50-0.74, low <0.50)
      - 10 reduction rules (penalties)
      - 7 boost rules (bonuses)
    maintainer: "Causal Analytics Team"
    integration:
      - confidence_logic.yaml (calculation formulas)
    
  digital_twin_simulation:
    file: "operations/04_digital_twin.yaml"
    description: "Digital twin algorithms and simulation interventions"
    lines: ~80
    contains:
      - 4 twin algorithms (RF, GBM, XGBoost, LightGBM)
      - 6 simulation interventions
      - 3 recommendation tiers (deploy, refine, skip)
      - Fidelity grading (excellent/good/fair/poor)
    maintainer: "Digital Twin Team"
    integration:
      - digital_twin_config.yaml (model hyperparameters)
  
  # ---------------------------------------------------------------------------
  # INFRASTRUCTURE MODULES (Monitoring, Visualization, Time)
  # ---------------------------------------------------------------------------
  
  drift_monitoring:
    file: "infrastructure/01_drift.yaml"
    description: "Drift detection methods and thresholds"
    lines: ~70
    contains:
      - 3 drift types (data, model, concept)
      - 4 detection methods (PSI, KS test, Chi-square, Jensen-Shannon)
      - PSI thresholds (no shift <0.1, moderate 0.1-0.25, significant >0.25)
      - Alert severity (critical, warning, info)
    maintainer: "Model Monitoring Team"
    integration:
      - drift_monitoring.yaml (detection algorithms)
    
  visualization_kpis:
    file: "infrastructure/02_visualization.yaml"
    description: "Chart types, libraries, and KPI categories"
    lines: ~100
    contains:
      - 18 chart types
      - 4 visualization libraries (Chart.js, Plotly, D3.js, CSS custom)
      - Library data point limits
      - 6 KPI categories
    maintainer: "Frontend Team"
    integration:
      - visualization_config.yaml (rendering logic)
    
  time_references:
    file: "infrastructure/03_time.yaml"
    description: "Time periods, granularities, and observation windows"
    lines: ~60
    contains:
      - Standard periods (Q1-Q4, YTD, MTD, WTD)
      - 5 granularities (daily, weekly, monthly, quarterly, yearly)
      - Observation windows (script_conversion: 21 days, hcp_churn: 90 days)
    maintainer: "Data Engineering Team"
  
  # ---------------------------------------------------------------------------
  # MLOPS MODULES (Feature Store, Observability, Tracing)
  # ---------------------------------------------------------------------------
  
  mlops_feature_store:
    file: "mlops/01_mlops.yaml"
    description: "MLOps pipeline stages and feature store providers"
    lines: ~80
    contains:
      - 6 pipeline stages (development → archived)
      - 3 feature store providers (Supabase, Redis, MLflow)
      - Feature freshness states (fresh, stale, expired)
      - 6 HPO optimizers + 5 pruners
    maintainer: "MLOps Team"
    integration:
      - mlops_config.yaml (connection strings, tracking URIs)
    
  observability_tracing:
    file: "mlops/02_observability.yaml"
    description: "Trace spans, circuit breakers, and sampling"
    lines: ~70
    contains:
      - 7 trace span types (agent_execution, tool_call, llm_call)
      - 3 circuit breaker states (closed, open, half_open)
      - 3 observability metrics (counter, gauge, histogram)
      - 5 sampling modes
    maintainer: "DevOps Team"
    integration:
      - observability_config.yaml (Opik API keys, Prometheus endpoints)
  
  # ---------------------------------------------------------------------------
  # FEEDBACK MODULES (Outcome Truth & Self-Improvement)
  # ---------------------------------------------------------------------------
  
  outcome_truth:
    file: "feedback/01_outcome_truth.yaml"
    description: "Ground truth labels and edge cases"
    lines: ~70
    contains:
      - 5 outcome labels (POSITIVE, NEGATIVE, INDETERMINATE, EXCLUDED, PENDING)
      - 4 truth sources (treatment_events, business_metrics, triggers)
      - 9 edge case types (new_hcp, seasonal_effects, data_lag)
    maintainer: "Model Validation Team"
    integration:
      - outcome_truth_config.yaml (labeling logic)
    
  self_improvement:
    file: "feedback/02_self_improvement.yaml"
    description: "Evaluation rubrics and improvement decisions"
    lines: ~60
    contains:
      - 5 rubric criteria (causal_validity, actionability, evidence_chain)
      - 4 improvement decisions (log_only, suggestion, auto_update, escalate)
      - 3 prompt risk levels (low, medium, high)
    maintainer: "AI Safety Team"
    integration:
      - self_improvement_config.yaml (LLM-as-judge prompts)

# =============================================================================
# LOADING INSTRUCTIONS
# =============================================================================

loading:
  description: "How to load vocabulary modules"
  
  python_loader:
    file: "config/domain_vocabulary/__init__.py"
    usage: |
      from config.domain_vocabulary import load_vocabulary, load_module
      
      # Load all modules
      vocab = load_vocabulary()
      
      # Access specific content
      brands = vocab['core_entities']['brands']
      node_types = vocab['node_types']
      
      # Load single module
      ontology = load_module('node_types')
      patient_schema = ontology['Patient']
  
  integration_points:
    schema_compiler:
      modules: ["node_types", "edge_types", "falkordb_config"]
      usage: "Generates FalkorDB constraints and indexes"
    
    validator:
      modules: ["node_types", "edge_types", "validation_rules"]
      usage: "Runtime validation of graph data"
    
    inference_engine:
      modules: ["inference_rules"]
      usage: "Executes inference rules on schedule"
    
    grafiti_config:
      modules: ["node_types", "edge_types", "validation_rules"]
      usage: "Validated wrapper for Grafiti operations"
    
    agents:
      modules: ["agent_architecture", "agent_tools_workflows", "core_entities"]
      usage: "Reference terminology and tool lists"

# =============================================================================
# MIGRATION GUIDE
# =============================================================================

migration:
  from_version: "6.0.0 (monolithic)"
  to_version: "6.0.0 (modular)"
  
  steps:
    1: "Backup existing domain_vocabulary_enhanced.yaml"
    2: "Deploy modular structure to config/domain_vocabulary/"
    3: "Update imports in all agents and services"
    4: "Test vocabulary loading in development environment"
    5: "Run ontology validation tests"
    6: "Deploy to production"
  
  breaking_changes: []
  
  backwards_compatibility:
    description: "Loader provides same interface as monolithic version"
    example: |
      # Old code (still works):
      vocab = load_vocabulary()
      brands = vocab['brands']
      
      # New code (more explicit):
      vocab = load_vocabulary()
      brands = vocab['core_entities']['brands']

# =============================================================================
# MAINTENANCE
# =============================================================================

maintenance:
  adding_new_vocabulary:
    1: "Identify appropriate module (core/ontology/operations/infrastructure/mlops/feedback)"
    2: "Add content to module YAML file"
    3: "Update module line count in this index"
    4: "Run validation: python validate_vocabulary.py"
    5: "Update version in _metadata"
    6: "Commit with clear message"
  
  modifying_ontology:
    1: "Update appropriate ontology module (node_types/edge_types/inference_rules)"
    2: "Recompile schema: python schema_compiler.py"
    3: "Test validation: python validator.py --test-mode"
    4: "Update FalkorDB if schema changes"
    5: "Deploy to production"
  
  version_control:
    strategy: "Semantic versioning (MAJOR.MINOR.PATCH)"
    major: "Breaking changes (e.g., module restructure)"
    minor: "New modules or significant additions"
    patch: "Bug fixes, clarifications within existing modules"

# =============================================================================
# TESTING
# =============================================================================

testing:
  validation_script: "tests/validate_vocabulary.py"
  
  checks:
    - "YAML syntax validation for all modules"
    - "Cross-reference validation (e.g., agents reference valid tools)"
    - "Ontology completeness (all node types have required properties)"
    - "No duplicate definitions across modules"
    - "All enum values are unique within their domain"
  
  command: "pytest tests/test_domain_vocabulary.py -v"
  
  expected_result: "All 25+ tests pass"
