<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E2I Cognitive RAG √ó DSPy Integration</title>
    <style>
        :root {
            --phase-1: #3b82f6;
            --phase-2: #8b5cf6;
            --phase-3: #ec4899;
            --phase-4: #f59e0b;
            --dspy-color: #22c55e;
            --memory-working: #ef4444;
            --memory-episodic: #3b82f6;
            --memory-semantic: #8b5cf6;
            --memory-procedural: #f59e0b;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 40px;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--phase-2), var(--dspy-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle { color: var(--text-secondary); font-size: 1.1rem; }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 40px 0 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* Cognitive Cycle */
        .cycle-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 60px;
        }

        .phase-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            border-top: 4px solid;
        }

        .phase-card:nth-child(1) { border-top-color: var(--phase-1); }
        .phase-card:nth-child(2) { border-top-color: var(--phase-2); }
        .phase-card:nth-child(3) { border-top-color: var(--phase-3); }
        .phase-card:nth-child(4) { border-top-color: var(--phase-4); }

        .phase-number {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 16px;
        }

        .phase-card:nth-child(1) .phase-number { background: var(--phase-1); }
        .phase-card:nth-child(2) .phase-number { background: var(--phase-2); }
        .phase-card:nth-child(3) .phase-number { background: var(--phase-3); }
        .phase-card:nth-child(4) .phase-number { background: var(--phase-4); }

        .phase-name {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .phase-node {
            font-family: monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .phase-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .dspy-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(34, 197, 94, 0.15);
            color: var(--dspy-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .signature-list {
            list-style: none;
        }

        .signature-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .signature-name {
            font-weight: 600;
            color: var(--dspy-color);
            font-family: monospace;
        }

        .signature-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Arrow between phases */
        .phase-arrow {
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: var(--text-secondary);
            z-index: 10;
        }

        .phase-card:last-child .phase-arrow { display: none; }

        /* Memory Integration */
        .memory-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 40px;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 24px;
        }

        .memory-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid;
        }

        .memory-card.working { border-left-color: var(--memory-working); }
        .memory-card.episodic { border-left-color: var(--memory-episodic); }
        .memory-card.semantic { border-left-color: var(--memory-semantic); }
        .memory-card.procedural { border-left-color: var(--memory-procedural); }

        .memory-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .memory-card.working .memory-name { color: var(--memory-working); }
        .memory-card.episodic .memory-name { color: var(--memory-episodic); }
        .memory-card.semantic .memory-name { color: var(--memory-semantic); }
        .memory-card.procedural .memory-name { color: var(--memory-procedural); }

        .memory-tech {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-family: monospace;
            margin-bottom: 12px;
        }

        .memory-dspy {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Optimization Targets */
        .optimization-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        .optimization-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .optimization-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .optimization-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--dspy-color), #16a34a);
        }

        .optimization-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .optimization-phase {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .metric-list {
            list-style: none;
        }

        .metric-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
        }

        .metric-item:last-child { border-bottom: none; }

        .metric-weight {
            background: rgba(34, 197, 94, 0.2);
            color: var(--dspy-color);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Multi-hop Flow */
        .hop-flow {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 40px;
        }

        .hop-diagram {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 0;
        }

        .hop-step {
            text-align: center;
            flex: 1;
        }

        .hop-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin: 0 auto 12px;
        }

        .hop-1 .hop-circle { background: linear-gradient(135deg, var(--memory-episodic), #2563eb); }
        .hop-2 .hop-circle { background: linear-gradient(135deg, var(--memory-semantic), #7c3aed); }
        .hop-3 .hop-circle { background: linear-gradient(135deg, var(--memory-procedural), #d97706); }
        .hop-4 .hop-circle { background: linear-gradient(135deg, var(--dspy-color), #16a34a); }

        .hop-label { font-weight: 600; margin-bottom: 4px; }
        .hop-question { font-size: 0.85rem; color: var(--text-secondary); }

        .hop-arrow {
            font-size: 2rem;
            color: var(--text-secondary);
        }

        .hop-dspy-overlay {
            background: rgba(34, 197, 94, 0.1);
            border: 1px dashed var(--dspy-color);
            border-radius: 12px;
            padding: 16px;
            margin-top: 24px;
        }

        .hop-dspy-title {
            color: var(--dspy-color);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hop-dspy-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Benefits Section */
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 24px;
        }

        .benefit-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .benefit-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--dspy-color), var(--phase-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .benefit-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        @media (max-width: 1200px) {
            .cycle-container { grid-template-columns: repeat(2, 1fr); }
            .memory-grid { grid-template-columns: repeat(2, 1fr); }
            .optimization-grid { grid-template-columns: 1fr; }
            .benefits-grid { grid-template-columns: repeat(2, 1fr); }
            .phase-arrow { display: none; }
        }

        @media (max-width: 768px) {
            .cycle-container { grid-template-columns: 1fr; }
            .memory-grid { grid-template-columns: 1fr; }
            .hop-diagram { flex-direction: column; gap: 24px; }
            .hop-arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Cognitive RAG √ó DSPy Integration</h1>
            <p class="subtitle">Optimizing the 4-Phase Cognitive Cycle with Learnable Prompts</p>
        </header>

        <!-- 4-Phase Cognitive Cycle with DSPy -->
        <div class="section-title">üîÑ 4-Phase Cognitive Cycle + DSPy Signatures</div>
        
        <div class="cycle-container">
            <!-- Phase 1: Summarizer -->
            <div class="phase-card">
                <div class="phase-number">1</div>
                <div class="phase-name">Summarizer</div>
                <div class="phase-node">summarizer_node</div>
                <div class="phase-desc">Input & context pruning. Prepares query for investigation.</div>
                
                <div class="dspy-badge">‚ú® 3 DSPy Signatures</div>
                
                <ul class="signature-list">
                    <li class="signature-item">
                        <div class="signature-name">QueryRewriteSignature</div>
                        <div class="signature-desc">Optimizes query for hybrid retrieval (dense + sparse + graph)</div>
                    </li>
                    <li class="signature-item">
                        <div class="signature-name">EntityExtractionSignature</div>
                        <div class="signature-desc">Extracts brands, regions, HCPs, stages from query</div>
                    </li>
                    <li class="signature-item">
                        <div class="signature-name">IntentClassificationSignature</div>
                        <div class="signature-desc">Routes to CAUSAL | GAP | PREDICTION | EXPERIMENT</div>
                    </li>
                </ul>
                <div class="phase-arrow">‚Üí</div>
            </div>

            <!-- Phase 2: Investigator -->
            <div class="phase-card">
                <div class="phase-number">2</div>
                <div class="phase-name">Investigator</div>
                <div class="phase-node">investigator_node</div>
                <div class="phase-desc">Multi-hop retrieval across memory. Builds evidence trail.</div>
                
                <div class="dspy-badge">‚ú® 3 DSPy Signatures</div>
                
                <ul class="signature-list">
                    <li class="signature-item">
                        <div class="signature-name">InvestigationPlanSignature</div>
                        <div class="signature-desc">Plans hop strategy and early-stop criteria</div>
                    </li>
                    <li class="signature-item">
                        <div class="signature-name">HopDecisionSignature</div>
                        <div class="signature-desc">Decides next memory hop based on evidence so far</div>
                    </li>
                    <li class="signature-item">
                        <div class="signature-name">EvidenceRelevanceSignature</div>
                        <div class="signature-desc">Scores and filters retrieved evidence</div>
                    </li>
                </ul>
                <div class="phase-arrow">‚Üí</div>
            </div>

            <!-- Phase 3: Agent -->
            <div class="phase-card">
                <div class="phase-number">3</div>
                <div class="phase-name">Agent</div>
                <div class="phase-node">agent_node</div>
                <div class="phase-desc">Synthesis & action. Routes to E2I agents, generates response.</div>
                
                <div class="dspy-badge">‚ú® 3 DSPy Signatures</div>
                
                <ul class="signature-list">
                    <li class="signature-item">
                        <div class="signature-name">EvidenceSynthesisSignature</div>
                        <div class="signature-desc">Integrates evidence into coherent answer</div>
                    </li>
                    <li class="signature-item">
                        <div class="signature-name">AgentRoutingSignature</div>
                        <div class="signature-desc">Routes to causal_impact, gap_analyzer, etc.</div>
                    </li>
                    <li class="signature-item">
                        <div class="signature-name">VisualizationConfigSignature</div>
                        <div class="signature-desc">Generates chart configuration for insights</div>
                    </li>
                </ul>
                <div class="phase-arrow">‚Üí</div>
            </div>

            <!-- Phase 4: Reflector -->
            <div class="phase-card">
                <div class="phase-number">4</div>
                <div class="phase-name">Reflector</div>
                <div class="phase-node">reflector_node</div>
                <div class="phase-desc">Learning & self-updating. Runs async after response.</div>
                
                <div class="dspy-badge">‚ú® 2 DSPy Signatures + Signal Collection</div>
                
                <ul class="signature-list">
                    <li class="signature-item">
                        <div class="signature-name">MemoryWorthinessSignature</div>
                        <div class="signature-desc">Evaluates if interaction should be remembered</div>
                    </li>
                    <li class="signature-item">
                        <div class="signature-name">ProcedureLearningSignature</div>
                        <div class="signature-desc">Extracts successful patterns for procedural memory</div>
                    </li>
                    <li class="signature-item">
                        <div class="signature-name" style="color: var(--phase-4);">‚Üí Feedback Learner</div>
                        <div class="signature-desc">Collects signals for MIPROv2 optimization</div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Multi-hop Investigation with DSPy -->
        <div class="hop-flow">
            <div class="section-title" style="margin: 0 0 24px 0;">üîç Multi-Hop Investigation Flow (DSPy-Optimized)</div>
            
            <div class="hop-diagram">
                <div class="hop-step hop-1">
                    <div class="hop-circle">üìñ</div>
                    <div class="hop-label">HOP 1: Episodic</div>
                    <div class="hop-question">"What happened?"</div>
                </div>
                <div class="hop-arrow">‚Üí</div>
                <div class="hop-step hop-2">
                    <div class="hop-circle">üï∏Ô∏è</div>
                    <div class="hop-label">HOP 2: Semantic</div>
                    <div class="hop-question">"Who/What related?"</div>
                </div>
                <div class="hop-arrow">‚Üí</div>
                <div class="hop-step hop-3">
                    <div class="hop-circle">üîß</div>
                    <div class="hop-label">HOP 3: Procedural</div>
                    <div class="hop-question">"How to solve?"</div>
                </div>
                <div class="hop-arrow">‚Üí</div>
                <div class="hop-step hop-4">
                    <div class="hop-circle">‚úÖ</div>
                    <div class="hop-label">HOP 4: Refinement</div>
                    <div class="hop-question">"Sufficient evidence?"</div>
                </div>
            </div>

            <div class="hop-dspy-overlay">
                <div class="hop-dspy-title">‚ö° DSPy HopDecisionSignature</div>
                <div class="hop-dspy-desc">
                    At each hop, DSPy-optimized prompts decide: <strong>Which memory to query next?</strong> 
                    <strong>What specific query to use?</strong> <strong>When to stop?</strong> 
                    This replaces hardcoded hop logic with learned, optimizable decision-making.
                </div>
            </div>
        </div>

        <!-- Memory Integration -->
        <div class="memory-section">
            <div class="section-title" style="margin: 0 0 8px 0;">üß† Memory Architecture √ó DSPy Integration</div>
            <p style="color: var(--text-secondary); margin-bottom: 24px;">Each memory type provides training signals and receives optimized retrieval prompts</p>
            
            <div class="memory-grid">
                <div class="memory-card working">
                    <div class="memory-name">Working Memory</div>
                    <div class="memory-tech">Redis + LangGraph MemorySaver</div>
                    <div class="memory-dspy">
                        <strong>DSPy Role:</strong> Context compression signals ‚Üí optimizes how much history to include in prompts
                    </div>
                </div>
                <div class="memory-card episodic">
                    <div class="memory-name">Episodic Memory</div>
                    <div class="memory-tech">Supabase + pgvector</div>
                    <div class="memory-dspy">
                        <strong>DSPy Role:</strong> Retrieval quality signals ‚Üí optimizes query rewriting for vector search
                    </div>
                </div>
                <div class="memory-card semantic">
                    <div class="memory-name">Semantic Memory</div>
                    <div class="memory-tech">FalkorDB + Graphity</div>
                    <div class="memory-dspy">
                        <strong>DSPy Role:</strong> Graph traversal signals ‚Üí optimizes entity extraction for Cypher queries
                    </div>
                </div>
                <div class="memory-card procedural">
                    <div class="memory-name">Procedural Memory</div>
                    <div class="memory-tech">Supabase + pgvector</div>
                    <div class="memory-dspy">
                        <strong>DSPy Role:</strong> Procedure effectiveness ‚Üí learns which tool sequences work best
                    </div>
                </div>
            </div>
        </div>

        <!-- Optimization Targets -->
        <div class="section-title">üéØ DSPy Optimization Metrics by Phase</div>
        
        <div class="optimization-grid">
            <div class="optimization-card">
                <div class="optimization-header">
                    <div class="optimization-icon">üìù</div>
                    <div>
                        <div class="optimization-title">Summarizer Metric</div>
                        <div class="optimization-phase">Phase 1 Optimization</div>
                    </div>
                </div>
                <ul class="metric-list">
                    <li class="metric-item">
                        <span class="metric-weight">+0.2</span>
                        Query more specific than original
                    </li>
                    <li class="metric-item">
                        <span class="metric-weight">+0.3</span>
                        At least one entity extracted
                    </li>
                    <li class="metric-item">
                        <span class="metric-weight">+0.3</span>
                        Intent not "GENERAL"
                    </li>
                    <li class="metric-item">
                        <span class="metric-weight">+0.2</span>
                        Domain-specific keywords
                    </li>
                </ul>
            </div>

            <div class="optimization-card">
                <div class="optimization-header">
                    <div class="optimization-icon">üîç</div>
                    <div>
                        <div class="optimization-title">Investigator Metric</div>
                        <div class="optimization-phase">Phase 2 Optimization</div>
                    </div>
                </div>
                <ul class="metric-list">
                    <li class="metric-item">
                        <span class="metric-weight">+0.4</span>
                        Evidence found (up to 4 pieces)
                    </li>
                    <li class="metric-item">
                        <span class="metric-weight">+0.3</span>
                        High relevance scores
                    </li>
                    <li class="metric-item">
                        <span class="metric-weight">+0.3</span>
                        Efficiency (‚â§2 hops if sufficient)
                    </li>
                </ul>
            </div>

            <div class="optimization-card">
                <div class="optimization-header">
                    <div class="optimization-icon">üéØ</div>
                    <div>
                        <div class="optimization-title">Agent Metric</div>
                        <div class="optimization-phase">Phase 3 Optimization</div>
                    </div>
                </div>
                <ul class="metric-list">
                    <li class="metric-item">
                        <span class="metric-weight">+0.2</span>
                        Substantive response (>200 chars)
                    </li>
                    <li class="metric-item">
                        <span class="metric-weight">+0.3</span>
                        Evidence citations included
                    </li>
                    <li class="metric-item">
                        <span class="metric-weight">+0.2</span>
                        Confidence statement present
                    </li>
                    <li class="metric-item">
                        <span class="metric-weight">+0.3</span>
                        Visualization matches intent
                    </li>
                </ul>
            </div>
        </div>

        <!-- Benefits -->
        <div class="section-title">üìà Expected Improvements with DSPy</div>
        
        <div class="benefits-grid">
            <div class="benefit-card">
                <div class="benefit-value">+25%</div>
                <div class="benefit-label">Retrieval Relevance</div>
            </div>
            <div class="benefit-card">
                <div class="benefit-value">-30%</div>
                <div class="benefit-label">Unnecessary Hops</div>
            </div>
            <div class="benefit-card">
                <div class="benefit-value">+40%</div>
                <div class="benefit-label">Evidence Utilization</div>
            </div>
            <div class="benefit-card">
                <div class="benefit-value">+5%</div>
                <div class="benefit-label">Quarterly (via Feedback Learner)</div>
            </div>
        </div>

        <footer>
            <p>E2I Causal Analytics V4.1 ‚Ä¢ Cognitive RAG √ó DSPy Integration ‚Ä¢ 11 Optimizable Signatures</p>
        </footer>
    </div>
</body>
</html>
